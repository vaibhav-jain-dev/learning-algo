<h1 id="caching">Caching</h1>
<div class="tldr-box">
    <div class="tldr-header">TL;DR</div>
    <ul class="tldr-list">
        <li>Caching stores frequently accessed data in fast memory (100-1000x faster than disk/network)</li>
        <li>Common strategies: Cache-Aside (lazy load), Write-Through (sync), Write-Behind (async)</li>
        <li>Eviction policies: LRU (most popular), LFU, FIFO, TTL-based</li>
        <li>Prevent stampede: use jittered TTLs, locking, or stale-while-revalidate</li>
        <li>Best for read-heavy workloads (10:1 read/write ratio) with acceptable staleness</li>
    </ul>
</div>
<div class="concept-section type-definition">
<h2 id="overview">Overview</h2>
<p>Caching is a technique that stores copies of frequently accessed data in a faster storage layer (like memory) to reduce latency and decrease load on the primary data source. Think of it as keeping your most-used tools on your desk instead of walking to the storage room every time you need them.</p>
</div>
<hr />
<div class="concept-section type-important">
<h2 id="why-this-matters">Why This Matters</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; margin: 0 0 16px 0; font-size: 16px">Real Company Examples</h4>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px">
<div style="background: #ffffff;border-radius: 8px; padding: 16px">
<div style="color: #0f172a; font-weight: 600; margin-bottom: 8px">Netflix</div>
<div style="color: #475569; font-size: 14px">Caches movie metadata and thumbnails at edge servers. Reduced origin requests by 95% and serves 200+ million users globally.</div>
</div>
<div style="background: #ffffff;border-radius: 8px; padding: 16px">
<div style="color: #0f172a; font-weight: 600; margin-bottom: 8px">Facebook</div>
<div style="color: #475569; font-size: 14px">Uses Memcached clusters caching 75% of all reads. Handles billions of requests per second with sub-millisecond latency.</div>
</div>
<div style="background: #ffffff;border-radius: 8px; padding: 16px">
<div style="color: #0f172a; font-weight: 600; margin-bottom: 8px">Amazon</div>
<div style="color: #475569; font-size: 14px">Every 100ms of latency costs 1% in sales. Caching product pages and recommendations saves millions in revenue.</div>
</div>
</div>
</div>
<p><strong>Why caching is essential:</strong></p>
<ul>
<li><strong>Speed</strong>: Memory access is ~100x faster than disk, ~1000x faster than network</li>
<li><strong>Cost Reduction</strong>: Serve more requests with fewer database servers</li>
<li><strong>Scalability</strong>: Handle traffic spikes without scaling expensive backend resources</li>
<li><strong>User Experience</strong>: Users abandon sites that take more than 3 seconds to load</li>
</ul>
</div>
<hr />
<div class="concept-section type-definition">
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="the-library-analogy">The Library Analogy</h3>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<div style="color: #1e293b; font-size: 15px; line-height: 1.7">
<p>Imagine a <strong>university library</strong>:</p>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px">
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #dc2626; font-weight: 600; margin-bottom: 8px">Without Caching</div>
<ul style="color: #475569; margin: 0; padding-left: 20px; font-size: 14px">
<li>Every student walks to the archive basement</li>
<li>Finds the book in the catalog</li>
<li>Retrieves it from storage</li>
<li>Walks back to their desk</li>
<li><strong>Time: 10 minutes per book</strong></li>
</ul>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #16a34a; font-weight: 600; margin-bottom: 8px">With Caching</div>
<ul style="color: #475569; margin: 0; padding-left: 20px; font-size: 14px">
<li>Popular books kept on a "reserve shelf" near entrance</li>
<li>Students check reserve shelf first</li>
<li>If found (cache hit): grab and go</li>
<li>If not found (cache miss): go to archive</li>
<li><strong>Time: 30 seconds (hit) or 10 min (miss)</strong></li>
</ul>
</div>
</div>
</div>
</div>

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What is The Library Analogy and what problem does it solve?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about The Library Analogy in terms of its core purpose. Consider what specific problem it was designed to address and how it differs from simpler approaches. Try to explain it as if teaching someone who has never encountered this concept before.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply The Library Analogy?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where The Library Analogy provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using The Library Analogy?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider The Library Analogy from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h3 id="cache-terminology">Cache Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Library Analogy</th>
<th>Technical Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cache Hit</strong></td>
<td>Book found on reserve shelf</td>
<td>Data found in cache</td>
</tr>
<tr>
<td><strong>Cache Miss</strong></td>
<td>Book not on shelf, go to archive</td>
<td>Data not in cache, fetch from source</td>
</tr>
<tr>
<td><strong>TTL</strong></td>
<td>Books returned to archive after 7 days</td>
<td>Time before cached data expires</td>
</tr>
<tr>
<td><strong>Eviction</strong></td>
<td>Remove least-used books when shelf is full</td>
<td>Remove data when cache is full</td>
</tr>
<tr>
<td><strong>Invalidation</strong></td>
<td>Remove outdated edition when new one arrives</td>
<td>Remove stale data after update</td>
</tr>
</tbody>
</table>
</div>
<hr />
<div class="concept-section type-definition">

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What is a Cache Terminology?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about Cache Terminology in terms of its fundamental definition and purpose. Consider what makes it unique compared to related concepts. Try to identify the key characteristics that define it and the problems it was designed to solve.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Cache Terminology?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Cache Terminology provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Cache Terminology?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Cache Terminology from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h2 id="how-it-works">How It Works</h2>
<h3 id="cache-hierarchy">Cache Hierarchy</h3>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; text-align: center; margin: 0 0 20px 0; font-size: 16px">THE CACHING PYRAMID</h4>
<div style="display: flex; flex-direction: column; align-items: center; gap: 8px">
<div style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; padding: 12px 24px; border-radius: 8px; text-align: center; width: 120px">
<div style="font-weight: 600; font-size: 13px">Browser</div>
<div style="font-size: 11px; opacity: 0.9">~0ms</div>
</div>
<div style="color: #64748b">|</div>
<div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 12px 24px; border-radius: 8px; text-align: center; width: 160px">
<div style="font-weight: 600; font-size: 13px">CDN Edge</div>
<div style="font-size: 11px; opacity: 0.9">~20ms</div>
</div>
<div style="color: #64748b">|</div>
<div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; padding: 12px 24px; border-radius: 8px; text-align: center; width: 200px">
<div style="font-weight: 600; font-size: 13px">Application Cache (Redis)</div>
<div style="font-size: 11px; opacity: 0.9">~1ms</div>
</div>
<div style="color: #64748b">|</div>
<div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 12px 24px; border-radius: 8px; text-align: center; width: 240px">
<div style="font-weight: 600; font-size: 13px">Database Query Cache</div>
<div style="font-size: 11px; opacity: 0.9">~10ms</div>
</div>
<div style="color: #64748b">|</div>
<div style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 12px 24px; border-radius: 8px; text-align: center; width: 280px">
<div style="font-weight: 600; font-size: 13px">Database (Disk)</div>
<div style="font-size: 11px; opacity: 0.9">~50-100ms</div>
</div>
</div>
<div style="text-align: center; margin-top: 16px; color: #64748b; font-size: 13px">
    Faster at top, more capacity at bottom
</div>
</div>

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What is a Cache Hierarchy?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about Cache Hierarchy in terms of its fundamental definition and purpose. Consider what makes it unique compared to related concepts. Try to identify the key characteristics that define it and the problems it was designed to solve.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Cache Hierarchy?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Cache Hierarchy provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Cache Hierarchy?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Cache Hierarchy from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h3 id="caching-strategies">Caching Strategies</h3>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; text-align: center; margin: 0 0 20px 0; font-size: 16px">CACHE-ASIDE (LAZY LOADING)</h4>
<div style="display: flex; align-items: center; justify-content: center; gap: 16px; flex-wrap: wrap">
<div style="background: #ffffff;border-radius: 8px; padding: 16px 24px; text-align: center">
<div style="color: #1e293b; font-weight: 600">Application</div>
</div>
<div style="display: flex; flex-direction: column; align-items: center; gap: 4px">
<div style="color: #1e293b; font-size: 12px">1. Check</div>
<div style="color: #3b82f6; font-size: 18px">--></div>
</div>
<div style="background: #ffffff;border-radius: 8px; padding: 16px 24px; text-align: center">
<div style="color: #1e293b; font-weight: 600">Cache</div>
<div style="color: #64748b; font-size: 12px; margin-top: 4px">Hit? Return!</div>
</div>
<div style="display: flex; flex-direction: column; align-items: center; gap: 4px">
<div style="color: #1e293b; font-size: 12px">2. Miss?</div>
<div style="color: #ef4444; font-size: 18px">--></div>
</div>
<div style="background: #ffffff;border-radius: 8px; padding: 16px 24px; text-align: center">
<div style="color: #1e293b; font-weight: 600">Database</div>
</div>
</div>
<div style="text-align: center; margin-top: 16px; color: #475569; font-size: 13px">
    3. Store result in cache for next time
</div>
</div>

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What are Caching Strategies and why are they important?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider the different types or categories of Caching Strategies and what distinguishes them. Think about real-world examples where each type would be most appropriate. Understanding the variety helps you select the right tool for each situation.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Caching Strategies?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Caching Strategies provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Caching Strategies?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Caching Strategies from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h3 id="strategy-comparison">Strategy Comparison</h3>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<div style="overflow-x: auto">
<table style="width: 100%; border-collapse: collapse; color: #1e293b; font-size: 14px">
  <thead>
<tr style="background: #e2e8f0">
<th style="padding: 12px; text-align: left">Strategy</th>
<th style="padding: 12px; text-align: left">Read Path</th>
<th style="padding: 12px; text-align: left">Write Path</th>
<th style="padding: 12px; text-align: left">Best For</th>
</tr>
  </thead>
  <tbody>
<tr style="background: #ffffff">
<td style="padding: 12px;font-weight: 600">Cache-Aside</td>
<td style="padding: 12px">App checks cache, then DB</td>
<td style="padding: 12px">Update DB, invalidate cache</td>
<td style="padding: 12px">General purpose</td>
</tr>
<tr style="background: #f8fafc">
<td style="padding: 12px;font-weight: 600">Write-Through</td>
<td style="padding: 12px">Read from cache</td>
<td style="padding: 12px">Write to cache AND DB together</td>
<td style="padding: 12px">Strong consistency needed</td>
</tr>
<tr style="background: #ffffff">
<td style="padding: 12px;font-weight: 600">Write-Behind</td>
<td style="padding: 12px">Read from cache</td>
<td style="padding: 12px">Write to cache, async DB write</td>
<td style="padding: 12px">Write-heavy workloads</td>
</tr>
<tr style="background: #f8fafc">
<td style="padding: 12px; font-weight: 600">Read-Through</td>
<td style="padding: 12px">Cache fetches from DB on miss</td>
<td style="padding: 12px">N/A</td>
<td style="padding: 12px">Simplified read logic</td>
</tr>
  </tbody>
</table>
</div>
</div>

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What is a Strategy Comparison?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about Strategy Comparison in terms of its fundamental definition and purpose. Consider what makes it unique compared to related concepts. Try to identify the key characteristics that define it and the problems it was designed to solve.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Strategy Comparison?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Strategy Comparison provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Strategy Comparison?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Strategy Comparison from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h3 id="cache-eviction-policies">Cache Eviction Policies</h3>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; text-align: center; margin: 0 0 20px 0; font-size: 16px">WHEN THE CACHE IS FULL, WHO GETS EVICTED?</h4>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px">
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">LRU (Least Recently Used)</div>
<div style="color: #475569; font-size: 13px">Evict item not accessed longest. Most popular choice.</div>
<div style="color: #64748b; font-size: 12px; margin-top: 8px; font-style: italic">"Haven't used this in ages? Out!"</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">LFU (Least Frequently Used)</div>
<div style="color: #475569; font-size: 13px">Evict item accessed fewest times overall.</div>
<div style="color: #64748b; font-size: 12px; margin-top: 8px; font-style: italic">"Only used twice ever? Goodbye!"</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">FIFO (First In First Out)</div>
<div style="color: #475569; font-size: 13px">Evict oldest item regardless of usage.</div>
<div style="color: #64748b; font-size: 12px; margin-top: 8px; font-style: italic">"You were here first, now leave first."</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">TTL (Time To Live)</div>
<div style="color: #475569; font-size: 13px">Items expire after set time period.</div>
<div style="color: #64748b; font-size: 12px; margin-top: 8px; font-style: italic">"Your time is up!"</div>
</div>
</div>
</div>
</div>
<hr />
<div class="concept-section type-warning">

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What are Cache Eviction Policies and why are they important?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider the different types or categories of Cache Eviction Policies and what distinguishes them. Think about real-world examples where each type would be most appropriate. Understanding the variety helps you select the right tool for each situation.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Cache Eviction Policies?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Cache Eviction Policies provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Cache Eviction Policies?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Cache Eviction Policies from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h2 id="real-life-failure-story">Real-Life Failure Story</h2>
<div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #991b1b; margin: 0 0 16px 0; font-size: 16px">The Facebook Cache Stampede (2010)</h4>
<div style="color: #1e293b; font-size: 14px; line-height: 1.7">
<p><strong>What Happened:</strong> Facebook experienced a major outage when a bug caused their entire Memcached cluster to invalidate simultaneously. When cache entries expired at the same time:</p>
<ol style="color: #475569; margin: 12px 0">
<li>Millions of requests found empty caches (cache miss)</li>
<li>All requests hit the database simultaneously</li>
<li>Database servers were overwhelmed and crashed</li>
<li>Even after restart, the stampede repeated</li>
</ol>
<p><strong>The Fix:</strong></p>
<ul style="color: #475569; margin: 12px 0">
<li><strong>Jittered TTLs:</strong> Added random variation to expiration times (e.g., 3600s +/- 300s)</li>
<li><strong>Locking:</strong> Only one request regenerates cache, others wait</li>
<li><strong>Stale-while-revalidate:</strong> Serve stale data while refreshing in background</li>
</ul>
<p><strong>Lesson:</strong> Never let cache entries expire at the same time. Add randomization to everything in distributed systems.</p>
</div>
</div>
</div>
<hr />
<div class="concept-section type-warning">
<h2 id="what-to-watch-out-for">What to Watch Out For</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; margin: 0 0 16px 0; font-size: 16px">Common Pitfalls</h4>
<div style="display: grid; gap: 12px">
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600">Cache Stampede</div>
<div style="color: #475569; font-size: 13px">Many requests hit database when cache expires. Use locking or jittered TTLs.</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600">Stale Data</div>
<div style="color: #475569; font-size: 13px">Cache shows outdated information. Implement proper invalidation or use short TTLs.</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600">Cache Penetration</div>
<div style="color: #475569; font-size: 13px">Queries for non-existent data always miss cache. Cache negative results too.</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600">Hot Key Problem</div>
<div style="color: #475569; font-size: 13px">One popular key overwhelms a single cache node. Replicate hot keys or use local caching.</div>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600">Memory Pressure</div>
<div style="color: #475569; font-size: 13px">Cache grows unbounded. Set memory limits and monitor eviction rates.</div>
</div>
</div>
</div>
</div>
<hr />
<div class="concept-section type-important">
<h2 id="interview-deep-dive">Interview Deep Dive</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; margin: 0 0 16px 0; font-size: 16px">Common Interview Questions</h4>
<div style="margin-bottom: 20px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">Q: How do you handle cache invalidation in a distributed system?</div>
<div style="color: #475569; font-size: 14px; background: #ffffff; padding: 12px; border-radius: 6px">
<strong>A:</strong> Multiple approaches: (1) <strong>TTL-based</strong> - set expiration, accept some staleness. (2) <strong>Event-driven</strong> - publish invalidation events via Kafka/Redis Pub-Sub when data changes. (3) <strong>Version-based</strong> - include version in cache key, increment on updates. For strong consistency, use write-through with distributed locks.
</div>
</div>
<div style="margin-bottom: 20px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">Q: Redis vs Memcached - when would you choose each?</div>
<div style="color: #475569; font-size: 14px; background: #ffffff; padding: 12px; border-radius: 6px">
<strong>A:</strong> <strong>Redis</strong> when you need: data structures (lists, sets, sorted sets), persistence, pub/sub, Lua scripting, replication. <strong>Memcached</strong> when you need: simple key-value, multi-threaded performance, less memory overhead per key, or already have it in your stack. Redis is more versatile; Memcached is simpler and slightly faster for basic operations.
</div>
</div>
<div style="margin-bottom: 20px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">Q: How do you prevent cache stampede?</div>
<div style="color: #475569; font-size: 14px; background: #ffffff; padding: 12px; border-radius: 6px">
<strong>A:</strong> (1) <strong>Locking</strong> - only one request regenerates, others wait or return stale. (2) <strong>Probabilistic early expiration</strong> - randomly refresh before TTL. (3) <strong>Background refresh</strong> - async job refreshes popular keys. (4) <strong>Jittered TTLs</strong> - add randomness to prevent synchronized expiry.
</div>
</div>
<div>
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px">Q: When should you NOT use caching?</div>
<div style="color: #475569; font-size: 14px; background: #ffffff; padding: 12px; border-radius: 6px">
<strong>A:</strong> (1) <strong>Highly dynamic data</strong> that changes every request. (2) <strong>Strong consistency requirements</strong> where stale reads are unacceptable (financial transactions). (3) <strong>Low-traffic endpoints</strong> where cache hit rate would be low. (4) <strong>Large, unique datasets</strong> that don't fit in memory. (5) <strong>Security-sensitive data</strong> that shouldn't persist outside the database.
</div>
</div>
</div>
</div>
<hr />
<div class="concept-section type-example">
<h2 id="code-implementation">Code Implementation</h2>
<h3 id="python---production-cache-with-stampede-prevention">Python - Production Cache with Stampede Prevention</h3>
<pre><code class="language-python">import time
import threading
import hashlib
import random
from typing import Optional, Callable, Any
from dataclasses import dataclass

@dataclass
class CacheEntry:
    value: Any
    expires_at: float
    created_at: float

class ProductionCache:
    &quot;&quot;&quot;
    Production-ready cache with:
    - TTL with jitter (prevents stampede)
    - Locking for cache regeneration
    - Stale-while-revalidate
    - Cache statistics
    &quot;&quot;&quot;

    def __init__(self, max_size: int = 10000, default_ttl: int = 3600):
        self.cache: dict[str, CacheEntry] = {}
        self.max_size = max_size
        self.default_ttl = default_ttl
        self.locks: dict[str, threading.Lock] = {}
        self.lock_mutex = threading.Lock()

        # Statistics
        self.hits = 0
        self.misses = 0

    def _get_lock(self, key: str) -&gt; threading.Lock:
        &quot;&quot;&quot;Get or create a lock for a specific key.&quot;&quot;&quot;
        with self.lock_mutex:
            if key not in self.locks:
                self.locks[key] = threading.Lock()
            return self.locks[key]

    def _add_jitter(self, ttl: int) -&gt; float:
        &quot;&quot;&quot;Add 10% random jitter to TTL.&quot;&quot;&quot;
        jitter = ttl * 0.1 * random.random()
        return ttl + jitter

    def get(self, key: str) -&gt; Optional[Any]:
        &quot;&quot;&quot;Get value from cache.&quot;&quot;&quot;
        entry = self.cache.get(key)

        if entry is None:
            self.misses += 1
            return None

        if time.time() &gt; entry.expires_at:
            self.misses += 1
            return None

        self.hits += 1
        return entry.value

    def set(self, key: str, value: Any, ttl: Optional[int] = None) -&gt; None:
        &quot;&quot;&quot;Set value in cache with jittered TTL.&quot;&quot;&quot;
        ttl = ttl or self.default_ttl
        jittered_ttl = self._add_jitter(ttl)

        # Evict if at capacity (simple LRU would be better)
        if len(self.cache) &gt;= self.max_size:
            oldest_key = min(self.cache, key=lambda k: self.cache[k].created_at)
            del self.cache[oldest_key]

        self.cache[key] = CacheEntry(
            value=value,
            expires_at=time.time() + jittered_ttl,
            created_at=time.time()
        )

    def get_or_set(
        self,
        key: str,
        loader: Callable[[], Any],
        ttl: Optional[int] = None,
        stale_ttl: int = 60
    ) -&gt; Any:
        &quot;&quot;&quot;
        Get from cache or load with stampede prevention.

        Uses locking to ensure only one request loads data.
        Others wait or return stale data.
        &quot;&quot;&quot;
        entry = self.cache.get(key)
        now = time.time()

        # Fresh cache hit
        if entry and now &lt; entry.expires_at:
            self.hits += 1
            return entry.value

        # Stale data available?
        stale_value = entry.value if entry else None
        stale_available = entry and now &lt; entry.expires_at + stale_ttl

        # Try to acquire lock
        lock = self._get_lock(key)
        acquired = lock.acquire(blocking=not stale_available)

        if not acquired:
            # Couldn't get lock, return stale if available
            self.hits += 1  # Serving stale
            return stale_value

        try:
            # Double-check after acquiring lock
            entry = self.cache.get(key)
            if entry and time.time() &lt; entry.expires_at:
                return entry.value

            # Load fresh data
            self.misses += 1
            value = loader()
            self.set(key, value, ttl)
            return value
        finally:
            lock.release()

    def invalidate(self, key: str) -&gt; bool:
        &quot;&quot;&quot;Remove key from cache.&quot;&quot;&quot;
        if key in self.cache:
            del self.cache[key]
            return True
        return False

    def invalidate_pattern(self, pattern: str) -&gt; int:
        &quot;&quot;&quot;Invalidate all keys matching pattern (simple prefix match).&quot;&quot;&quot;
        keys_to_delete = [k for k in self.cache if k.startswith(pattern)]
        for key in keys_to_delete:
            del self.cache[key]
        return len(keys_to_delete)

    def stats(self) -&gt; dict:
        &quot;&quot;&quot;Get cache statistics.&quot;&quot;&quot;
        total = self.hits + self.misses
        return {
            &quot;hits&quot;: self.hits,
            &quot;misses&quot;: self.misses,
            &quot;hit_rate&quot;: self.hits / total if total &gt; 0 else 0,
            &quot;size&quot;: len(self.cache),
            &quot;max_size&quot;: self.max_size
        }


# Usage Example
cache = ProductionCache(max_size=10000, default_ttl=3600)

def get_user(user_id: int) -&gt; dict:
    &quot;&quot;&quot;Get user with caching.&quot;&quot;&quot;
    cache_key = f&quot;user:{user_id}&quot;

    def load_from_db():
        # Simulate database query
        return {&quot;id&quot;: user_id, &quot;name&quot;: f&quot;User {user_id}&quot;}

    return cache.get_or_set(cache_key, load_from_db, ttl=300)

# First call - cache miss, loads from DB
user = get_user(123)

# Second call - cache hit
user = get_user(123)

# Check stats
print(cache.stats())
# {'hits': 1, 'misses': 1, 'hit_rate': 0.5, 'size': 1, 'max_size': 10000}
</code></pre>

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What is a Python - Production Cache with Stampede Prevention?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about Python - Production Cache with Stampede Prevention in terms of its fundamental definition and purpose. Consider what makes it unique compared to related concepts. Try to identify the key characteristics that define it and the problems it was designed to solve.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Python - Production Cache with Stampede Prevention?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Python - Production Cache with Stampede Prevention provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Python - Production Cache with Stampede Prevention?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Python - Production Cache with Stampede Prevention from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h3 id="python---distributed-cache-with-redis">Python - Distributed Cache with Redis</h3>
<pre><code class="language-python">import redis
import json
import time
from typing import Optional, Any, Callable

class RedisCache:
    &quot;&quot;&quot;Redis-backed distributed cache.&quot;&quot;&quot;

    def __init__(self, host: str = 'localhost', port: int = 6379, db: int = 0):
        self.client = redis.Redis(host=host, port=port, db=db, decode_responses=True)
        self.default_ttl = 3600

    def get(self, key: str) -&gt; Optional[Any]:
        &quot;&quot;&quot;Get value from Redis.&quot;&quot;&quot;
        value = self.client.get(key)
        if value:
            return json.loads(value)
        return None

    def set(self, key: str, value: Any, ttl: Optional[int] = None) -&gt; None:
        &quot;&quot;&quot;Set value in Redis with TTL.&quot;&quot;&quot;
        ttl = ttl or self.default_ttl
        self.client.setex(key, ttl, json.dumps(value))

    def get_or_set(
        self,
        key: str,
        loader: Callable[[], Any],
        ttl: Optional[int] = None
    ) -&gt; Any:
        &quot;&quot;&quot;Get from cache or load with distributed locking.&quot;&quot;&quot;
        # Try cache first
        value = self.get(key)
        if value is not None:
            return value

        # Distributed lock using SETNX
        lock_key = f&quot;lock:{key}&quot;
        lock_acquired = self.client.setnx(lock_key, &quot;1&quot;)

        if lock_acquired:
            self.client.expire(lock_key, 30)  # Lock timeout
            try:
                value = loader()
                self.set(key, value, ttl)
                return value
            finally:
                self.client.delete(lock_key)
        else:
            # Wait and retry
            time.sleep(0.1)
            return self.get(key) or loader()

    def invalidate(self, key: str) -&gt; bool:
        &quot;&quot;&quot;Delete key from Redis.&quot;&quot;&quot;
        return self.client.delete(key) &gt; 0

    def invalidate_pattern(self, pattern: str) -&gt; int:
        &quot;&quot;&quot;Delete keys matching pattern.&quot;&quot;&quot;
        keys = self.client.keys(pattern)
        if keys:
            return self.client.delete(*keys)
        return 0
</code></pre>
</div>
<hr />

<div class="qa-section" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 12px; padding: 20px; margin: 20px 0;">
<h4 style="color: #0369a1; margin-top: 0;">Check Your Understanding</h4>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q1: What are Python - Distributed Cache with Redis and why are they important?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider the different types or categories of Python - Distributed Cache with Redis and what distinguishes them. Think about real-world examples where each type would be most appropriate. Understanding the variety helps you select the right tool for each situation.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q2: In what scenarios would you apply Python - Distributed Cache with Redis?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Think about the characteristics of problems where Python - Distributed Cache with Redis provides the most value. Consider both the technical requirements (data structures, algorithms needed) and the business context (scalability, performance constraints). Real-world applications often require adapting the theoretical approach to practical constraints.</p>
</div>
</details>
<details style="margin-bottom: 12px;">
<summary style="cursor: pointer; font-weight: 600; color: #1e293b;">Q3: What are the trade-offs involved in using Python - Distributed Cache with Redis?</summary>
<div style="padding: 12px; background: white; border-radius: 8px; margin-top: 8px;">
<p>Consider Python - Distributed Cache with Redis from multiple perspectives: What do you gain? What do you sacrifice? Think about time vs. space trade-offs, simplicity vs. flexibility, and short-term convenience vs. long-term maintainability. The best engineers understand these trade-offs deeply and make informed decisions based on their specific context.</p>
</div>
</details>
</div>
<h2 id="quick-reference-card">Quick Reference Card</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border-radius: 12px; padding: 24px; margin: 20px 0">
<h4 style="color: #1e293b; text-align: center; margin: 0 0 20px 0; font-size: 16px">CACHING CHEAT SHEET</h4>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px">
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px;padding-bottom: 8px">When to Cache</div>
<ul style="color: #475569; font-size: 13px; margin: 0; padding-left: 16px">
<li>Read-heavy workloads (read:write > 10:1)</li>
<li>Expensive computations</li>
<li>Slow external API calls</li>
<li>Database query results</li>
<li>Session data</li>
</ul>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px;padding-bottom: 8px">When NOT to Cache</div>
<ul style="color: #475569; font-size: 13px; margin: 0; padding-left: 16px">
<li>Rapidly changing data</li>
<li>Write-heavy workloads</li>
<li>Unique queries (low hit rate)</li>
<li>Sensitive financial data</li>
<li>Real-time requirements</li>
</ul>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px;padding-bottom: 8px">TTL Guidelines</div>
<ul style="color: #475569; font-size: 13px; margin: 0; padding-left: 16px">
<li>Static assets: 1 year</li>
<li>User profiles: 1 hour</li>
<li>API responses: 5-15 minutes</li>
<li>Search results: 1-5 minutes</li>
<li>Real-time data: 10-30 seconds</li>
</ul>
</div>
<div style="background: #ffffff; border-radius: 8px; padding: 16px">
<div style="color: #1e293b; font-weight: 600; margin-bottom: 8px;padding-bottom: 8px">Key Metrics</div>
<ul style="color: #475569; font-size: 13px; margin: 0; padding-left: 16px">
<li>Hit rate > 90% (for hot data)</li>
<li>Latency p99 < 10ms</li>
<li>Memory usage < 80%</li>
<li>Eviction rate (should be low)</li>
<li>Connection count</li>
</ul>
</div>
</div>
<div style="margin-top: 16px; padding: 12px; background: #ffffff; border-radius: 8px; text-align: center">
<code style="color: #1e293b; font-size: 13px">Cache Rule: "Cache data that is read often, written rarely, and can tolerate some staleness"</code>
</div>
</div>
<hr />
<h2 id="related-topics">Related Topics</h2>
<ul>
<li><a href="/topic/system-design/cdn">CDN</a> - Edge caching for static content</li>
<li><a href="/topic/system-design/database-replication">Database Replication</a> - Data redundancy</li>
<li><a href="/topic/system-design/load-balancing">Load Balancing</a> - Request distribution</li>
<li><a href="/topic/system-design/redis">Redis</a> - Popular caching solution</li>
</ul>
