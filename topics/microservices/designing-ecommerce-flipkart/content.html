<h1 id="designing-flipkart-e-commerce-microservices-architecture">Designing Flipkart (E-Commerce) Microservices Architecture</h1>
<h2 id="overview">Overview</h2>
<p>This comprehensive guide walks through designing a large-scale e-commerce platform like Flipkart using microservices architecture. We'll cover service decomposition, data modeling, communication patterns, and handling scale challenges.</p>
<p><strong>Tags:</strong> System Design, E-Commerce, Case Study, Flipkart</p>
<hr />
<h2 id="requirements-analysis">Requirements Analysis</h2>
<h3 id="functional-requirements">Functional Requirements</h3>
<div>
<h4>FLIPKART FUNCTIONAL REQUIREMENTS</h4>
<div>
<div>
<div>USER MANAGEMENT</div>
<div>Registration/Login | Profile management<br/>Address management | Wishlist</div>
</div>
<div>
<div>PRODUCT MANAGEMENT</div>
<div>Product catalog | Categories & attributes<br/>Inventory tracking | Seller management</div>
</div>
<div>
<div>SEARCH & DISCOVERY</div>
<div>Full-text search | Filters & facets<br/>Recommendations | Recently viewed</div>
</div>
<div>
<div>ORDERING</div>
<div>Cart management | Order placement<br/>Order tracking | Returns & refunds</div>
</div>
<div>
<div>PAYMENTS</div>
<div>Multiple payment modes | Wallet system<br/>Refund processing | Invoice generation</div>
</div>
<div>
<div>LOGISTICS</div>
<div>Warehouse management | Shipping partners<br/>Delivery tracking | Last-mile delivery</div>
</div>
<div>
<div>NOTIFICATIONS</div>
<div>Email/SMS/Push<br/>Order updates | Promotional</div>
</div>
<div>
<div>ANALYTICS</div>
<div>User behavior | Sales analytics<br/>Inventory forecasting</div>
</div>
</div>
</div>
<h3 id="non-functional-requirements">Non-Functional Requirements</h3>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Target</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Availability</strong></td>
<td>99.99% (52 min downtime/year)</td>
</tr>
<tr>
<td><strong>Latency</strong></td>
<td>p99 &lt; 200ms for API calls</td>
</tr>
<tr>
<td><strong>Throughput</strong></td>
<td>100K+ orders/minute during sales</td>
</tr>
<tr>
<td><strong>Data Volume</strong></td>
<td>100M+ products, 500M+ users</td>
</tr>
<tr>
<td><strong>Concurrent Users</strong></td>
<td>10M+ during peak</td>
</tr>
<tr>
<td><strong>Scale</strong></td>
<td>Handle 10x traffic during Big Billion Days</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="high-level-architecture">High-Level Architecture</h2>
<div>
<h4>FLIPKART MICROSERVICES ARCHITECTURE</h4>
  <!-- Clients Layer -->
<div>
<div>CLIENTS</div>
<div>
<div>Web App</div>
<div>iOS App</div>
<div>Android App</div>
<div>Partner API</div>
</div>
</div>
<div>v</div>
  <!-- CDN Layer -->
<div>
    CDN + WAF + DDoS Protection
</div>
<div>v</div>
  <!-- API Gateway -->
<div>
<div>API GATEWAY (Kong)</div>
<div>
<span>Auth</span>
<span>Rate Limit</span>
<span>Routing</span>
<span>Transform</span>
<span>Cache</span>
</div>
</div>
<div>v</div>
  <!-- BFF Layer -->
<div>
<div>BACKEND FOR FRONTEND (BFF)</div>
<div>
<span>Web BFF</span>
<span>Mobile BFF</span>
<span>Partner BFF</span>
</div>
</div>
<div>v</div>
  <!-- Domain Services Layer -->
<div>
<div>DOMAIN SERVICES LAYER</div>
<div>
<div>
<span>User</span>
<span>Product</span>
<span>Cart</span>
<span>Order</span>
<span>Payment</span>
</div>
<div>
<span>Inventory</span>
<span>Search</span>
<span>Shipping</span>
<span>Seller</span>
<span>Pricing</span>
</div>
<div>
<span>Wallet</span>
<span>Recommend</span>
<span>Promo</span>
<span>Notif</span>
<span>Analytics</span>
</div>
</div>
</div>
<div>v</div>
  <!-- Data Layer -->
<div>
<div>DATA & MESSAGING LAYER</div>
<div>
<div><div>PostgreSQL</div><div>(Users)</div></div>
<div><div>MongoDB</div><div>(Products)</div></div>
<div><div>Redis</div><div>(Cache)</div></div>
<div><div>Kafka</div><div>(Events)</div></div>
<div><div>Elastic</div><div>(Search)</div></div>
</div>
</div>
</div>
<hr />
<h2 id="service-decomposition">Service Decomposition</h2>
<h3 id="core-services">Core Services</h3>
<h4 id="1-user-service">1. User Service</h4>
<div>
<h4>USER SERVICE</h4>
<div>
<div>
<div>RESPONSIBILITIES:</div>
<div>
<div>- User registration & authentication</div>
<div>- Profile management (name, email, phone)</div>
<div>- Address book management</div>
<div>- Session management</div>
<div>- User preferences</div>
</div>
</div>
<div>
<div>API ENDPOINTS:</div>
<div>
<div><span>POST</span> /api/users/register</div>
<div><span>POST</span> /api/users/login</div>
<div><span>GET</span> /api/users/{id}</div>
<div><span>PUT</span> /api/users/{id}</div>
<div><span>GET</span> /api/users/{id}/addresses</div>
</div>
</div>
</div>
<div>DATABASE: PostgreSQL</div>
<div>
<div>
<div>users</div>
<div>id (PK) | email | phone | password_hash | first_name | last_name | created_at</div>
</div>
<div>
<div>addresses</div>
<div>id (PK) | user_id (FK) | address_line1 | city | state | pincode | is_default | type</div>
</div>
</div>
<div>
<span>CACHE:</span> <span>Redis (sessions, frequently accessed profiles)</span>
</div>
</div>
<h4 id="2-product-service">2. Product Service</h4>
<div>
<h4>PRODUCT SERVICE</h4>
<div>
<div>
<div>RESPONSIBILITIES:</div>
<div>
<div>- Product CRUD operations</div>
<div>- Category management</div>
<div>- Product attributes & variants</div>
<div>- Product images & media</div>
<div>- Product reviews & ratings</div>
</div>
</div>
<div>
<div>API ENDPOINTS:</div>
<div>
<div><span>GET</span> /api/products?category=&filters=</div>
<div><span>GET</span> /api/products/{id}</div>
<div><span>GET</span> /api/products/{id}/variants</div>
<div><span>GET</span> /api/products/{id}/reviews</div>
<div><span>POST</span> /api/products/{id}/reviews</div>
</div>
</div>
</div>
<div>DATABASE: MongoDB (flexible schema)</div>
<div>
<div>{</div>
<div><span>"_id"</span>: <span>"prod_123"</span>,</div>
<div><span>"name"</span>: <span>"iPhone 15 Pro"</span>,</div>
<div><span>"category"</span>: [<span>"Electronics"</span>, <span>"Mobiles"</span>, <span>"Apple"</span>],</div>
<div><span>"attributes"</span>: { <span>"color"</span>: <span>"Space Black"</span>, <span>"storage"</span>: <span>"256GB"</span> },</div>
<div><span>"variants"</span>: [{ <span>"sku"</span>: <span>"IP15P-256-BLK"</span> }],</div>
<div><span>"rating"</span>: { <span>"avg"</span>: <span>4.5</span>, <span>"count"</span>: <span>15234</span> }</div>
<div>}</div>
</div>
</div>
<h4 id="3-inventory-service">3. Inventory Service</h4>
<div>
<h4>INVENTORY SERVICE</h4>
<div>RESPONSIBILITIES:</div>
<div>
    Track stock levels per SKU | Reserve inventory for orders | Release on cancellation | Low stock alerts
</div>
<div>CRITICAL OPERATIONS (ACID):</div>
<div>
<div>
<div>RESERVE</div>
<div>1. Check available>= requested<br/>2. Decrement available_qty<br/>3. Increment reserved_qty<br/>4. Create reservation with TTL</div>
</div>
<div>
<div>COMMIT</div>
<div>1. Decrement reserved_qty<br/>2. Create shipment allocation</div>
</div>
<div>
<div>RELEASE</div>
<div>1. Increment available_qty<br/>2. Decrement reserved_qty<br/>3. Delete reservation</div>
</div>
</div>
<div>
<div>
<div>inventory</div>
<div>sku (PK) | warehouse_id (PK) | available_qty | reserved_qty | reorder_point</div>
</div>
<div>
<div>inventory_reservations</div>
<div>id (PK) | sku | warehouse_id | order_id | quantity | status | expires_at</div>
</div>
</div>
<div><strong>DISTRIBUTED LOCK:</strong> Redis (prevent overselling)</div>
</div>
<h4 id="4-cart-service">4. Cart Service</h4>
<div>
<h4>CART SERVICE</h4>
<div>
<div>
<div>RESPONSIBILITIES:</div>
<div>
  Add/remove items | Update quantities | Apply coupons | Calculate totals | Cart persistence
</div>
</div>
<div>
<div>API ENDPOINTS:</div>
<div>
<span>GET</span> /api/cart | <span>POST</span> /api/cart/items<br/>
<span>PUT/DELETE</span> /api/cart/items/{sku}
</div>
</div>
</div>
<div>DATA MODEL (Redis + PostgreSQL backup):</div>
<div>
<div><span>cart:{user_id}</span> {</div>
<div><span>"items"</span>: [{ <span>"sku"</span>: <span>"IP15P-256-BLK"</span>, <span>"quantity"</span>: <span>1</span>, <span>"price"</span>: <span>134900</span> }],</div>
<div><span>"coupon_code"</span>: <span>"SAVE10"</span></div>
<div>}</div>
</div>
<div>EVENTS PUBLISHED:</div>
<div>
<span>cart.item.added</span>
<span>cart.item.removed</span>
<span>cart.abandoned (24h)</span>
</div>
</div>
<h4 id="5-order-service">5. Order Service</h4>
<div>
<h4>ORDER SERVICE</h4>
<div>RESPONSIBILITIES:</div>
<div>
    Order creation & management | Order state machine | Order history | Returns & refunds
</div>
<div>ORDER STATE MACHINE:</div>
<div>
<div>
<div>CREATED</div>
<div>-></div>
<div>PAYMENT_PENDING</div>
<div>-></div>
<div>CONFIRMED</div>
<div>-></div>
<div>PROCESSING</div>
<div>-></div>
<div>SHIPPED</div>
<div>-></div>
<div>DELIVERED</div>
</div>
<div>
<div>
<div>v payment fails</div>
<div>CANCELLED</div>
</div>
<div>
<div>v return request</div>
<div>RETURNED</div>
</div>
</div>
</div>
<div>
<div>
<div>orders</div>
<div>id (PK) | user_id | status | total_amount | shipping_address_id | payment_id</div>
</div>
<div>
<div>order_items</div>
<div>id (PK) | order_id (FK) | sku | product_id | quantity | unit_price | seller_id</div>
</div>
</div>
</div>
<h4 id="6-payment-service">6. Payment Service</h4>
<div>
<h4>PAYMENT SERVICE</h4>
<div>RESPONSIBILITIES:</div>
<div>
    Payment processing (UPI, Cards, NetBanking, COD) | Gateway integration | Refund processing | Fraud detection
</div>
<div>PAYMENT FLOW:</div>
<div>
<div>
<div><span>1.</span> Order Service -> Payment Service: Initiate Payment</div>
<div><span>2.</span> Payment Service -> Payment Gateway: Create Order</div>
<div><span>3.</span> User -> Payment Gateway: Complete Payment</div>
<div><span>4.</span> Payment Gateway -> Webhook -> Payment Service</div>
<div><span>5.</span> Payment Service -> Kafka: <span>payment.completed</span></div>
<div><span>6.</span> Order Service -> Consume event -> Update order</div>
</div>
</div>
<div>INTEGRATIONS:</div>
<div>
<span>Razorpay (UPI, Cards)</span>
<span>PayU (NetBanking)</span>
<span>Simpl (BNPL)</span>
<span>Internal Wallet</span>
</div>
<div>
<div>
<div>payments</div>
<div>id | order_id | amount | currency | method | gateway | gateway_txn_id | status</div>
</div>
<div>
<div>refunds</div>
<div>id | payment_id (FK) | amount | reason | status | created_at</div>
</div>
</div>
</div>
<hr />
<h2 id="search-architecture">Search Architecture</h2>
<div>
<h4>SEARCH ARCHITECTURE</h4>
  <!-- Search Query Flow -->
<div>
<div>SEARCH QUERY FLOW</div>
<div>
<div>
<strong>User Query:</strong> "iPhone 15 Pro 256GB black"
</div>
</div>
<div>v</div>
<div>
<div>Query Parser</div>
<div>-> Tokenize, Normalize, Spell Check</div>
</div>
<div>v</div>
<div>
<div>Query Builder</div>
<div>-> Build Elasticsearch DSL</div>
</div>
<div>v</div>
    <!-- Elasticsearch Cluster -->
<div>
<div>ELASTICSEARCH CLUSTER</div>
<div>
<div>Shard 1</div>
<div>Shard 2</div>
<div>Shard 3</div>
</div>
<div>
<strong>Indexes:</strong> products (100M+ docs) | sellers (1M docs) | categories (10K docs)
</div>
</div>
<div>v</div>
<div>
<div>Ranker</div>
<div>-> Relevance, Popularity, Personalize</div>
</div>
<div>v</div>
<div>
<div>
  Search Results with Facets
</div>
</div>
</div>
  <!-- Data Sync Pipeline -->
<div>DATA SYNC PIPELINE:</div>
<div>
<div>
<div>
<div>MongoDB</div>
<div>(Products)</div>
</div>
<div>-></div>
<div>
<div>Debezium CDC</div>
<div>(Change Data Capture)</div>
</div>
<div>-></div>
<div>
<div>Kafka</div>
<div>(product.events)</div>
</div>
<div>-></div>
<div>
<div>Elasticsearch</div>
<div>(Index Updates)</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="order-flow-sequence">Order Flow Sequence</h2>
<div>
<h4>ORDER CREATION FLOW</h4>
  <!-- Service Headers -->
<div>
<div>User</div>
<div>Cart</div>
<div>Order</div>
<div>Inventory</div>
<div>Payment</div>
<div>Notification</div>
</div>
  <!-- Flow Steps -->
<div>
<div>
<div>
<span>1.</span>
<span>User</span>
<span>-> Checkout -></span>
<span>Cart</span>
</div>
<div>
<span>2.</span>
<span>Cart</span>
<span>-> Create Order -></span>
<span>Order Service</span>
</div>
<div>
<span>3.</span>
<span>Order</span>
<span>-> Reserve Stock -></span>
<span>Inventory</span>
<span>OK</span>
</div>
<div>
<span>4.</span>
<span>Order</span>
<span>-> Initiate Payment -></span>
<span>Payment</span>
</div>
<div>
<span>5.</span>
<span>Payment</span>
<span>-> Payment URL -></span>
<span>User</span>
</div>
<div>
<span>6.</span>
<span>User</span>
<span>-> Pay -></span>
<span>Payment Gateway</span>
</div>
<div>
<span>7.</span>
<span>Payment Gateway</span>
<span>-> Webhook (Success) -></span>
<span>Order</span>
</div>
<div>
<span>8.</span>
<span>Order</span>
<span>-> Confirm Stock -></span>
<span>Inventory</span>
</div>
<div>
<span>9.</span>
<span>Order</span>
<span>-> Notify -></span>
<span>Notification</span>
</div>
<div>
<span>10.</span>
<span>Notification</span>
<span>-> Order Confirmed -></span>
<span>User</span>
<span>Complete</span>
</div>
</div>
</div>
</div>
<hr />
<h2 id="handling-scale-big-billion-days">Handling Scale (Big Billion Days)</h2>
<h3 id="pre-sale-preparations">Pre-Sale Preparations</h3>
<div>
<h4>SCALING FOR BIG BILLION DAYS</h4>
  <!-- Traffic Management -->
<div>TRAFFIC MANAGEMENT:</div>
<div>
    <!-- Queue-Based Checkout -->
<div>
<div>1. QUEUE-BASED CHECKOUT</div>
<div>
<div>
<div>Users</div>
<div>(10M)</div>
</div>
<div>-></div>
<div>
<div>Virtual Queue</div>
</div>
<div>-></div>
<div>
<div>Checkout</div>
<div>(10K/s)</div>
</div>
</div>
</div>
    <!-- Flash Sale Inventory -->
<div>
<div>2. FLASH SALE INVENTORY LOCKING</div>
<div>
<div>- Pre-reserve inventory in Redis</div>
<div>- Atomic decrement with Lua scripts</div>
<div>- No database queries during flash</div>
</div>
</div>
    <!-- Static Page Caching -->
<div>
<div>3. STATIC PAGE CACHING</div>
<div>
<div>- Pre-render product pages</div>
<div>- CDN caching with 5-min TTL</div>
<div>- Dynamic prices via API</div>
</div>
</div>
</div>
  <!-- Infrastructure Scaling -->
<div>INFRASTRUCTURE SCALING:</div>
<div>
<table>
<tr>
<th>Component</th>
<th>Normal</th>
<th>BBD (10x)</th>
</tr>
<tr>
<td>API Gateway</td>
<td>50 pods</td>
<td>500 pods</td>
</tr>
<tr>
<td>Cart Service</td>
<td>30 pods</td>
<td>300 pods</td>
</tr>
<tr>
<td>Order Service</td>
<td>20 pods</td>
<td>200 pods</td>
</tr>
<tr>
<td>Payment Service</td>
<td>40 pods</td>
<td>400 pods</td>
</tr>
<tr>
<td>Redis Cluster</td>
<td>6 nodes</td>
<td>30 nodes</td>
</tr>
<tr>
<td>Kafka Brokers</td>
<td>9 brokers</td>
<td>27 brokers</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>3 replicas</td>
<td>10 replicas</td>
</tr>
</table>
</div>
  <!-- Graceful Degradation -->
<div>GRACEFUL DEGRADATION:</div>
<div>
<div>
<div>Priority 1 (Always)</div>
<div>
<div>- Checkout & Payment</div>
<div>- Order status</div>
<div>- Core search</div>
</div>
</div>
<div>
<div>Priority 2 (Degraded)</div>
<div>
<div>- Recommendations</div>
<div>- Reviews</div>
<div>- Wishlist</div>
</div>
</div>
<div>
<div>Priority 3 (Disabled)</div>
<div>
<div>- Recently viewed</div>
<div>- Price history</div>
<div>- Similar products</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="key-design-decisions">Key Design Decisions</h2>
<table>
<thead>
<tr>
<th>Decision</th>
<th>Choice</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Product DB</strong></td>
<td>MongoDB</td>
<td>Flexible schema for varied product attributes</td>
</tr>
<tr>
<td><strong>User/Order DB</strong></td>
<td>PostgreSQL</td>
<td>ACID compliance for transactions</td>
</tr>
<tr>
<td><strong>Cache</strong></td>
<td>Redis Cluster</td>
<td>High throughput, pub/sub, Lua scripts</td>
</tr>
<tr>
<td><strong>Message Broker</strong></td>
<td>Kafka</td>
<td>High throughput, replay capability</td>
</tr>
<tr>
<td><strong>Search</strong></td>
<td>Elasticsearch</td>
<td>Full-text search, faceted navigation</td>
</tr>
<tr>
<td><strong>API Gateway</strong></td>
<td>Kong</td>
<td>Plugin ecosystem, Kubernetes native</td>
</tr>
<tr>
<td><strong>Service Mesh</strong></td>
<td>Istio</td>
<td>mTLS, traffic management</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="key-takeaways">Key Takeaways</h2>
<ol>
<li><strong>Design for failure</strong> - Every service can fail, plan for graceful degradation</li>
<li><strong>Eventual consistency is OK</strong> - Not everything needs ACID transactions</li>
<li><strong>Cache aggressively</strong> - Pre-compute and cache what you can</li>
<li><strong>Async where possible</strong> - Use events to decouple services</li>
<li><strong>Test at scale</strong> - Load test with production-like traffic before sales</li>
<li><strong>Monitor everything</strong> - You can't fix what you can't see</li>
</ol>
