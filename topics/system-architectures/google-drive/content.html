<h1 id="design-google-drive">Design Google Drive</h1>
<nav class="toc" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#problem-statement">Problem Statement</a></li>
<li><a href="#high-level-architecture">High-Level Architecture</a></li>
<li><a href="#file-chunking-strategy">File Chunking Strategy</a></li>
<li><a href="#phase-1-starting-phase">Phase 1: Starting Phase</a></li>
<li><a href="#phase-2-medium-scale">Phase 2: Medium Scale</a></li>
<li><a href="#phase-3-high-scale">Phase 3: High Scale (Google Drive Scale)</a></li>
<li><a href="#aws-technologies-alternatives">AWS Technologies &amp; Alternatives</a></li>
<li><a href="#distributed-systems-considerations">Distributed Systems Considerations</a></li>
<li><a href="#interview-deep-dive-questions">Interview Deep Dive Questions</a></li>
<li><a href="#why-this-technology">Why This Technology?</a></li>
<li><a href="#when-simpler-solutions-work">When Simpler Solutions Work</a></li>
<li><a href="#trade-off-analysis">Trade-off Analysis &amp; Mitigation</a></li>
<li><a href="#edge-cases-failure-modes">Edge Cases &amp; Failure Modes</a></li>
<li><a href="#scaling-strategies">Scaling Strategies</a></li>
<li><a href="#interview-tips">Interview Tips</a></li>
</ul>
</nav>
<hr />
<h2 id="problem-statement-problem-statement">Problem Statement {#problem-statement}</h2>
<p>Design a cloud file storage and synchronization service that allows users to store, share, and sync files across devices.</p>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="core-requirements">Core Requirements</h3>
<ul>
<li><strong>File Storage</strong>: Upload, download, organize files</li>
<li><strong>Sync</strong>: Real-time synchronization across devices</li>
<li><strong>Sharing</strong>: Share files/folders with permissions</li>
<li><strong>Versioning</strong>: File history and rollback</li>
<li><strong>Collaboration</strong>: Real-time editing (Google Docs style)</li>
<li><strong>Offline Access</strong>: Work without internet</li>
</ul>
</div>
<hr />
<h2 id="high-level-architecture-high-level-architecture">High-Level Architecture {#high-level-architecture}</h2>
<div class="flow-diagram" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 style="color: #1d4ed8; text-align: center; margin: 0 0 24px 0">CLOUD STORAGE ARCHITECTURE</h3>
  <!-- Client Layer -->
<div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 24px; flex-wrap: wrap">
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">Desktop App</div>
<div style="font-size: 12px; color: #e5e7eb">(Sync Client)</div>
</div>
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">Mobile Apps</div>
<div style="font-size: 12px; color: #e5e7eb">iOS / Android</div>
</div>
<div style="background: linear-gradient(135deg, #8957e5 0%, #a371f7 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">Web App</div>
<div style="font-size: 12px; color: #e5e7eb">React SPA</div>
</div>
<div style="background: linear-gradient(135deg, #f0883e 0%, #f79862 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">API Clients</div>
<div style="font-size: 12px; color: #e5e7eb">Third-party</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; font-size: 24px; color: #1d4ed8; margin: 16px 0">
<div style="height: 30px; margin: 0 auto; width: 0"></div>
</div>
  <!-- API Gateway -->
<div style="display: flex; justify-content: center; margin-bottom: 24px">
<div style="background: linear-gradient(135deg, #da3633 0%, #f85149 100%); border-radius: 12px; padding: 20px 40px; text-align: center">
<div style="font-weight: bold; color: #ffffff; font-size: 18px">API Gateway</div>
<div style="font-size: 12px; color: #f87171">Auth, Rate Limiting, Routing</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; font-size: 24px; color: #1d4ed8; margin: 16px 0">
<div style="height: 30px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Services Layer -->
<div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 24px; flex-wrap: wrap">
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; text-align: center; min-width: 160px">
<div style="font-weight: bold; color: #f0883e; margin-bottom: 8px">Metadata Service</div>
<div style="font-size: 11px; color: #475569; text-align: left">
        - File info & paths<br>
          - Folder hierarchy<br>
            - Sharing & permissions
</div>
</div>
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; text-align: center; min-width: 160px">
<div style="font-weight: bold; color: #1d4ed8; margin-bottom: 8px">Sync Service</div>
<div style="font-size: 11px; color: #475569; text-align: left">
            - Conflict detection<br>
              - Delta calculation<br>
                - Merge operations
</div>
</div>
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; text-align: center; min-width: 160px">
<div style="font-weight: bold; color: #238636; margin-bottom: 8px">Upload/Download</div>
<div style="font-size: 11px; color: #475569; text-align: left">
                - Chunking logic<br>
                  - Resume support<br>
                    - Progress tracking
</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; font-size: 24px; color: #1d4ed8; margin: 16px 0">
<div style="height: 30px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Data Layer -->
<div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap">
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">PostgreSQL</div>
<div style="font-size: 11px; color: #e5e7eb">(Metadata)</div>
</div>
<div style="background: linear-gradient(135deg, #da3633 0%, #f85149 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">Redis</div>
<div style="font-size: 11px; color: #e5e7eb">(Sync State)</div>
</div>
<div style="background: linear-gradient(135deg, #f0883e 0%, #f79862 100%); border-radius: 12px; padding: 16px 24px; text-align: center; min-width: 140px">
<div style="font-weight: bold; color: #ffffff">S3</div>
<div style="font-size: 11px; color: #e5e7eb">(File Blobs)</div>
</div>
</div>
</div>
<hr />
<h2 id="file-chunking-strategy-file-chunking-strategy">File Chunking Strategy {#file-chunking-strategy}</h2>
<div class="flow-diagram" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h4 style="color: #f0883e; text-align: center; margin: 0 0 24px 0">BLOCK-LEVEL DEDUPLICATION</h4>
  <!-- File Input -->
<div style="display: flex; justify-content: center; margin-bottom: 20px">
<div style="background: linear-gradient(135deg, #8957e5 0%, #a371f7 100%); border-radius: 12px; padding: 16px 32px; text-align: center">
<div style="font-weight: bold; color: #ffffff">File: large_video.mp4</div>
<div style="font-size: 14px; color: #7c3aed">(1GB)</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; color: #1d4ed8; margin: 16px 0">
<div style="height: 30px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Chunking Process Box -->
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #f0883e; margin-bottom: 20px; font-size: 16px">CHUNKING PROCESS</div>
  <!-- Step 1 -->
<div style="margin-bottom: 24px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">1. Split into 4MB chunks</div>
<div style="display: flex; gap: 8px; flex-wrap: wrap">
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C1</div>
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C2</div>
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C3</div>
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C4</div>
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C5</div>
<div style="color: #475569; padding: 8px">...</div>
<div style="background: #238636; color: white; padding: 8px 16px; border-radius: 6px; font-size: 12px">C256</div>
</div>
</div>
  <!-- Step 2 -->
<div style="margin-bottom: 24px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">2. Calculate SHA-256 hash for each chunk</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 13px; color: #475569">
Hash(C1) = <span style="color: #16a34a">abc123</span><br>
Hash(C2) = <span style="color: #16a34a">def456</span><br>
  ...
</div>
</div>
  <!-- Step 3 -->
<div style="margin-bottom: 24px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">3. Check if chunk already exists (dedup)</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px">
<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px">
<span style="color: #16a34a; font-family: monospace">abc123</span>
<span style="color: #f0883e">Already exists, skip upload</span>
</div>
<div style="display: flex; align-items: center; gap: 8px">
<span style="color: #16a34a; font-family: monospace">def456</span>
<span style="color: #1d4ed8">New chunk, upload to S3</span>
</div>
</div>
</div>
  <!-- Step 4 -->
<div>
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">4. Store file manifest</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 13px; color: #7c3aed">
  {<br>
&nbsp;&nbsp;"file_id": "<span style="color: #16a34a">xyz789</span>",<br>
&nbsp;&nbsp;"chunks": ["<span style="color: #2563eb">abc123</span>", "<span style="color: #2563eb">def456</span>", "<span style="color: #2563eb">ghi789</span>", ...]<br>
  }
</div>
</div>
</div>
  <!-- Benefits -->
<div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 20px">
<div style="flex: 1; min-width: 200px; background: #f1f5f9;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #238636; font-weight: bold">Deduplication</div>
<div style="color: #475569; font-size: 13px">Save 40%+ storage across all users</div>
</div>
<div style="flex: 1; min-width: 200px; background: #f1f5f9;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #1d4ed8; font-weight: bold">Resumable Uploads</div>
<div style="color: #475569; font-size: 13px">Only upload remaining chunks</div>
</div>
<div style="flex: 1; min-width: 200px; background: #f1f5f9;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #f0883e; font-weight: bold">Efficient Sync</div>
<div style="color: #475569; font-size: 13px">Only sync changed chunks</div>
</div>
</div>
</div>
<hr />
<h2 id="phase-1-starting-phase-phase-1-starting-phase">Phase 1: Starting Phase {#phase-1-starting-phase}</h2>
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 4px; margin: 20px 0">
<div style="background: #f8fafc; border-radius: 10px; padding: 24px">
<h3 id="assumptions-phase1-assumptions">Assumptions {#phase1-assumptions}</h3>
<pre><code>- **Users**: 1,000 - 50,000
- **Storage**: 100GB - 10TB total
- **Files**: Mostly small files (&lt; 100MB)
- **Budget**: $500 - $3,000/month
</code></pre>
<h3 id="monolithic-architecture-monolithic-architecture">Monolithic Architecture {#monolithic-architecture}</h3>
<pre><code class="language-python"># Simple file storage service
class FileService:
def __init__(self, s3_client, db):
self.s3 = s3_client
self.db = db

def upload_file(self, user_id, file_path, content):
# Generate unique file ID
file_id = str(uuid4())

# Upload to S3 (single file, no chunking yet)
s3_key = f&quot;{user_id}/{file_id}&quot;
self.s3.put_object(
Bucket='files',
Key=s3_key,
Body=content
)

# Store metadata
self.db.execute(&quot;&quot;&quot;
INSERT INTO files (id, user_id, path, s3_key, size, created_at)
VALUES (%s, %s, %s, %s, %s, NOW())
&quot;&quot;&quot;, file_id, user_id, file_path, s3_key, len(content))

return file_id

def download_file(self, user_id, file_id):
# Check permission
file = self.db.query_one(
&quot;SELECT * FROM files WHERE id = %s AND user_id = %s&quot;,
file_id, user_id
)

if not file:
raise PermissionError()

# Get from S3
response = self.s3.get_object(Bucket='files', Key=file.s3_key)
return response['Body'].read()</code></pre>
<h4 id="simple-sync-protocol-simple-sync-protocol">Simple Sync Protocol {#simple-sync-protocol}</h4>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #1d4ed8; margin-bottom: 20px; font-size: 16px">POLLING-BASED SYNC</div>
<div style="color: #475569; margin-bottom: 16px">Client polls every 30 seconds:</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 13px; margin-bottom: 16px">
<span style="color: #16a34a">GET</span> <span style="color: #2563eb">/api/sync/changes?since=timestamp</span>
</div>
<div style="color: #475569; margin-bottom: 8px">Response:</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 13px; color: #7c3aed">
  {<br>
  &nbsp;&nbsp;"changes": [<br>
&nbsp;&nbsp;&nbsp;&nbsp;{"path": "<span style="color: #16a34a">/docs/a.txt</span>", "action": "<span style="color: #f0883e">modify</span>"},<br>
&nbsp;&nbsp;&nbsp;&nbsp;{"path": "<span style="color: #16a34a">/images/b.png</span>", "action": "<span style="color: #f85149">delete</span>"}<br>
  &nbsp;&nbsp;],<br>
&nbsp;&nbsp;"cursor": "<span style="color: #2563eb">new_timestamp</span>"<br>
  }
</div>
<div style="color: #1d4ed8; margin-top: 16px; font-style: italic">Client downloads changed files based on response</div>
</div>
</div>
</div>
<hr />
<h2 id="phase-2-medium-scale-phase-2-medium-scale">Phase 2: Medium Scale {#phase-2-medium-scale}</h2>
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 12px; padding: 4px; margin: 20px 0">
<div style="background: #f8fafc; border-radius: 10px; padding: 24px">
<h3 id="assumptions-phase2-assumptions">Assumptions {#phase2-assumptions}</h3>
<pre><code>- **Users**: 1M - 10M
- **Storage**: 100PB+
- **Uploads**: 10K files/second
- **Budget**: $200K - $1M/month
</code></pre>
<h3 id="microservices-with-chunking-microservices-with-chunking">Microservices with Chunking {#microservices-with-chunking}</h3>
<div class="flow-diagram" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 16px 0">
  <!-- API Gateway -->
<div style="display: flex; justify-content: center; margin-bottom: 20px">
<div style="background: linear-gradient(135deg, #da3633 0%, #f85149 100%); border-radius: 12px; padding: 16px 32px; text-align: center">
<div style="font-weight: bold; color: #ffffff">API Gateway</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Services Row -->
<div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 20px; flex-wrap: wrap">
<div style="background: #f1f5f9;border-radius: 12px; padding: 16px; text-align: center; min-width: 120px">
<div style="font-weight: bold; color: #f0883e">Metadata</div>
<div style="font-size: 11px; color: #475569">Service</div>
</div>
<div style="background: #f1f5f9;border-radius: 12px; padding: 16px; text-align: center; min-width: 120px">
<div style="font-weight: bold; color: #1d4ed8">Upload</div>
<div style="font-size: 11px; color: #475569">Service</div>
</div>
<div style="background: #f1f5f9;border-radius: 12px; padding: 16px; text-align: center; min-width: 120px">
<div style="font-weight: bold; color: #238636">Sync</div>
<div style="font-size: 11px; color: #475569">Service</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Chunk Service -->
<div style="display: flex; justify-content: center; margin-bottom: 20px">
<div style="background: linear-gradient(135deg, #8957e5 0%, #a371f7 100%); border-radius: 12px; padding: 16px 32px; text-align: center">
<div style="font-weight: bold; color: #ffffff">Chunk Service</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Blob Storage -->
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; text-align: center">
<div style="font-weight: bold; color: #f0883e; margin-bottom: 12px">BLOB STORAGE</div>
<div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap">
<div style="background: #f0883e; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold">S3 US</div>
<div style="background: #f0883e; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold">S3 EU</div>
<div style="background: #f0883e; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold">S3 AP</div>
</div>
</div>
  <!-- Bottom Data Stores -->
<div style="display: flex; justify-content: space-between; margin-top: 20px; flex-wrap: wrap; gap: 16px">
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 12px; padding: 12px 24px; text-align: center">
<div style="font-weight: bold; color: #ffffff">PostgreSQL</div>
<div style="font-size: 11px; color: #e5e7eb">Cluster</div>
</div>
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 12px 24px; text-align: center">
<div style="font-weight: bold; color: #ffffff">Kafka</div>
<div style="font-size: 11px; color: #e5e7eb">Events</div>
</div>
</div>
</div>
<h3 id="delta-sync-algorithm-delta-sync-algorithm">Delta Sync Algorithm {#delta-sync-algorithm}</h3>
<pre><code class="language-python">class DeltaSyncService:
&quot;&quot;&quot;
Only sync changed bytes, not entire files.
Uses rolling checksum (rsync algorithm).
&quot;&quot;&quot;

def calculate_delta(self, old_chunks, new_content):
&quot;&quot;&quot;
Compare new content against old chunks.
Return only the differences.
&quot;&quot;&quot;
CHUNK_SIZE = 4 * 1024 * 1024  # 4MB

old_hashes = {chunk.hash: chunk for chunk in old_chunks}
new_chunks = []
delta = []

# Rolling hash to find matching blocks
for i in range(0, len(new_content), CHUNK_SIZE):
chunk_data = new_content[i:i + CHUNK_SIZE]
chunk_hash = sha256(chunk_data)

if chunk_hash in old_hashes:
# Reuse existing chunk
new_chunks.append(old_hashes[chunk_hash])
else:
# New chunk, need to upload
new_chunks.append(Chunk(hash=chunk_hash, data=chunk_data))
delta.append({
'offset': i,
'hash': chunk_hash,
'data': chunk_data
})

return new_chunks, delta

def apply_delta(self, file_id, delta):
&quot;&quot;&quot;
Apply delta to reconstruct file on client.
&quot;&quot;&quot;
for change in delta:
# Upload new chunk to S3
self.s3.put_object(
Bucket='chunks',
Key=change['hash'],
Body=change['data']
)

# Update file manifest
self.update_manifest(file_id, delta)</code></pre>
<h3 id="conflict-resolution-conflict-resolution">Conflict Resolution {#conflict-resolution}</h3>
<div class="flow-diagram" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 12px; padding: 24px; margin: 16px 0">
  <!-- Three-way diagram -->
<div style="display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; gap: 16px; align-items: start; margin-bottom: 24px">
  <!-- Device A -->
<div style="text-align: center">
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 12px; margin-bottom: 12px">
<div style="font-weight: bold; color: #ffffff">Device A</div>
</div>
<div style="background: #f1f5f9; border-radius: 8px; padding: 12px; font-size: 12px; color: #475569">
  Edit file.txt<br>
<span style="color: #16a34a">"Hello World"</span>
</div>
</div>
  <!-- Arrow -->
<div style="color: #1d4ed8; font-size: 24px; padding-top: 40px">--></div>
  <!-- Server -->
<div style="text-align: center">
<div style="background: linear-gradient(135deg, #da3633 0%, #f85149 100%); border-radius: 12px; padding: 12px; margin-bottom: 12px">
<div style="font-weight: bold; color: #ffffff">Server</div>
</div>
<div style="background: #f1f5f9; border-radius: 8px; padding: 12px; font-size: 12px">
<div style="color: #16a34a">Accept A (v1 -> v2)</div>
<div style="color: #f85149; margin-top: 8px; font-weight: bold">CONFLICT!</div>
</div>
</div>
  <!-- Arrow -->
<div style="color: #1d4ed8; font-size: 24px; padding-top: 40px"><--</div>
  <!-- Device B -->
<div style="text-align: center">
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 12px; padding: 12px; margin-bottom: 12px">
<div style="font-weight: bold; color: #ffffff">Device B</div>
</div>
<div style="background: #f1f5f9; border-radius: 8px; padding: 12px; font-size: 12px; color: #475569">
  Edit file.txt<br>
<span style="color: #2563eb">"Hello Earth"</span>
</div>
</div>
</div>
  <!-- Resolution Strategies -->
<div style="display: flex; gap: 16px; flex-wrap: wrap">
<div style="flex: 1; min-width: 200px; background: #f1f5f9;padding: 16px; border-radius: 0 8px 8px 0">
<div style="color: #238636; font-weight: bold; margin-bottom: 8px">Strategy 1: Keep Both</div>
<div style="font-size: 12px; color: #475569">
  file.txt<br>
  file (conflict from Device B).txt
</div>
</div>
<div style="flex: 1; min-width: 200px; background: #f1f5f9;padding: 16px; border-radius: 0 8px 8px 0">
<div style="color: #f0883e; font-weight: bold; margin-bottom: 8px">Strategy 2: Last Write Wins</div>
<div style="font-size: 12px; color: #475569">
  Use timestamp to determine winner<br>
  (with warning to other user)
</div>
</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="phase-3-high-scale-google-drive-scale-phase-3-high-scale">Phase 3: High Scale (Google Drive Scale) {#phase-3-high-scale}</h2>
<div style="background: linear-gradient(135deg, #8957e5 0%, #a371f7 100%); border-radius: 12px; padding: 4px; margin: 20px 0">
<div style="background: #f8fafc; border-radius: 10px; padding: 24px">
<h3 id="assumptions-phase3-assumptions">Assumptions {#phase3-assumptions}</h3>
<pre><code>- **Users**: 1B+
- **Storage**: Exabytes
- **Uploads**: 1M files/second
- **Team**: 500+ engineers
</code></pre>
<h3 id="global-architecture-global-architecture">Global Architecture {#global-architecture}</h3>
<div class="flow-diagram" style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #a371f7; font-size: 18px; margin-bottom: 24px">GLOBAL FILE STORAGE INFRASTRUCTURE</div>
  <!-- Edge Layer -->
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; margin-bottom: 20px">
<div style="text-align: center; font-weight: bold; color: #1d4ed8; margin-bottom: 16px">EDGE LAYER</div>
<div style="display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 16px">
<div style="background: #58a6ff; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px">Edge US-East</div>
<div style="background: #58a6ff; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px">Edge EU-West</div>
<div style="background: #58a6ff; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px">Edge AP-South</div>
<div style="background: #58a6ff; color: #0d1117; padding: 8px 16px; border-radius: 8px; font-weight: bold; font-size: 12px">Edge SA-East</div>
</div>
<div style="text-align: center; font-size: 12px; color: #475569">
  Upload acceleration | Hot file caching | Thumbnail serving
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Control Plane -->
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px; margin-bottom: 20px">
<div style="text-align: center; font-weight: bold; color: #f0883e; margin-bottom: 16px">CONTROL PLANE</div>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px">
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Metadata</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Quota</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Permission</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Sync</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Collab</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 12px; text-align: center">
<div style="color: #f0883e; font-weight: bold; font-size: 12px">Search</div>
<div style="color: #475569; font-size: 10px">Service</div>
</div>
</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Data Plane -->
<div style="background: #f1f5f9;border-radius: 12px; padding: 20px">
<div style="text-align: center; font-weight: bold; color: #238636; margin-bottom: 16px">DATA PLANE - DISTRIBUTED BLOB STORE</div>
<div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; margin-bottom: 16px">
<div style="background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%); border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #ffffff; font-weight: bold">Cold Storage</div>
<div style="font-size: 10px; color: #e5e7eb">(Glacier)</div>
</div>
<div style="background: linear-gradient(135deg, #f0883e 0%, #f79862 100%); border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #ffffff; font-weight: bold">Warm Storage</div>
<div style="font-size: 10px; color: #e5e7eb">(S3)</div>
</div>
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #ffffff; font-weight: bold">Hot Storage</div>
<div style="font-size: 10px; color: #e5e7eb">(SSD)</div>
</div>
</div>
<div style="text-align: center; font-size: 12px; color: #475569">
  3+ replicas across regions | Erasure coding: 1.5x overhead | 11 nines durability
</div>
</div>
</div>
<h3 id="storage-tiering-storage-tiering">Storage Tiering {#storage-tiering}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #a371f7; margin-bottom: 20px; font-size: 16px">INTELLIGENT TIERING</div>
<div style="display: flex; flex-direction: column; gap: 16px">
  <!-- Hot Tier -->
<div style="background: linear-gradient(90deg, #238636 0%, transparent 100%); border-radius: 8px; padding: 16px">
<div style="display: flex; justify-content: space-between; align-items: center">
<div>
<div style="color: #16a34a; font-weight: bold">HOT TIER (SSD, Edge Cache)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Recently accessed files (< 7 days), frequently accessed files</div>
</div>
<div style="color: #16a34a; font-weight: bold">$0.10/GB/mo</div>
</div>
</div>
  <!-- Warm Tier -->
<div style="background: linear-gradient(90deg, #f0883e 0%, transparent 100%); border-radius: 8px; padding: 16px">
<div style="display: flex; justify-content: space-between; align-items: center">
<div>
<div style="color: #f0883e; font-weight: bold">WARM TIER (Standard S3)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Occasional access (7-90 days), user's active files</div>
</div>
<div style="color: #f0883e; font-weight: bold">$0.023/GB/mo</div>
</div>
</div>
  <!-- Cold Tier -->
<div style="background: linear-gradient(90deg, #1f6feb 0%, transparent 100%); border-radius: 8px; padding: 16px">
<div style="display: flex; justify-content: space-between; align-items: center">
<div>
<div style="color: #1d4ed8; font-weight: bold">COLD TIER (S3 Glacier)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Rarely accessed (> 90 days), archived files</div>
</div>
<div style="color: #1d4ed8; font-weight: bold">$0.004/GB/mo</div>
</div>
</div>
  <!-- Archive Tier -->
<div style="background: linear-gradient(90deg, #8957e5 0%, transparent 100%); border-radius: 8px; padding: 16px">
<div style="display: flex; justify-content: space-between; align-items: center">
<div>
<div style="color: #a371f7; font-weight: bold">ARCHIVE TIER (Glacier Deep Archive)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Compliance/legal hold, 12+ hour retrieval time</div>
</div>
<div style="color: #a371f7; font-weight: bold">$0.001/GB/mo</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="aws-technologies--alternatives-aws-technologies-alternatives">AWS Technologies &amp; Alternatives {#aws-technologies-alternatives}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<table>
<thead>
<tr>
<th>Component</th>
<th>AWS Service</th>
<th>Alternative</th>
<th>Trade-offs</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Blob Storage</strong></td>
<td>S3</td>
<td>GCS, Minio, Ceph</td>
<td>S3: Mature ecosystem, Others: Cost/control</td>
</tr>
<tr>
<td><strong>Metadata DB</strong></td>
<td>Aurora PostgreSQL</td>
<td>CockroachDB, Vitess</td>
<td>Aurora: Managed, Cockroach: Multi-region</td>
</tr>
<tr>
<td><strong>Sync State</strong></td>
<td>ElastiCache Redis</td>
<td>DynamoDB Streams</td>
<td>Redis: Speed, DynamoDB: Durability</td>
</tr>
<tr>
<td><strong>Search</strong></td>
<td>OpenSearch</td>
<td>Elasticsearch</td>
<td>OpenSearch: Managed, ES: More features</td>
</tr>
<tr>
<td><strong>CDN</strong></td>
<td>CloudFront</td>
<td>Cloudflare</td>
<td>CloudFront: Integration, CF: Edge compute</td>
</tr>
<tr>
<td><strong>Archive</strong></td>
<td>Glacier</td>
<td>Backblaze B2</td>
<td>Glacier: Integration, B2: Cost</td>
</tr>
</tbody>
</table>
</div>
<hr />
<h2 id="distributed-systems-considerations-distributed-systems-considerations">Distributed Systems Considerations {#distributed-systems-considerations}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 id="1-consistency-model-consistency-model">1. Consistency Model {#consistency-model}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #1d4ed8; margin-bottom: 20px; font-size: 16px">CONSISTENCY GUARANTEES</div>
<div style="display: flex; flex-direction: column; gap: 16px">
<div style="background: #f8fafc;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #238636; font-weight: bold">Metadata (PostgreSQL)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Strong consistency | Synchronous replication</div>
</div>
<div style="background: #f8fafc;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #f0883e; font-weight: bold">File Content (S3)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Read-after-write consistency | Eventual consistency for listing</div>
</div>
<div style="background: #f8fafc;padding: 12px 16px; border-radius: 0 8px 8px 0">
<div style="color: #f85149; font-weight: bold">Sync State (Redis)</div>
<div style="font-size: 12px; color: #475569; margin-top: 4px">Best-effort delivery | Client reconciliation</div>
</div>
</div>
</div>
<h3 id="2-deduplication-at-scale-deduplication-at-scale">2. Deduplication at Scale {#deduplication-at-scale}</h3>
<pre><code class="language-python">class GlobalDeduplicationService:
&quot;&quot;&quot;
Cross-user deduplication saves 40%+ storage.
Uses content-addressable storage.
&quot;&quot;&quot;

def store_chunk(self, chunk_hash, chunk_data, uploader_id):
# Check if chunk already exists
existing = self.chunk_index.get(chunk_hash)

if existing:
# Increment reference count
self.chunk_index.increment_refs(chunk_hash)
return existing.s3_key
else:
# Store new chunk
s3_key = f&quot;chunks/{chunk_hash[:2]}/{chunk_hash}&quot;
self.s3.put_object(Bucket='chunks', Key=s3_key, Body=chunk_data)

# Index the chunk
self.chunk_index.set(chunk_hash, {
's3_key': s3_key,
'ref_count': 1,
'size': len(chunk_data)
})

return s3_key

def delete_chunk_reference(self, chunk_hash):
# Decrement reference count
refs = self.chunk_index.decrement_refs(chunk_hash)

if refs == 0:
# No more references, schedule deletion
self.deletion_queue.add(chunk_hash)</code></pre>
<h3 id="3-quota-management-quota-management">3. Quota Management {#quota-management}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #f0883e; margin-bottom: 20px; font-size: 16px">QUOTA SERVICE</div>
<div style="display: flex; flex-direction: column; gap: 16px">
<div style="background: #f8fafc; border-radius: 8px; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Pre-upload check:</div>
<div style="font-family: monospace; font-size: 13px; color: #2563eb; background: #f1f5f9; padding: 8px; border-radius: 4px">
  current_usage + file_size <= quota
</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 16px">
<div style="color: #f0883e; font-weight: bold; margin-bottom: 8px">Async usage calculation:</div>
<div style="font-size: 12px; color: #475569">
                                                    - Background job recalculates usage<br>
                                                      - Handles dedup credits<br>
                                                        - Syncs with billing
</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 8px">Redis for fast checks:</div>
<div style="font-family: monospace; font-size: 13px; color: #f85149">
  INCRBY user:quota:123 file_size
</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="interview-deep-dive-questions-interview-deep-dive-questions">Interview Deep Dive Questions {#interview-deep-dive-questions}</h2>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="1-why-chunking-instead-of-whole-file-upload-q1-chunking">1. &quot;Why chunking instead of whole file upload?&quot; {#q1-chunking}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>What They're Probing</strong>: Do you understand the trade-offs of complexity vs. efficiency at scale?</p>
<p><strong>Strong Answer - Step by Step Explanation</strong>:</p>
<p><strong>Step 1: Understanding the Problem with Whole-File Uploads</strong></p>
<p>When a user uploads a 500MB video file over a typical home connection (50 Mbps), it takes approximately 80 seconds. If the connection drops at 90% (450MB uploaded), the user must restart from zero - wasting both time and bandwidth.</p>
<p><strong>Step 2: How Chunking Solves Resumability</strong></p>
<p>With 4MB chunks, that 500MB file becomes 125 chunks. Here's what happens:<br />
- Chunk 1 uploads successfully -&gt; Server confirms receipt<br />
- Chunk 2 uploads successfully -&gt; Server confirms receipt<br />
- ... Connection drops at chunk 113 (452MB transferred)<br />
- User reconnects -&gt; Client asks &quot;which chunks do you have?&quot;<br />
- Server responds &quot;chunks 1-112&quot; -&gt; Client resumes from chunk 113<br />
- Only 48MB remaining instead of restarting 500MB</p>
<p><strong>Real-world Example</strong>: When a user edits a 10MB PowerPoint document and adds one slide, without chunking we re-upload all 10MB. With 4MB chunks:<br />
- Original file: 3 chunks [A, B, C]<br />
- After edit: 3 chunks [A, B', C] - only chunk B changed<br />
- Delta sync uploads only chunk B' (4MB) instead of 10MB = 60% bandwidth savings</p>
<p><strong>Step 3: Deduplication Math</strong></p>
<p>Block size of 4MB means:<br />
- A 1GB file = 256 chunks<br />
- SHA-256 hash for each chunk = 32 bytes per chunk identifier<br />
- Chunk manifest = 256 * 32 = 8KB metadata overhead per file</p>
<p><strong>Cross-user deduplication scenario</strong>:<br />
- Company sends 50MB PDF to 1,000 employees via Google Drive share<br />
- Without dedup: 50GB stored (50MB x 1,000 copies)<br />
- With dedup: 50MB stored (one copy, 1,000 pointers)<br />
- Storage savings: 99.9%</p>
<p><strong>Industry data</strong>: Dropbox reported 75% of uploaded chunks already exist in their storage, reducing storage costs from $23/GB to effectively $5.75/GB.</p>
<p><strong>Step 4: Parallel Upload Benefits</strong></p>
<p>With chunking, a 100MB file (25 chunks) can upload 4 chunks simultaneously:<br />
- Sequential upload at 50 Mbps: 16 seconds<br />
- 4-parallel upload: 4 seconds<br />
- This is why Dropbox feels faster than FTP</p>
<p><strong>When Simpler Works</strong>:</p>
<blockquote>
<p>&quot;For files under 100MB and &lt; 10K total files, whole-file upload is fine. The complexity of chunking isn't worth it. S3's multipart upload handles resumability for larger files without custom chunking logic. I'd only implement custom chunking when we have:</p>
<ul>
<li>Users uploading files &gt; 100MB regularly</li>
<li>Need for cross-user deduplication (saves 40%+ at scale)</li>
<li>Requirement for delta sync (frequently edited files)&quot;</li>
</ul>
</blockquote>
</div>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="2-how-do-you-handle-conflicts-in-collaborative-editing-q2-conflicts">2. &quot;How do you handle conflicts in collaborative editing?&quot; {#q2-conflicts}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>What They're Probing</strong>: Understanding of distributed systems, CAP theorem, and user experience trade-offs.</p>
<p><strong>Strong Answer - Real Conflict Scenarios</strong>:</p>
<p><strong>Scenario 1: The Classic Two-Device Conflict</strong></p>
<p>Alice has &quot;report.docx&quot; open on her laptop and phone:</p>
<ol>
<li><strong>11:00 AM</strong> - Both devices sync, have version v5 (base version)</li>
<li><strong>11:05 AM</strong> - Alice edits on laptop while on train (offline), saves as v6-laptop</li>
<li><strong>11:10 AM</strong> - Alice edits on phone (has cell signal), saves as v6-phone -&gt; Server accepts this as v6</li>
<li><strong>11:30 AM</strong> - Laptop reconnects, tries to push v6-laptop</li>
</ol>
<p><strong>Conflict detected!</strong> Server has v6-phone, laptop is pushing v6-laptop, both based on v5.</p>
<p><strong>Resolution Strategy by File Type</strong>:</p>
<div style="background: #f1f5f9; border-radius: 8px; padding: 16px; margin: 16px 0">
<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px">
<div style="color: #f0883e; font-weight: bold">Binary files (images, videos):</div>
<div style="color: #475569">
  Create conflict copy: "report.docx" and "report (conflict from MacBook).docx"<br>
  Why: Binary diffs are meaningless to users, let them manually choose
</div>
<div style="color: #1d4ed8; font-weight: bold">Text/documents:</div>
<div style="color: #475569">
  Three-way merge: Compare v5 (base), v6-laptop, v6-phone<br>
  Auto-merge non-overlapping changes, mark conflicts for overlapping
</div>
<div style="color: #238636; font-weight: bold">Real-time docs (Google Docs):</div>
<div style="color: #475569">
  Operational Transform (OT): Every keystroke is an operation with position<br>
  Operations transform against each other to maintain consistency
</div>
</div>
</div>
<p><strong>Scenario 2: Delete vs Edit Conflict</strong></p>
<ol>
<li>Bob opens &quot;budget.xlsx&quot; on his laptop</li>
<li>While Bob is editing, Alice deletes the file from web UI</li>
<li>Bob saves his changes</li>
</ol>
<p><strong>Resolution options</strong>:<br />
- <strong>Option A (Dropbox style)</strong>: Bob's edit &quot;resurrects&quot; the file - his version wins<br />
- <strong>Option B (Google Drive style)</strong>: File stays deleted, Bob sees &quot;File no longer exists&quot; error<br />
- <strong>Option C (Hybrid)</strong>: Move Bob's version to his trash with message &quot;This file was deleted while you were editing&quot;</p>
<p><strong>Scenario 3: Folder Rename + File Edit</strong></p>
<ol>
<li>File is at <code>/Projects/Q1/report.docx</code></li>
<li>Alice renames folder to <code>/Projects/2024-Q1/</code></li>
<li>Meanwhile Bob (offline) edits <code>/Projects/Q1/report.docx</code></li>
<li>Bob reconnects</li>
</ol>
<p><strong>The path no longer exists!</strong> Resolution:<br />
- Track files by unique ID, not path<br />
- When Bob syncs, server says &quot;file abc123 moved to /Projects/2024-Q1/&quot;<br />
- Bob's edit applies to new path automatically</p>
<p><strong>Conflict Resolution Code Example</strong>:</p>
<pre><code class="language-python">def resolve_conflict(base_version, version_a, version_b, file_type):
if file_type in ['jpg', 'png', 'mp4', 'pdf']:
# Binary: create conflict copy
return ConflictCopy(version_a, version_b)

if file_type in ['txt', 'md', 'json']:
# Text: attempt three-way merge
merged, conflicts = three_way_merge(base_version, version_a, version_b)
if conflicts:
return MergeWithConflictMarkers(merged, conflicts)
return merged

# Default: last-write-wins with notification
winner = version_a if version_a.timestamp &gt; version_b.timestamp else version_b
loser = version_b if winner == version_a else version_a
notify_user(loser.author, f&quot;Your changes were superseded by {winner.author}&quot;)
return winner</code></pre>
<p><strong>Key Insight</strong>: &quot;Google Docs uses Operational Transform because users expect real-time character-by-character sync. Dropbox uses conflict copies because file-level sync is simpler and users don't expect real-time binary file collaboration. The choice depends on user expectations, not technical elegance.&quot;</p>
<p><strong>When Simpler Works</strong>:</p>
<blockquote>
<p>&quot;For most apps, last-write-wins with a 'version history' feature is enough. Users rarely have true conflicts - most 'conflicts' are the same person on two devices. Version history lets them recover if needed. Only invest in OT/CRDT if real-time collaboration is core to your product.&quot;</p>
</blockquote>
</div>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="3-why-not-just-use-s3-directly-for-everything-q3-s3-directly">3. &quot;Why not just use S3 directly for everything?&quot; {#q3-s3-directly}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>What They're Probing</strong>: Do you understand why abstractions exist and when they're necessary?</p>
<p><strong>Strong Answer - S3 Limitations Explained</strong>:</p>
<p><strong>Limitation 1: No Real File Hierarchy</strong></p>
<p>S3 is a flat key-value store. When you see &quot;folders&quot; in S3, it's a UI illusion:<br />
- Key: <code>users/alice/documents/report.docx</code><br />
- This is ONE key, not a folder structure</p>
<p><strong>Real-world problem</strong>: &quot;List all files in Alice's documents folder&quot;<br />
- S3 approach: <code>LIST Prefix=users/alice/documents/</code> - scans ALL matching keys<br />
- Cost: $0.005 per 1,000 LIST requests<br />
- At 1 million files per user: listing one folder = $5 and 10+ seconds</p>
<p><strong>With metadata database</strong>:<br />
<code>sql SELECT * FROM files WHERE user_id = 'alice' AND parent_folder_id = 'doc-folder-123' -- Returns in 5ms using index, costs nothing extra </code></p>
<p><strong>Limitation 2: No Native Sharing/Permissions</strong></p>
<p>Scenario: Alice shares a folder with Bob (read-only) and Carol (can edit)</p>
<p>S3 has no concept of this. You'd need to:<br />
- Store ACLs somewhere (where? Another S3 object? Slow to check)<br />
- Generate presigned URLs for every access (expires, can be shared)<br />
- Implement permission checks in every API call</p>
<p><strong>With proper metadata layer</strong>:<br />
<code>sql -- One query to check permission SELECT permission FROM shares WHERE resource_id = 'file-123' AND user_id = 'bob' -- Returns 'read' in 2ms </code></p>
<p><strong>Limitation 3: No Content Search</strong></p>
<p>User types &quot;quarterly revenue&quot; in search box:<br />
- S3: No capability to search file contents<br />
- You must: Download every file, extract text, build search index elsewhere<br />
- At scale (1 billion files), this is a separate ElasticSearch cluster anyway</p>
<p><strong>Limitation 4: Sync State is Impossible in S3</strong></p>
<p>Client asks: &quot;What changed since my last sync (timestamp: 2024-01-15T10:30:00Z)?&quot;</p>
<p>S3 has no &quot;get objects modified after X&quot; query:<br />
- You'd LIST all objects and filter by LastModified - extremely slow at scale<br />
- No way to get deleted objects (they're gone!)</p>
<p><strong>With metadata database + change log</strong>:<br />
<code>sql SELECT * FROM file_changes WHERE user_id = 'alice' AND changed_at &gt; '2024-01-15T10:30:00Z' ORDER BY changed_at -- Returns changes in 10ms, includes deletions </code></p>
<p><strong>However, S3 is Perfect For</strong>:</p>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Why S3 Excels</th>
</tr>
</thead>
<tbody>
<tr>
<td>Blob storage</td>
<td>11 nines durability, infinite scale, $0.023/GB</td>
</tr>
<tr>
<td>Direct downloads</td>
<td>Signed URLs offload bandwidth from your servers</td>
</tr>
<tr>
<td>Archive/backup</td>
<td>Glacier at $0.004/GB is cheapest reliable storage</td>
</tr>
<tr>
<td>Static assets</td>
<td>CloudFront + S3 for global distribution</td>
</tr>
</tbody>
</table>
<p><strong>Architecture Split</strong>:<br />
- <strong>S3</strong>: Store the actual file bytes (chunks)<br />
- <strong>PostgreSQL</strong>: Store metadata (paths, permissions, versions, sync state)<br />
- <strong>Redis</strong>: Cache hot sync state for real-time updates<br />
- <strong>ElasticSearch</strong>: Full-text search of file contents</p>
<p><strong>When S3 Alone Works</strong>:</p>
<blockquote>
<p>&quot;For a simple file sharing app with &lt; 100K files, you CAN use S3 directly with DynamoDB for metadata. No chunking, no sync service. Just presigned URLs for upload/download. This handles 90% of use cases for $150/month. I'd only add complexity when we need real sync, dedup, or search.&quot;</p>
</blockquote>
</div>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="4-how-would-you-implement-offline-support-q4-offline-support">4. &quot;How would you implement offline support?&quot; {#q4-offline-support}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>What They're Probing</strong>: Client-side architecture, eventual consistency, and sync complexity.</p>
<p><strong>Strong Answer - Complete Offline Architecture</strong>:</p>
<p><strong>The Three Components of Offline Support</strong>:</p>
<div style="display: flex; gap: 16px; flex-wrap: wrap; margin: 16px 0">
<div style="flex: 1; min-width: 200px; background: #f1f5f9;border-radius: 12px; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">1. Local Metadata Store</div>
<div style="font-size: 12px; color: #475569">SQLite database tracking file state</div>
</div>
<div style="flex: 1; min-width: 200px; background: #f1f5f9;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 8px">2. File System Watcher</div>
<div style="font-size: 12px; color: #475569">Detects local changes in real-time</div>
</div>
<div style="flex: 1; min-width: 200px; background: #f1f5f9;border-radius: 12px; padding: 16px">
<div style="color: #f0883e; font-weight: bold; margin-bottom: 8px">3. Sync Queue</div>
<div style="font-size: 12px; color: #475569">Pending changes to upload on reconnect</div>
</div>
</div>
<p><strong>Step 1: Local SQLite Database Schema</strong></p>
<pre><code class="language-sql">CREATE TABLE local_files (
file_path TEXT PRIMARY KEY,
local_hash TEXT,           -- Hash of local file
server_hash TEXT,          -- Last known server hash
server_version INTEGER,    -- Server version number
sync_status TEXT,          -- 'synced', 'pending_upload', 'pending_download', 'conflict'
last_modified TIMESTAMP,
last_sync TIMESTAMP
);

CREATE TABLE pending_changes (
id INTEGER PRIMARY KEY,
file_path TEXT,
change_type TEXT,          -- 'create', 'modify', 'delete', 'move'
old_path TEXT,             -- For moves/renames
queued_at TIMESTAMP,
retry_count INTEGER DEFAULT 0
);</code></pre>
<p><strong>Step 2: File System Watcher Implementation</strong></p>
<pre><code class="language-python"># Using FSEvents (Mac), inotify (Linux), or ReadDirectoryChangesW (Windows)

class FileWatcher:
def __init__(self, sync_folder, db):
self.sync_folder = sync_folder
self.db = db

def on_file_changed(self, event_path, event_type):
# Debounce: wait 500ms for file to stop changing
time.sleep(0.5)

local_hash = calculate_hash(event_path)
server_hash = self.db.get_server_hash(event_path)

if local_hash != server_hash:
# File has local changes not on server
self.db.execute(&quot;&quot;&quot;
INSERT INTO pending_changes (file_path, change_type, queued_at)
VALUES (?, 'modify', datetime('now'))
&quot;&quot;&quot;, event_path)

self.db.execute(&quot;&quot;&quot;
UPDATE local_files SET sync_status = 'pending_upload'
WHERE file_path = ?
&quot;&quot;&quot;, event_path)</code></pre>
<p><strong>Step 3: Sync Engine on Reconnect</strong></p>
<p>When network comes back, the sync engine runs this algorithm:</p>
<pre><code class="language-python">def sync_on_reconnect(self):
# Step 1: Get server changes since last sync
last_sync = self.db.get_last_sync_timestamp()
server_changes = self.api.get_changes(since=last_sync)

# Step 2: Get local pending changes
local_changes = self.db.query(&quot;SELECT * FROM pending_changes ORDER BY queued_at&quot;)

# Step 3: Detect conflicts
for server_change in server_changes:
local_change = find_matching_local_change(server_change.path, local_changes)

if local_change:
# CONFLICT: Both server and local changed same file
if server_change.type == 'delete' and local_change.type == 'modify':
# Server deleted, user edited -&gt; User probably wants to keep their edit
# Re-upload as new file
self.upload_as_new(local_change.path)
elif server_change.type == 'modify' and local_change.type == 'modify':
# Both modified -&gt; Create conflict copy
self.create_conflict_copy(local_change.path, server_change.version)
elif server_change.type == 'modify' and local_change.type == 'delete':
# Server modified, user deleted -&gt; Restore server version
self.download_server_version(server_change)

# Step 4: Apply non-conflicting changes
for server_change in server_changes:
if not has_conflict(server_change):
if server_change.type == 'modify':
self.download_file(server_change)
elif server_change.type == 'delete':
self.delete_local_file(server_change.path)

for local_change in local_changes:
if not has_conflict(local_change):
self.upload_file(local_change)</code></pre>
<p><strong>Real-World Scenario: 2 Hours Offline on a Flight</strong></p>
<ol>
<li>User boards plane with laptop, internet disconnects</li>
<li>User edits 5 documents, creates 2 new files, deletes 1 folder</li>
<li>Meanwhile, teammate makes changes to 2 of those same documents</li>
<li>Plane lands, laptop reconnects</li>
</ol>
<p><strong>What happens</strong>:<br />
- Sync engine detects 8 pending local changes<br />
- Fetches 15 server changes (teammate's edits + other team activity)<br />
- Finds 2 conflicts (same documents edited)<br />
- Downloads 13 non-conflicting server changes<br />
- Uploads 6 non-conflicting local changes<br />
- Creates 2 conflict copies with clear naming<br />
- Shows notification: &quot;2 files had conflicts - copies created&quot;</p>
<p><strong>Key Insight</strong>: &quot;The hard part isn't the offline editing - it's the reconnection. You need to handle: files edited on both sides, files deleted remotely but edited locally, folder renames that conflict, and atomic moves. Dropbox spent years perfecting this and still has edge cases.&quot;</p>
<p><strong>When Simpler Works</strong>:</p>
<blockquote>
<p>&quot;For web-only apps, skip offline entirely. For mobile apps, cache recently accessed files read-only. Full offline editing with sync is a massive engineering investment (6+ months for 2 engineers) - only build it if it's core to your product.&quot;</p>
</blockquote>
</div>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 16px; padding: 24px; margin: 20px 0">
<h3 id="5-how-do-you-ensure-durability-and-prevent-data-loss-q5-durability">5. &quot;How do you ensure durability and prevent data loss?&quot; {#q5-durability}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>What They're Probing</strong>: Understanding of storage reliability, replication strategies, and failure modes.</p>
<p><strong>Strong Answer - Defense in Depth</strong>:</p>
<p><strong>Layer 1: S3's Built-in Durability (11 nines)</strong></p>
<p>What does &quot;11 nines durability&quot; actually mean?<br />
- 99.999999999% durability = lose 1 file per 10 billion files per year<br />
- If you store 1 million files, expect to lose 0.0001 files per year<br />
- In practice: you won't lose data to S3 failure</p>
<p><strong>How S3 achieves this</strong>:<br />
- Every object replicated to 3+ availability zones<br />
- Each AZ is a separate data center with independent power, cooling, networking<br />
- Checksums on every read/write operation<br />
- Automatic corruption detection and healing</p>
<p><strong>Layer 2: Application-Level Protection</strong></p>
<pre><code class="language-python">class DurableUploadService:
def upload_chunk(self, chunk_hash, chunk_data):
# Step 1: Calculate checksum before upload
expected_checksum = md5(chunk_data)

# Step 2: Upload with checksum verification
response = self.s3.put_object(
Bucket='chunks',
Key=chunk_hash,
Body=chunk_data,
ContentMD5=base64.b64encode(expected_checksum)
# S3 rejects if checksum doesn't match!
)

# Step 3: Verify upload succeeded
if response['ResponseMetadata']['HTTPStatusCode'] != 200:
raise UploadFailedException()

# Step 4: Only NOW update metadata
# This ensures we never have metadata pointing to non-existent chunk
self.db.execute(&quot;&quot;&quot;
UPDATE file_manifests
SET chunks = array_append(chunks, %s)
WHERE file_id = %s
&quot;&quot;&quot;, chunk_hash, file_id)

return True</code></pre>
<p><strong>Layer 3: Write-Ahead Logging for Metadata</strong></p>
<p>PostgreSQL already does this, but here's the concept:</p>
<ol>
<li>Before any metadata change, write to log</li>
<li>Apply change to database</li>
<li>Mark log entry as applied</li>
</ol>
<p>If crash between steps 1 and 2: replay log on restart<br />
If crash between steps 2 and 3: log entry replayed (idempotent operation)</p>
<p><strong>Layer 4: Cross-Region Replication</strong></p>
<p>For critical data (enterprise tier):</p>
<pre><code>Primary Region (us-east-1)          Backup Region (eu-west-1)
            
  S3 Bucket           sync&gt;   S3 Bucket (replica) 
  Aurora PostgreSQL   sync&gt;   Aurora Read Replica 
            
                                    
         If us-east-1 fails         
 Failover to eu-west-1 </code></pre>
<p><strong>Cost consideration</strong>: Cross-region replication doubles storage cost. Only enable for:<br />
- Enterprise customers paying premium<br />
- Compliance requirements (GDPR, HIPAA)<br />
- Data that cannot be recreated (user uploads, not cached thumbnails)</p>
<p><strong>Layer 5: Soft Deletes (Most Important!)</strong></p>
<pre><code class="language-sql">-- Don't do this:
DELETE FROM files WHERE id = 'abc123';

-- Do this instead:
UPDATE files SET
deleted_at = NOW(),
scheduled_purge = NOW() + INTERVAL '30 days'
WHERE id = 'abc123';</code></pre>
<p><strong>Why soft deletes prevent more data loss than replication</strong>:<br />
- Most data loss is user error (accidental delete) or application bugs<br />
- Cross-region replication faithfully replicates your mistake<br />
- Soft deletes give 30-day recovery window</p>
<p><strong>Real Scenario</strong>: Company CFO accidentally deletes &quot;2023 Financials&quot; folder<br />
- With hard deletes + replication: Data is gone from both regions immediately<br />
- With soft deletes: IT admin restores folder in 5 minutes</p>
<p><strong>Layer 6: Version History</strong></p>
<pre><code class="language-sql">CREATE TABLE file_versions (
file_id UUID,
version_number INTEGER,
chunk_manifest JSONB,      -- Which chunks make up this version
created_at TIMESTAMP,
created_by UUID,
change_description TEXT    -- &quot;Edited by John at 3:45 PM&quot;
);</code></pre>
<p>User can browse version history and restore any previous version. This catches:<br />
- Accidental overwrites (&quot;I pasted the wrong data&quot;)<br />
- Ransomware (restore pre-encryption versions)<br />
- Collaborative mistakes (&quot;Who broke the formatting?&quot;)</p>
<p><strong>Key Insight</strong>: &quot;Most data loss isn't hardware failure - it's user error or application bugs. Soft deletes and version history prevent more data loss than fancy replication schemes. S3's durability handles hardware; our job is handling human error.&quot;</p>
<p><strong>When Simpler Works</strong>:</p>
<blockquote>
<p>&quot;S3's built-in durability is enough for most apps. Cross-region replication is expensive and adds latency. Only add it for compliance requirements or if you're storing irreplaceable data worth the 2x cost.&quot;</p>
</blockquote>
</div>
</div>
<hr />
<h2 id="why-this-technology-why-this-technology">Why This Technology? {#why-this-technology}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 id="technology-decision-matrix-technology-decision-matrix">Technology Decision Matrix {#technology-decision-matrix}</h3>
<table>
<thead>
<tr>
<th>Decision</th>
<th>Why This Choice</th>
<th>Alternative Considered</th>
<th>When Alternative Wins</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>S3 for blobs</strong></td>
<td>11 nines durability, infinite scale, $0.023/GB</td>
<td>Self-hosted Ceph/Minio</td>
<td>Need on-prem, extreme cost optimization at 10PB+</td>
</tr>
<tr>
<td><strong>PostgreSQL for metadata</strong></td>
<td>ACID transactions, complex queries (sharing, search), mature tooling</td>
<td>DynamoDB</td>
<td>Need unlimited scale without sharding headaches</td>
</tr>
<tr>
<td><strong>Redis for sync state</strong></td>
<td>Sub-millisecond latency for &quot;what changed&quot; queries</td>
<td>Kafka</td>
<td>Need event replay, audit log, or ordered delivery</td>
</tr>
<tr>
<td><strong>DynamoDB for chunk index</strong></td>
<td>Consistent hashing, auto-scaling, single-digit ms</td>
<td>PostgreSQL</td>
<td>Already have Postgres, &lt; 1B chunks</td>
</tr>
<tr>
<td><strong>Kafka for events</strong></td>
<td>Ordered event delivery, replay capability, decoupling</td>
<td>Redis Pub/Sub</td>
<td>Simple real-time only, no replay needed</td>
</tr>
</tbody>
</table>
<h3 id="s3-vs-alternatives-deep-dive-s3-vs-alternatives">S3 vs Alternatives Deep Dive {#s3-vs-alternatives}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px">
<div style="background: #f8fafc;border-radius: 12px; padding: 16px">
<div style="color: #f0883e; font-weight: bold; margin-bottom: 12px">S3</div>
<div style="font-size: 12px; color: #475569">
  Durability: 11 nines<br>
  Cost: $0.023/GB<br>
  Ecosystem: Best<br>
  Multi-region: Built-in
</div>
<div style="margin-top: 12px; padding-top: 12px;font-size: 11px; color: #16a34a">
  CHOOSE WHEN: AWS ecosystem, mature tooling, global reach
</div>
</div>
<div style="background: #f8fafc;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">GCS</div>
<div style="font-size: 12px; color: #475569">
  Durability: 11 nines<br>
  Cost: $0.020/GB<br>
  Ecosystem: Good<br>
  Multi-region: Built-in
</div>
<div style="margin-top: 12px; padding-top: 12px;font-size: 11px; color: #16a34a">
  CHOOSE WHEN: GCP ecosystem, BigQuery integration, ML workloads
</div>
</div>
<div style="background: #f8fafc;border-radius: 12px; padding: 16px">
<div style="color: #a371f7; font-weight: bold; margin-bottom: 12px">Minio (Self-hosted)</div>
<div style="font-size: 12px; color: #475569">
  Durability: You manage<br>
  Cost: Hardware + ops<br>
  Ecosystem: S3-compatible<br>
  Multi-region: Manual
</div>
<div style="margin-top: 12px; padding-top: 12px;font-size: 11px; color: #16a34a">
  CHOOSE WHEN: On-premise required, data sovereignty, cost at 10PB+
</div>
</div>
</div>
</div>
<h3 id="dynamodb-vs-postgresql-for-metadata-dynamodb-vs-postgresql">DynamoDB vs PostgreSQL for Metadata {#dynamodb-vs-postgresql}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px">
<div>
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px; font-size: 16px">PostgreSQL</div>
<div style="font-size: 13px; color: #475569; line-height: 1.6">
<strong>Queries:</strong> Complex joins, full-text search<br>
<strong>Scale:</strong> Sharding required at 10TB+<br>
<strong>Cost:</strong> Predictable<br>
<strong>Transactions:</strong> Full ACID
</div>
<div style="margin-top: 16px; padding: 12px; background: #f8fafc;border-radius: 0 8px 8px 0; font-size: 12px">
<strong style="color: #16a34a">CHOOSE WHEN:</strong><br>
  Complex permission queries, full-text search, team knows SQL, < 10TB metadata
</div>
</div>
<div>
<div style="color: #f0883e; font-weight: bold; margin-bottom: 12px; font-size: 16px">DynamoDB</div>
<div style="font-size: 13px; color: #475569; line-height: 1.6">
<strong>Queries:</strong> Key-value, limited<br>
<strong>Scale:</strong> Unlimited, automatic<br>
<strong>Cost:</strong> Per-request (can spike)<br>
<strong>Transactions:</strong> Limited
</div>
<div style="margin-top: 16px; padding: 12px; background: #f8fafc;border-radius: 0 8px 8px 0; font-size: 12px">
<strong style="color: #16a34a">CHOOSE WHEN:</strong><br>
  Simple access patterns, extreme scale (1M+ RPS), unpredictable traffic, global tables needed
</div>
</div>
</div>
<div style="margin-top: 16px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 13px; color: #f0883e">
<strong>Recommendation:</strong> Start with PostgreSQL. It handles 99% of file storage apps. Migrate specific tables to DynamoDB only when you hit scaling limits.
</div>
</div>
</div>
<hr />
<h2 id="when-simpler-solutions-work-when-simpler-solutions-work">When Simpler Solutions Work {#when-simpler-solutions-work}</h2>
<div style="background: linear-gradient(135deg, #238636 0%, #2ea043 100%); border-radius: 12px; padding: 4px; margin: 20px 0">
<div style="background: #f8fafc; border-radius: 10px; padding: 24px">
<h3 id="the-150month-file-storage-architecture-simple-architecture">The &quot;$150/month File Storage&quot; Architecture {#simple-architecture}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<p><strong>For: &lt; 10K files, &lt; 1TB storage, &lt; 1K users</strong></p>
  <!-- Simple Architecture Diagram -->
<div style="background: #f8fafc;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #16a34a; margin-bottom: 20px; font-size: 16px">SIMPLE FILE STORAGE</div>
  <!-- Client -->
<div style="display: flex; justify-content: center; margin-bottom: 16px">
<div style="background: #238636; color: white; padding: 12px 24px; border-radius: 8px; font-weight: bold">Client</div>
</div>
  <!-- Arrow -->
<div style="text-align: center; margin: 8px 0">
<div style="height: 20px; margin: 0 auto; width: 0"></div>
</div>
  <!-- Services Row -->
<div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px; flex-wrap: wrap">
<div style="background: #f1f5f9;border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #1d4ed8; font-weight: bold">API</div>
<div style="font-size: 10px; color: #475569">(Express)</div>
</div>
<div style="background: #f1f5f9;border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #f0883e; font-weight: bold">Postgres</div>
<div style="font-size: 10px; color: #475569">(Metadata)</div>
</div>
<div style="background: #f1f5f9;border-radius: 8px; padding: 12px 20px; text-align: center">
<div style="color: #16a34a; font-weight: bold">S3</div>
<div style="font-size: 10px; color: #475569">(Files)</div>
</div>
</div>
  <!-- Upload Flow -->
<div style="background: #f1f5f9; border-radius: 8px; padding: 16px; margin-top: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Upload flow:</div>
<div style="font-size: 12px; color: #475569">
  1. API creates presigned S3 URL<br>
  2. Client uploads directly to S3<br>
  3. API stores metadata in Postgres
</div>
</div>
  <!-- Cost Breakdown -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 16px">
<div style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px; text-align: center">
<div style="color: #16a34a; font-weight: bold">S3 (1TB)</div>
<div style="font-size: 12px; color: #475569">$23/mo</div>
</div>
<div style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px; text-align: center">
<div style="color: #1d4ed8; font-weight: bold">RDS Postgres</div>
<div style="font-size: 12px; color: #475569">$15/mo</div>
</div>
<div style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px; text-align: center">
<div style="color: #f0883e; font-weight: bold">EC2</div>
<div style="font-size: 12px; color: #475569">$15/mo</div>
</div>
<div style="background: #f1f5f9; padding: 8px 12px; border-radius: 6px; text-align: center">
<div style="color: #a371f7; font-weight: bold">Data Transfer</div>
<div style="font-size: 12px; color: #475569">~$50/mo</div>
</div>
</div>
<div style="text-align: center; margin-top: 16px; color: #16a34a; font-weight: bold; font-size: 18px">
  Total: ~$100-150/month
</div>
</div>
<p><strong>What You Skip</strong>:<br />
- No chunking (S3 multipart handles large files)<br />
- No delta sync (re-upload whole file - it's fine for occasional changes)<br />
- No real-time collaboration (use Google Docs integration instead)<br />
- No offline support (web-only is fine)</p>
</div>
<h3 id="when-you-dont-need-delta-sync-when-no-delta-sync">When You Don't Need Delta Sync {#when-no-delta-sync}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Delta Sync Needed?</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Document storage (PDFs, images)</td>
<td>No</td>
<td>Files don't change often, whole upload is fine</td>
</tr>
<tr>
<td>Code repositories</td>
<td>No</td>
<td>Git handles this better</td>
</tr>
<tr>
<td>Video hosting</td>
<td>No</td>
<td>Videos are rarely edited, re-encode anyway</td>
</tr>
<tr>
<td>Real-time collaboration</td>
<td>No</td>
<td>Use OT/CRDT instead, different problem</td>
</tr>
<tr>
<td>Backup service</td>
<td>No</td>
<td>Whole-file versioning is simpler</td>
</tr>
<tr>
<td><strong>Dropbox-style sync</strong></td>
<td><strong>Yes</strong></td>
<td>Users edit same file repeatedly across devices</td>
</tr>
</tbody>
</table>
<p><strong>Key Insight</strong>:</p>
<blockquote>
<p>&quot;Dropbox's delta sync is overkill for most apps. They built it because their core use case is syncing files you edit constantly (documents, code). If your users upload once and share, skip it entirely.&quot;</p>
</blockquote>
</div>
<h3 id="simpler-alternatives-table-simpler-alternatives">Simpler Alternatives Table {#simpler-alternatives}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<table>
<thead>
<tr>
<th>Complex Feature</th>
<th>Simpler Alternative</th>
<th>When to Use Alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>Custom chunking</td>
<td>S3 multipart upload</td>
<td>Files &lt; 5GB, no dedup needed</td>
</tr>
<tr>
<td>Delta sync</td>
<td>Whole file re-upload</td>
<td>Files change &lt; 1x/day per user</td>
</tr>
<tr>
<td>Real-time collaboration</td>
<td>Google Docs/Office 365 embed</td>
<td>Not core to your product</td>
</tr>
<tr>
<td>Offline desktop sync</td>
<td>Web-only + mobile cache</td>
<td>Users have reliable internet</td>
</tr>
<tr>
<td>Custom search</td>
<td>PostgreSQL full-text + S3 metadata</td>
<td>&lt; 1M files</td>
</tr>
<tr>
<td>Multi-region storage</td>
<td>Single region + backups</td>
<td>Users in one geography</td>
</tr>
<tr>
<td>Custom CDN</td>
<td>CloudFront/Cloudflare</td>
<td>Not serving 10K+ req/sec</td>
</tr>
</tbody>
</table>
</div>
<h3 id="decision-framework-build-vs-buy-build-vs-buy">Decision Framework: Build vs. Buy {#build-vs-buy}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
  <!-- Decision Tree -->
<div style="background: #f8fafc; border-radius: 12px; padding: 24px">
  <!-- Question 1 -->
<div style="text-align: center; margin-bottom: 20px">
<div style="background: #8957e5; color: white; padding: 12px 24px; border-radius: 8px; display: inline-block; font-weight: bold">
  Is file storage core to your product?
</div>
</div>
<div style="display: flex; justify-content: center; gap: 40px; flex-wrap: wrap">
  <!-- YES Branch -->
<div style="text-align: center">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 12px">YES</div>
<div style="height: 20px; margin: 0 auto 12px; width: 0"></div>
<div style="background: #238636; color: white; padding: 12px 20px; border-radius: 8px; margin-bottom: 12px">
  Do you have 6+ months<br>and 2+ engineers?
</div>
<div style="display: flex; gap: 20px; justify-content: center">
<div style="text-align: center">
<div style="color: #16a34a; font-size: 12px; margin-bottom: 8px">YES</div>
<div style="background: #f1f5f9;padding: 8px 16px; border-radius: 6px; font-size: 12px; color: #16a34a">
  Build custom<br>(this design)
</div>
</div>
<div style="text-align: center">
<div style="color: #f85149; font-size: 12px; margin-bottom: 8px">NO</div>
<div style="background: #f1f5f9;padding: 8px 16px; border-radius: 6px; font-size: 12px; color: #f0883e">
  Dropbox API,<br>Box API, Amplify
</div>
</div>
</div>
</div>
  <!-- NO Branch -->
<div style="text-align: center">
<div style="color: #f85149; font-weight: bold; margin-bottom: 12px">NO</div>
<div style="height: 20px; margin: 0 auto 12px; width: 0"></div>
<div style="background: #f1f5f9;padding: 12px 20px; border-radius: 8px; font-size: 13px; color: #1d4ed8">
  Use Firebase Storage,<br>Cloudinary, or S3 + SDK
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="trade-off-analysis--mitigation-trade-off-analysis">Trade-off Analysis &amp; Mitigation {#trade-off-analysis}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 id="core-trade-offs-core-trade-offs">Core Trade-offs {#core-trade-offs}</h3>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; padding: 20px; margin: 16px 0">
<h4 id="1-consistency-vs-availability-tradeoff-consistency">1. Consistency vs. Availability {#tradeoff-consistency}</h4>
<table>
<thead>
<tr>
<th>Choice</th>
<th>Consistency</th>
<th>Availability</th>
<th>Use When</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sync writes to all replicas</td>
<td>Strong</td>
<td>Lower (fails if replica down)</td>
<td>Financial data, permissions</td>
</tr>
<tr>
<td>Async replication</td>
<td>Eventual</td>
<td>Higher</td>
<td>File content, thumbnails</td>
</tr>
<tr>
<td>Optimistic concurrency</td>
<td>Eventual with conflicts</td>
<td>Highest</td>
<td>Collaborative editing</td>
</tr>
</tbody>
</table>
<p><strong>Mitigation</strong>:<br />
- Use strong consistency for metadata (permissions, sharing)<br />
- Use eventual consistency for blobs (content doesn't change)<br />
- Handle conflicts gracefully in UI (don't lose user work)</p>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; padding: 20px; margin: 16px 0">
<h4 id="2-storage-cost-vs-access-speed-tradeoff-storage-cost">2. Storage Cost vs. Access Speed {#tradeoff-storage-cost}</h4>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Cost/GB/month</th>
<th>Access Time</th>
<th>Use For</th>
</tr>
</thead>
<tbody>
<tr>
<td>SSD/Edge Cache</td>
<td>$0.10+</td>
<td>&lt;10ms</td>
<td>Hot files, thumbnails</td>
</tr>
<tr>
<td>S3 Standard</td>
<td>$0.023</td>
<td>50-100ms</td>
<td>Active files</td>
</tr>
<tr>
<td>S3 Infrequent</td>
<td>$0.0125</td>
<td>50-100ms</td>
<td>Files &gt; 30 days old</td>
</tr>
<tr>
<td>Glacier</td>
<td>$0.004</td>
<td>3-5 hours</td>
<td>Files &gt; 90 days old</td>
</tr>
</tbody>
</table>
<p><strong>Mitigation</strong>:<br />
- Intelligent tiering based on access patterns<br />
- Pre-warm files when user opens folder<br />
- Cache thumbnails aggressively (they're accessed 100x more than files)</p>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; padding: 20px; margin: 16px 0">
<h4 id="3-deduplication-vs-privacy-tradeoff-dedup-privacy">3. Deduplication vs. Privacy {#tradeoff-dedup-privacy}</h4>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Storage Savings</th>
<th>Privacy</th>
<th>Complexity</th>
</tr>
</thead>
<tbody>
<tr>
<td>No dedup</td>
<td>0%</td>
<td>Full isolation</td>
<td>Low</td>
</tr>
<tr>
<td>Per-user dedup</td>
<td>10-20%</td>
<td>Full isolation</td>
<td>Medium</td>
</tr>
<tr>
<td>Global dedup</td>
<td>40-60%</td>
<td>Shared chunks</td>
<td>High</td>
</tr>
<tr>
<td>Convergent encryption</td>
<td>40-60%</td>
<td>Encrypted + dedup</td>
<td>Very High</td>
</tr>
</tbody>
</table>
<p><strong>Mitigation</strong>:<br />
- Use global dedup only for hash (not content inspection)<br />
- Encrypt chunks with per-user keys for sensitive content<br />
- For enterprise: offer per-tenant isolation as premium feature</p>
</div>
<div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; padding: 20px; margin: 16px 0">
<h4 id="4-sync-speed-vs-batterybandwidth-tradeoff-sync-speed">4. Sync Speed vs. Battery/Bandwidth {#tradeoff-sync-speed}</h4>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Sync Speed</th>
<th>Battery Impact</th>
<th>Bandwidth</th>
</tr>
</thead>
<tbody>
<tr>
<td>Real-time (WebSocket)</td>
<td>Instant</td>
<td>High (constant connection)</td>
<td>Low</td>
</tr>
<tr>
<td>Frequent polling (30s)</td>
<td>Near-instant</td>
<td>Medium</td>
<td>Medium</td>
</tr>
<tr>
<td>Lazy polling (5min)</td>
<td>Minutes</td>
<td>Low</td>
<td>Low</td>
</tr>
<tr>
<td>Manual sync</td>
<td>User-initiated</td>
<td>Minimal</td>
<td>Minimal</td>
</tr>
</tbody>
</table>
<p><strong>Mitigation</strong>:<br />
- WebSocket when app is focused, long-polling in background<br />
- Batch changes and sync on network change (WiFi vs. cellular)<br />
- Let users configure sync frequency for mobile</p>
</div>
<h3 id="risk-mitigation-matrix-risk-mitigation">Risk Mitigation Matrix {#risk-mitigation}</h3>
<div style="background: #f1f5f9; border-radius: 10px; padding: 20px; margin: 16px 0">
<table>
<thead>
<tr>
<th>Risk</th>
<th>Impact</th>
<th>Probability</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>S3 region outage</td>
<td>High</td>
<td>Very Low</td>
<td>Cross-region replication for critical data</td>
</tr>
<tr>
<td>Metadata DB corruption</td>
<td>Critical</td>
<td>Low</td>
<td>Point-in-time recovery, read replicas</td>
</tr>
<tr>
<td>Sync conflict data loss</td>
<td>High</td>
<td>Medium</td>
<td>Keep both versions, version history</td>
</tr>
<tr>
<td>Quota exceeded mid-upload</td>
<td>Medium</td>
<td>Medium</td>
<td>Pre-check quota, graceful rollback</td>
</tr>
<tr>
<td>Chunk index inconsistency</td>
<td>High</td>
<td>Low</td>
<td>Background consistency checker, reconciliation job</td>
</tr>
<tr>
<td>Upload stuck/orphaned</td>
<td>Medium</td>
<td>Medium</td>
<td>Timeout + cleanup job for incomplete uploads</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr />
<h2 id="edge-cases--failure-modes-edge-cases-failure-modes">Edge Cases &amp; Failure Modes {#edge-cases-failure-modes}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 id="sync-conflicts-sync-conflicts">Sync Conflicts {#sync-conflicts}</h3>
<div class="flow-diagram" style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #f85149; margin-bottom: 20px; font-size: 16px">CONFLICT SCENARIOS & RESOLUTION</div>
<div style="display: flex; flex-direction: column; gap: 16px">
<!-- Scenario 1: Edit-Edit Conflict -->
<div class="flow-box warning" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; padding: 16px">
<div style="color: #92400e; font-weight: bold; margin-bottom: 8px">Scenario 1: Edit-Edit Conflict</div>
<div style="font-size: 13px; color: #78350f">
<strong>Situation:</strong> User edits file on laptop (offline) while same file is edited on phone (online)<br>
<strong>Detection:</strong> Server version incremented while client has local changes based on stale version<br>
<strong>Resolution:</strong> Create conflict copy: <code>file.docx</code> + <code>file (conflict from Laptop).docx</code><br>
<strong>UX:</strong> Notify user with clear message showing which device made which change
</div>
</div>
<!-- Scenario 2: Delete-Edit Conflict -->
<div class="flow-box warning" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-radius: 12px; padding: 16px">
<div style="color: #991b1b; font-weight: bold; margin-bottom: 8px">Scenario 2: Delete-Edit Conflict</div>
<div style="font-size: 13px; color: #7f1d1d">
<strong>Situation:</strong> User A deletes file while User B is editing it offline<br>
<strong>Detection:</strong> File marked deleted on server, client attempts to push edit<br>
<strong>Resolution:</strong> Resurrect file with User B's edits, notify User A<br>
<strong>Alternative:</strong> Move to User B's trash with "This file was deleted while you were editing"
</div>
</div>
<!-- Scenario 3: Move-Edit Conflict -->
<div class="flow-box warning" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 12px; padding: 16px">
<div style="color: #1e40af; font-weight: bold; margin-bottom: 8px">Scenario 3: Move-Edit Conflict</div>
<div style="font-size: 13px; color: #1e3a8a">
<strong>Situation:</strong> File moved from <code>/Projects/Q1/</code> to <code>/Archive/</code> while being edited<br>
<strong>Detection:</strong> Path changed on server while client references old path<br>
<strong>Resolution:</strong> Track by file ID (not path) - apply edit to file at new location<br>
<strong>Key:</strong> Never use path as primary identifier
</div>
</div>
<!-- Scenario 4: Rename-Rename Conflict -->
<div class="flow-box warning" style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border-radius: 12px; padding: 16px">
<div style="color: #6b21a8; font-weight: bold; margin-bottom: 8px">Scenario 4: Rename-Rename Conflict</div>
<div style="font-size: 13px; color: #581c87">
<strong>Situation:</strong> User A renames to <code>report-final.docx</code>, User B renames to <code>report-v2.docx</code><br>
<strong>Detection:</strong> Two rename operations on same file ID with same base version<br>
<strong>Resolution:</strong> Last-write-wins for metadata, but keep version history showing both names<br>
<strong>UX:</strong> Notification to losing user: "report.docx was renamed to X by User A"
</div>
</div>
</div>
</div>
<h3 id="network-failures-network-failures">Network Failures {#network-failures}</h3>
<div class="flow-diagram" style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #d97706; margin-bottom: 20px; font-size: 16px">NETWORK FAILURE HANDLING</div>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px">
<!-- Upload Interruption -->
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">Upload Interruption</div>
<div style="font-size: 12px; color: #475569">
<strong>Problem:</strong> Connection drops during 500MB upload at 80%<br><br>
<strong>Solution:</strong>
<ul style="margin: 8px 0; padding-left: 16px">
<li>Chunked upload (4MB chunks)</li>
<li>Server tracks received chunks by upload_id</li>
<li>Client queries: "Which chunks do you have?"</li>
<li>Resume from chunk 101 instead of byte 0</li>
</ul>
<strong>Implementation:</strong> S3 multipart upload API
</div>
</div>
<!-- Download Interruption -->
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">Download Interruption</div>
<div style="font-size: 12px; color: #475569">
<strong>Problem:</strong> Large file download fails at 60%<br><br>
<strong>Solution:</strong>
<ul style="margin: 8px 0; padding-left: 16px">
<li>HTTP Range requests for partial content</li>
<li>Track downloaded bytes in local DB</li>
<li>Resume with <code>Range: bytes=N-</code> header</li>
<li>Verify final hash matches expected</li>
</ul>
<strong>Header:</strong> <code>Accept-Ranges: bytes</code>
</div>
</div>
<!-- Sync Queue Backup -->
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">Sync Queue Backup</div>
<div style="font-size: 12px; color: #475569">
<strong>Problem:</strong> Device offline for days, 1000s of pending changes<br><br>
<strong>Solution:</strong>
<ul style="margin: 8px 0; padding-left: 16px">
<li>Persistent local queue (SQLite)</li>
<li>Priority ordering (user-initiated > background)</li>
<li>Exponential backoff with jitter</li>
<li>Batch operations where possible</li>
</ul>
<strong>Limit:</strong> Queue cap with oldest-first eviction
</div>
</div>
<!-- Partial Metadata Updates -->
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">Partial Metadata Updates</div>
<div style="font-size: 12px; color: #475569">
<strong>Problem:</strong> Chunk uploaded but metadata update fails<br><br>
<strong>Solution:</strong>
<ul style="margin: 8px 0; padding-left: 16px">
<li>Idempotent chunk uploads (content-addressed)</li>
<li>Retry metadata update with same chunk hashes</li>
<li>Background orphan cleanup job</li>
<li>Two-phase commit for critical operations</li>
</ul>
<strong>Key:</strong> Never delete chunks until metadata confirms
</div>
</div>
</div>
</div>
<h3 id="storage-failures-storage-failures">Storage Failures {#storage-failures}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #059669; margin-bottom: 20px; font-size: 16px">STORAGE FAILURE SCENARIOS</div>
<table>
<thead>
<tr>
<th>Failure Type</th>
<th>Detection</th>
<th>Recovery</th>
<th>Prevention</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Chunk Corruption</strong></td>
<td>Checksum mismatch on read</td>
<td>Fetch from replica, mark primary for repair</td>
<td>Checksums on write, periodic scrubbing</td>
</tr>
<tr>
<td><strong>Metadata DB Failure</strong></td>
<td>Connection timeout, query errors</td>
<td>Failover to read replica, promote to primary</td>
<td>Multi-AZ deployment, regular backups</td>
</tr>
<tr>
<td><strong>S3 Region Outage</strong></td>
<td>AWS health check, increased latency</td>
<td>Route to secondary region, serve cached</td>
<td>Cross-region replication for critical data</td>
</tr>
<tr>
<td><strong>Orphaned Chunks</strong></td>
<td>Reference count = 0 in reconciliation</td>
<td>Background cleanup after grace period</td>
<td>Transactional chunk registration</td>
</tr>
<tr>
<td><strong>Missing Chunks</strong></td>
<td>Manifest references non-existent chunk</td>
<td>Restore from backup or mark file corrupted</td>
<td>3+ replicas, erasure coding</td>
</tr>
</tbody>
</table>
</div>
<h3 id="edge-cases-in-file-operations-edge-cases-file-ops">Edge Cases in File Operations {#edge-cases-file-ops}</h3>
<div style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px">
<!-- Edge Case 1 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Zero-Byte Files</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> Empty file has no chunks to deduplicate<br>
<strong>Solution:</strong> Special handling - store only metadata, no S3 object<br>
<strong>Sync:</strong> Create placeholder immediately, no chunk transfer needed
</div>
</div>
<!-- Edge Case 2 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Extremely Large Files (100GB+)</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> 25,000+ chunks per file, manifest becomes huge<br>
<strong>Solution:</strong> Hierarchical manifests (manifest of manifests)<br>
<strong>Limit:</strong> Consider max file size policy (5TB like S3)
</div>
</div>
<!-- Edge Case 3 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Special Characters in Filenames</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> Unicode, emojis, path separators in names<br>
<strong>Solution:</strong> UTF-8 normalization (NFC), escape path separators<br>
<strong>Cross-platform:</strong> Map illegal characters per OS
</div>
</div>
<!-- Edge Case 4 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Case Sensitivity Conflicts</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> <code>File.txt</code> and <code>file.txt</code> are same on Windows, different on Linux<br>
<strong>Solution:</strong> Case-preserving but case-insensitive matching<br>
<strong>Warning:</strong> Alert user before creating case-only-different names
</div>
</div>
<!-- Edge Case 5 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Symbolic Links & Shortcuts</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> Should links be followed or synced as links?<br>
<strong>Solution:</strong> Sync as metadata (link target path), not resolved content<br>
<strong>Security:</strong> Prevent symlink attacks (links outside sync folder)
</div>
</div>
<!-- Edge Case 6 -->
<div class="flow-box success" style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Rapid File Changes</div>
<div style="font-size: 12px; color: #475569">
<strong>Issue:</strong> User saves file 10 times in 5 seconds<br>
<strong>Solution:</strong> Debounce (wait 2s after last change), coalesce versions<br>
<strong>Optimization:</strong> Only sync final state, not intermediate
</div>
</div>
</div>
</div>
<h3 id="quota--rate-limit-failures-quota-rate-failures">Quota &amp; Rate Limit Failures {#quota-rate-failures}</h3>
<div style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<pre><code class="language-python">class QuotaManager:
    &quot;&quot;&quot;Handle quota edge cases gracefully.&quot;&quot;&quot;

    def check_upload_quota(self, user_id, file_size):
        current_usage = self.get_cached_usage(user_id)
        quota_limit = self.get_quota_limit(user_id)

        # Edge case 1: Quota exceeded mid-upload
        if current_usage + file_size &gt; quota_limit:
            # Don't fail silently - give actionable error
            return QuotaError(
                current=current_usage,
                limit=quota_limit,
                needed=file_size,
                suggestion=&quot;Delete 50MB or upgrade plan&quot;
            )

        # Edge case 2: Race condition - two uploads start simultaneously
        # Use optimistic locking with retry
        reserved = self.reserve_quota(user_id, file_size, ttl=3600)
        if not reserved:
            return QuotaError(&quot;Concurrent upload in progress, retry in 60s&quot;)

        return QuotaReservation(id=reserved, expires_in=3600)

    def handle_dedup_credit(self, user_id, file_id):
        &quot;&quot;&quot;
        Edge case 3: File uploaded but chunks already exist
        User shouldn't be charged for deduplicated storage
        &quot;&quot;&quot;
        file_manifest = self.get_manifest(file_id)
        actual_new_bytes = sum(
            chunk.size for chunk in file_manifest.chunks
            if chunk.ref_count == 1  # Only this user references it
        )

        # Credit back the difference
        logical_size = file_manifest.total_size
        self.adjust_quota(user_id, actual_new_bytes - logical_size)
</code></pre>
</div>
</div>
<hr />
<h2 id="scaling-strategies-scaling-strategies">Scaling Strategies {#scaling-strategies}</h2>
<div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 32px; margin: 20px 0">
<h3 id="horizontal-scaling-architecture-horizontal-scaling">Horizontal Scaling Architecture {#horizontal-scaling}</h3>
<div class="flow-diagram" style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #1d4ed8; margin-bottom: 24px; font-size: 16px">HORIZONTAL SCALING PATTERN</div>
<!-- Load Balancer Layer -->
<div style="display: flex; justify-content: center; margin-bottom: 20px">
<div class="flow-box primary" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border-radius: 12px; padding: 16px 32px; text-align: center">
<div style="font-weight: bold; color: #ffffff">Global Load Balancer</div>
<div style="font-size: 11px; color: #fecaca">GeoDNS + Health Checks</div>
</div>
</div>
<div class="flow-arrow" style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
<!-- API Gateway Layer -->
<div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 20px; flex-wrap: wrap">
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 12px 20px; text-align: center; min-width: 120px">
<div style="color: #1d4ed8; font-weight: bold">API Gateway</div>
<div style="font-size: 10px; color: #475569">US-East</div>
</div>
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 12px 20px; text-align: center; min-width: 120px">
<div style="color: #1d4ed8; font-weight: bold">API Gateway</div>
<div style="font-size: 10px; color: #475569">EU-West</div>
</div>
<div class="flow-box primary" style="background: #ffffff;border-radius: 12px; padding: 12px 20px; text-align: center; min-width: 120px">
<div style="color: #1d4ed8; font-weight: bold">API Gateway</div>
<div style="font-size: 10px; color: #475569">AP-South</div>
</div>
</div>
<div class="flow-arrow" style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
<!-- Services Layer -->
<div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap">
<div class="flow-box success" style="background: #ffffff;border-radius: 12px; padding: 12px 16px; text-align: center">
<div style="color: #16a34a; font-weight: bold; font-size: 12px">Metadata</div>
<div style="font-size: 10px; color: #475569">x10 pods</div>
</div>
<div class="flow-box success" style="background: #ffffff;border-radius: 12px; padding: 12px 16px; text-align: center">
<div style="color: #16a34a; font-weight: bold; font-size: 12px">Upload</div>
<div style="font-size: 10px; color: #475569">x20 pods</div>
</div>
<div class="flow-box success" style="background: #ffffff;border-radius: 12px; padding: 12px 16px; text-align: center">
<div style="color: #16a34a; font-weight: bold; font-size: 12px">Sync</div>
<div style="font-size: 10px; color: #475569">x15 pods</div>
</div>
<div class="flow-box success" style="background: #ffffff;border-radius: 12px; padding: 12px 16px; text-align: center">
<div style="color: #16a34a; font-weight: bold; font-size: 12px">Download</div>
<div style="font-size: 10px; color: #475569">x25 pods</div>
</div>
</div>
<div class="flow-arrow" style="text-align: center; margin: 12px 0">
<div style="height: 24px; margin: 0 auto; width: 0"></div>
</div>
<!-- Data Layer -->
<div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap">
<div class="flow-box warning" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); border-radius: 12px; padding: 12px 20px; text-align: center">
<div style="font-weight: bold; color: #78350f">PostgreSQL</div>
<div style="font-size: 10px; color: #92400e">Sharded x8</div>
</div>
<div class="flow-box warning" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border-radius: 12px; padding: 12px 20px; text-align: center">
<div style="font-weight: bold; color: #ffffff">Redis Cluster</div>
<div style="font-size: 10px; color: #fecaca">x12 nodes</div>
</div>
<div class="flow-box warning" style="background: linear-gradient(135deg, #f97316 0%, #fb923c 100%); border-radius: 12px; padding: 12px 20px; text-align: center">
<div style="font-weight: bold; color: #ffffff">S3</div>
<div style="font-size: 10px; color: #fed7aa">Multi-region</div>
</div>
</div>
</div>
<h3 id="database-sharding-strategy-database-sharding">Database Sharding Strategy {#database-sharding}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #7c3aed; margin-bottom: 20px; font-size: 16px">METADATA SHARDING STRATEGIES</div>
<table>
<thead>
<tr>
<th>Strategy</th>
<th>Shard Key</th>
<th>Pros</th>
<th>Cons</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>User ID Hash</strong></td>
<td><code>hash(user_id) % N</code></td>
<td>Even distribution, simple</td>
<td>Cross-user queries slow</td>
<td>Consumer apps (Dropbox)</td>
</tr>
<tr>
<td><strong>Organization ID</strong></td>
<td><code>org_id</code></td>
<td>Team data colocated</td>
<td>Hot orgs need splitting</td>
<td>Enterprise (Google Workspace)</td>
</tr>
<tr>
<td><strong>File ID Hash</strong></td>
<td><code>hash(file_id) % N</code></td>
<td>Even distribution</td>
<td>User's files scattered</td>
<td>High-volume single files</td>
</tr>
<tr>
<td><strong>Geographic</strong></td>
<td><code>user_region</code></td>
<td>Data locality, compliance</td>
<td>Uneven if regions differ</td>
<td>Global with regulations</td>
</tr>
</tbody>
</table>
<div style="background: #f8fafc; border-radius: 8px; padding: 16px; margin-top: 16px">
<div style="color: #7c3aed; font-weight: bold; margin-bottom: 8px">Recommended Hybrid Approach:</div>
<div style="font-size: 13px; color: #475569">
1. <strong>Primary shard</strong> by <code>user_id</code> - keeps user's metadata together<br>
2. <strong>Secondary index</strong> for shared files - cross-shard lookup table<br>
3. <strong>Global table</strong> for chunk dedup index - DynamoDB Global Tables
</div>
</div>
</div>
<h3 id="caching-strategy-caching-strategy">Caching Strategy {#caching-strategy}</h3>
<div style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px">
<!-- L1 Cache -->
<div style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 12px">L1: Application Cache</div>
<div style="font-size: 12px; color: #475569">
<strong>What:</strong> In-memory, per-pod<br>
<strong>TTL:</strong> 30 seconds<br>
<strong>Use for:</strong> User sessions, hot file metadata<br>
<strong>Size:</strong> 512MB per pod<br>
<strong>Eviction:</strong> LRU
</div>
</div>
<!-- L2 Cache -->
<div style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #d97706; font-weight: bold; margin-bottom: 12px">L2: Redis Cluster</div>
<div style="font-size: 12px; color: #475569">
<strong>What:</strong> Distributed, shared<br>
<strong>TTL:</strong> 5 minutes<br>
<strong>Use for:</strong> Sync cursors, file listings, permissions<br>
<strong>Size:</strong> 100GB cluster<br>
<strong>Eviction:</strong> volatile-lru
</div>
</div>
<!-- L3 Cache -->
<div style="background: #ffffff;border-radius: 12px; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 12px">L3: CDN Edge Cache</div>
<div style="font-size: 12px; color: #475569">
<strong>What:</strong> CloudFront/Cloudflare<br>
<strong>TTL:</strong> 24 hours (thumbnails), 1 hour (files)<br>
<strong>Use for:</strong> Thumbnails, static previews, downloads<br>
<strong>Size:</strong> Edge-dependent<br>
<strong>Invalidation:</strong> On file update
</div>
</div>
</div>
<div style="background: #f8fafc; border-radius: 8px; padding: 16px; margin-top: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 8px">Cache Invalidation Strategy:</div>
<div style="font-size: 13px; color: #475569; font-family: monospace">
file_update -> publish to Kafka "file.updated" topic<br>
-> Redis subscriber invalidates L2 cache<br>
-> CDN purge API called for affected URLs<br>
-> Websocket pushes invalidation to connected clients (L1)
</div>
</div>
</div>
<h3 id="auto-scaling-policies-auto-scaling">Auto-Scaling Policies {#auto-scaling}</h3>
<div style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<pre><code class="language-yaml"># Kubernetes HPA Configuration
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: upload-service-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: upload-service
  minReplicas: 5
  maxReplicas: 100
  metrics:
  # Scale on CPU
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  # Scale on custom metric: upload queue depth
  - type: External
    external:
      metric:
        name: upload_queue_depth
      target:
        type: AverageValue
        averageValue: &quot;100&quot;
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
</code></pre>
<table>
<thead>
<tr>
<th>Service</th>
<th>Scale Trigger</th>
<th>Min Pods</th>
<th>Max Pods</th>
<th>Scale Speed</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Upload</strong></td>
<td>Queue depth &gt; 100</td>
<td>5</td>
<td>100</td>
<td>Fast (60s)</td>
</tr>
<tr>
<td><strong>Download</strong></td>
<td>Request latency &gt; 200ms</td>
<td>10</td>
<td>200</td>
<td>Fast (60s)</td>
</tr>
<tr>
<td><strong>Sync</strong></td>
<td>WebSocket connections</td>
<td>5</td>
<td>50</td>
<td>Medium (120s)</td>
</tr>
<tr>
<td><strong>Metadata</strong></td>
<td>CPU &gt; 70%</td>
<td>3</td>
<td>30</td>
<td>Slow (300s)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="performance-optimization-techniques-performance-optimization">Performance Optimization Techniques {#performance-optimization}</h3>
<div style="background: #f1f5f9; border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px">
<!-- Technique 1 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #16a34a; font-weight: bold; margin-bottom: 8px">Parallel Chunk Upload</div>
<div style="font-size: 12px; color: #475569">
Upload 4-8 chunks simultaneously<br>
<strong>Result:</strong> 4x faster for large files<br>
<strong>Limit:</strong> Per-user connection pool
</div>
</div>
<!-- Technique 2 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 8px">Presigned URL Offload</div>
<div style="font-size: 12px; color: #475569">
Direct S3 upload bypasses API servers<br>
<strong>Result:</strong> 10x API server capacity<br>
<strong>Security:</strong> Short-lived URLs (15min)
</div>
</div>
<!-- Technique 3 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #d97706; font-weight: bold; margin-bottom: 8px">Batch Sync Operations</div>
<div style="font-size: 12px; color: #475569">
Combine multiple changes in single request<br>
<strong>Result:</strong> 90% fewer API calls<br>
<strong>Trade-off:</strong> Slightly delayed sync
</div>
</div>
<!-- Technique 4 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #7c3aed; font-weight: bold; margin-bottom: 8px">Connection Pooling</div>
<div style="font-size: 12px; color: #475569">
Reuse DB/Redis connections across requests<br>
<strong>Result:</strong> 50% latency reduction<br>
<strong>Config:</strong> PgBouncer, Redis connection pool
</div>
</div>
<!-- Technique 5 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #db2777; font-weight: bold; margin-bottom: 8px">Async Thumbnail Generation</div>
<div style="font-size: 12px; color: #475569">
Generate previews in background queue<br>
<strong>Result:</strong> Upload returns immediately<br>
<strong>Queue:</strong> SQS + Lambda or Kafka + workers
</div>
</div>
<!-- Technique 6 -->
<div style="background: #ffffff;border-radius: 0 12px 12px 0; padding: 16px">
<div style="color: #0891b2; font-weight: bold; margin-bottom: 8px">Read Replicas</div>
<div style="font-size: 12px; color: #475569">
Route reads to replicas, writes to primary<br>
<strong>Result:</strong> 5x read capacity<br>
<strong>Latency:</strong> Accept 100ms replication lag
</div>
</div>
</div>
</div>
<h3 id="capacity-planning-capacity-planning">Capacity Planning {#capacity-planning}</h3>
<div style="background: #f1f5f9;border-radius: 16px; padding: 24px; margin: 16px 0">
<div style="text-align: center; font-weight: bold; color: #1d4ed8; margin-bottom: 20px; font-size: 16px">CAPACITY ESTIMATION FORMULAS</div>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Formula</th>
<th>Example (10M users)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Storage</strong></td>
<td>Users x Avg files x Avg size x (1 - dedup%)</td>
<td>10M x 500 x 5MB x 0.6 = 15PB</td>
</tr>
<tr>
<td><strong>Metadata DB</strong></td>
<td>Users x Files x 2KB per record</td>
<td>10M x 500 x 2KB = 10TB</td>
</tr>
<tr>
<td><strong>Upload bandwidth</strong></td>
<td>Daily uploads x Avg size / seconds</td>
<td>50M x 5MB / 86400 = 2.9GB/s</td>
</tr>
<tr>
<td><strong>API requests</strong></td>
<td>Users x Requests/day / seconds</td>
<td>10M x 100 / 86400 = 11.5K RPS</td>
</tr>
<tr>
<td><strong>Sync connections</strong></td>
<td>Active users x Devices</td>
<td>1M x 2.5 = 2.5M WebSockets</td>
</tr>
</tbody>
</table>
<div style="background: #f8fafc; border-radius: 8px; padding: 16px; margin-top: 16px">
<div style="color: #1d4ed8; font-weight: bold; margin-bottom: 8px">Rule of Thumb:</div>
<div style="font-size: 13px; color: #475569">
Plan for <strong>3x peak traffic</strong> over average. File storage services see 5-10x spikes during:<br>
- Monday mornings (sync after weekend)<br>
- End of quarter (business reports)<br>
- Product launches (marketing assets)
</div>
</div>
</div>
</div>
<hr />
<h2 id="interview-tips-interview-tips">Interview Tips {#interview-tips}</h2>
<div style="background: linear-gradient(135deg, #2d1f3d 0%, #4a3a5d 100%); border-radius: 12px; padding: 24px; margin: 20px 0">
<h3 id="key-discussion-points-key-discussion-points">Key Discussion Points {#key-discussion-points}</h3>
<ol>
<li><strong>Start simple, add complexity</strong>: &quot;For a startup, I'd use S3 + PostgreSQL. Here's when I'd add chunking...&quot;</li>
<li><strong>Chunking strategy</strong>: Explain block-level dedup, resumability, delta sync - and when to skip it</li>
<li><strong>Sync protocol</strong>: Polling vs. push, delta sync vs. whole file, conflict resolution</li>
<li><strong>Storage tiering</strong>: Hot/warm/cold storage, cost optimization at scale</li>
<li><strong>Security</strong>: Encryption at rest (S3 SSE), in transit (TLS), client-side for sensitive</li>
</ol>
<h3 id="red-flags-what-not-to-say-red-flags">Red Flags (What NOT to Say) {#red-flags}</h3>
<div style="background: linear-gradient(135deg, #3d1f1f 0%, #5d3a3a 100%); border-radius: 10px; padding: 20px; margin: 16px 0">
<table>
<thead>
<tr>
<th>Red Flag Statement</th>
<th>Why It's Wrong</th>
<th>Better Answer</th>
</tr>
</thead>
<tbody>
<tr>
<td>&quot;I'd build everything from scratch&quot;</td>
<td>Ignores existing solutions</td>
<td>&quot;I'd use S3 for storage, but build custom sync logic because...&quot;</td>
</tr>
<tr>
<td>&quot;Just use MongoDB for everything&quot;</td>
<td>Wrong tool for relational data</td>
<td>&quot;Metadata needs joins for permissions, so PostgreSQL. Chunks are key-value, so DynamoDB&quot;</td>
</tr>
<tr>
<td>&quot;We need microservices from day one&quot;</td>
<td>Premature optimization</td>
<td>&quot;I'd start monolithic, extract services when we hit specific scaling issues&quot;</td>
</tr>
<tr>
<td>&quot;Eventual consistency is fine everywhere&quot;</td>
<td>Ignores permission sensitivity</td>
<td>&quot;Blob content can be eventual, but permissions need strong consistency&quot;</td>
</tr>
<tr>
<td>&quot;4MB chunks always&quot;</td>
<td>Shows lack of understanding</td>
<td>&quot;Chunk size depends on use case - smaller for text (more dedup), larger for video (less overhead)&quot;</td>
</tr>
<tr>
<td>&quot;Just store files on the server filesystem&quot;</td>
<td>Doesn't scale</td>
<td>&quot;Local filesystem for caching, S3 for durable storage&quot;</td>
</tr>
</tbody>
</table>
</div>
<h3 id="impressive-statements-what-to-say-impressive-statements">Impressive Statements (What TO Say) {#impressive-statements}</h3>
<div style="background: linear-gradient(135deg, #1f3d1f 0%, #3a5d3a 100%); border-radius: 10px; padding: 20px; margin: 16px 0">
<table>
<thead>
<tr>
<th>Topic</th>
<th>Impressive Statement</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Pragmatism</strong></td>
<td>&quot;For &lt; 10K files, just store in S3 with PostgreSQL metadata - no chunking needed. Chunking adds complexity that only pays off at scale.&quot;</td>
</tr>
<tr>
<td><strong>Trade-off awareness</strong></td>
<td>&quot;Dropbox's delta sync is overkill for most apps. It's critical for their use case of syncing frequently-edited files, but for a document management system, whole-file sync is fine.&quot;</td>
</tr>
<tr>
<td><strong>Cost consciousness</strong></td>
<td>&quot;At Google Drive scale, the difference between 4MB and 8MB chunks saves petabytes. At startup scale, it's a premature optimization.&quot;</td>
</tr>
<tr>
<td><strong>Security depth</strong></td>
<td>&quot;We encrypt at rest with S3 SSE-KMS, but for truly sensitive files, we'd offer client-side encryption where we never see the plaintext.&quot;</td>
</tr>
<tr>
<td><strong>Failure modes</strong></td>
<td>&quot;The hardest part isn't the upload - it's handling a partial upload that crashes. We need idempotent chunk uploads and a background job to clean up orphaned chunks.&quot;</td>
</tr>
<tr>
<td><strong>User empathy</strong></td>
<td>&quot;Conflict resolution isn't a technical problem, it's a UX problem. Users don't care about vector clocks - they care about not losing their work.&quot;</td>
</tr>
</tbody>
</table>
</div>
<h3 id="common-follow-up-questions-common-follow-up">Common Follow-up Questions {#common-follow-up}</h3>
<div style="background: #f8fafc; border-radius: 10px; padding: 20px; margin: 16px 0">
<pre><code>- **How do you handle large files (10GB+)?** Chunking with parallel upload, resumability
- **How do you ensure 11 nines durability?** S3's built-in replication, cross-region for critical data
- **How do you implement real-time collaboration?** Operational Transform or CRDT, separate problem from file sync
- **How do you handle offline editing?** Local SQLite + file watcher, queue changes, reconcile on reconnect
- **How do you prevent malware uploads?** Async virus scanning, quarantine until scanned, signed URLs expire
- **How do you handle quota?** Pre-check before upload, atomic increment, background recalculation for dedup credits
</code></pre>
</div>
</div>
