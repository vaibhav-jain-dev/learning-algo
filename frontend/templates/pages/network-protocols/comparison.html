<style>
    .protocol-section { background: var(--bg-secondary, #f8fafc); padding: 24px; border-radius: 12px; margin-bottom: 24px; border: 1px solid var(--border-color, #e2e8f0); }
    .protocol-section h2 { font-size: 1.5rem; margin-bottom: 12px; color: var(--accent-primary, #3b82f6); }
    .protocol-section h3 { font-size: 1.2rem; margin-top: 20px; margin-bottom: 12px; color: var(--accent-secondary, #8b5cf6); }
    .diagram-container { background: var(--bg-tertiary, #f1f5f9); padding: 20px; border-radius: 10px; margin: 20px 0; overflow-x: auto; }
    .comparison-table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 0.9rem; }
    .comparison-table th, .comparison-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
    .comparison-table th { background: var(--bg-tertiary); font-weight: 600; }
    .feature-best { background: rgba(16, 185, 129, 0.15); color: #047857; font-weight: 600; }
    .feature-good { background: rgba(59, 130, 246, 0.15); color: #1d4ed8; }
    .feature-ok { background: rgba(245, 158, 11, 0.15); color: #b45309; }
    .feature-poor { background: rgba(239, 68, 68, 0.15); color: #b91c1c; }
    .decision-card { background: var(--bg-tertiary); padding: 20px; border-radius: 10px; margin-bottom: 16px; border-left: 4px solid var(--accent-primary); }
    .decision-card h4 { color: var(--accent-primary); margin-bottom: 12px; }
    .benchmark-bar { height: 24px; border-radius: 4px; margin: 8px 0; display: flex; align-items: center; padding-left: 8px; color: white; font-size: 0.85rem; font-weight: 600; }
    .highlight-box { background: rgba(59, 130, 246, 0.08); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent-primary); margin: 16px 0; }
    .code-example { background: #f8f9fa; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin: 16px 0; overflow-x: auto; }
    .code-example pre { margin: 0; color: #1e293b; font-family: 'Fira Code', monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; }

    /* Flow Diagram Styles */
    .flow-diagram { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 12px; padding: 24px; margin: 20px 0; }
    .flow-vertical { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .flow-step { display: flex; align-items: center; gap: 12px; width: 100%; max-width: 500px; }
    .flow-num { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
    .flow-content { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 10px 14px; flex: 1; }
    .flow-content.blue { border-left: 3px solid #3b82f6; }
    .flow-content.green { border-left: 3px solid #10b981; }
    .flow-content.purple { border-left: 3px solid #8b5cf6; }
    .flow-content.orange { border-left: 3px solid #f59e0b; }
    .flow-content.cyan { border-left: 3px solid #06b6d4; }
    .flow-content.red { border-left: 3px solid #ef4444; }
    .flow-title { color: #f8fafc; font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
    .flow-desc { color: #94a3b8; font-size: 0.75rem; }
    .flow-arrow { color: #475569; font-size: 1.2rem; text-align: center; }
    .flow-row { display: flex; align-items: center; justify-content: flex-start; gap: 8px; margin: 8px 0; flex-wrap: wrap; }
    .flow-box { background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.4); color: #93c5fd; padding: 8px 14px; border-radius: 6px; font-size: 0.8rem; font-weight: 500; }
    .flow-box.active { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border-color: #3b82f6; }
    .flow-box.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-color: #10b981; }
    .flow-box.warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border-color: #f59e0b; }
    .flow-box.error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border-color: #ef4444; }
    .flow-box.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-color: #8b5cf6; }
    .flow-box.cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white; border-color: #06b6d4; }

    /* Protocol Comparison Grid */
    .protocol-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 20px 0; }
    @media (max-width: 768px) { .protocol-grid { grid-template-columns: 1fr; } }
    .protocol-card { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 12px; padding: 20px; }
    .protocol-card h4 { color: #f8fafc; font-size: 1rem; margin-bottom: 12px; text-align: center; padding-bottom: 8px; border-bottom: 2px solid rgba(255,255,255,0.1); }
    .protocol-card.rest h4 { border-bottom-color: #ef4444; }
    .protocol-card.graphql h4 { border-bottom-color: #f59e0b; }
    .protocol-card.grpc h4 { border-bottom-color: #3b82f6; }
    .protocol-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .protocol-item:last-child { border-bottom: none; }
    .protocol-label { color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
    .protocol-value { color: #f8fafc; font-size: 0.85rem; }
    .protocol-highlight { padding: 6px 10px; border-radius: 4px; display: inline-block; font-weight: 600; font-size: 0.8rem; margin-top: 4px; }
    .protocol-highlight.red { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
    .protocol-highlight.orange { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
    .protocol-highlight.blue { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }
    .protocol-highlight.green { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }

    /* Architecture Diagram */
    .arch-diagram { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 16px; padding: 30px; margin: 20px 0; overflow-x: auto; }
    .arch-row { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
    .arch-box { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 10px 16px; border-radius: 8px; font-size: 0.85rem; font-weight: 500; text-align: center; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
    .arch-box.green { background: linear-gradient(135deg, #10b981 0%, #059669 100%); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
    .arch-box.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3); }
    .arch-box.orange { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3); }
    .arch-box.red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); }
    .arch-box.cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3); }
    .arch-arrow { color: #64748b; font-size: 1.5rem; }
    .arch-arrow-down { display: flex; justify-content: center; color: #64748b; font-size: 1.5rem; margin: 8px 0; }
    .arch-layer { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; }
    .arch-layer-title { color: #94a3b8; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; text-align: center; }
</style>

<div class="page-layout">
    <div class="page-main">
        <nav style="margin-bottom: 16px;"><a href="/network-protocols" style="color: var(--accent-primary);">&larr; Back to Network Protocols</a></nav>

        <h1>Protocol Comparison</h1>
        <p class="text-muted mb-4">REST vs GraphQL vs gRPC - when to use each, performance benchmarks, and decision guide</p>

        <!-- Visual Comparison -->
        <div class="protocol-section">
            <h2>Visual Comparison</h2>

            <div class="protocol-grid">
                <!-- REST Card -->
                <div class="protocol-card rest">
                    <h4>REST</h4>
                    <div class="protocol-item">
                        <div class="protocol-label">Endpoints</div>
                        <div class="protocol-value">Multiple Endpoints</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Requests</div>
                        <div class="protocol-value">GET /users/123</div>
                        <div class="protocol-value">GET /users/123/posts</div>
                        <div class="protocol-value">GET /posts/1/comments</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Round Trips</div>
                        <div class="protocol-highlight red">3 HTTP Requests</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Response</div>
                        <div class="protocol-value">JSON Response</div>
                    </div>
                </div>

                <!-- GraphQL Card -->
                <div class="protocol-card graphql">
                    <h4>GraphQL</h4>
                    <div class="protocol-item">
                        <div class="protocol-label">Endpoints</div>
                        <div class="protocol-value">Single Endpoint</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Requests</div>
                        <div class="protocol-value">POST /graphql</div>
                        <div class="protocol-value" style="font-size: 0.75rem; color: #94a3b8;">Query: user + posts + comments</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Round Trips</div>
                        <div class="protocol-highlight green">1 HTTP Request</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Response</div>
                        <div class="protocol-value">Exact Data Needed</div>
                    </div>
                </div>

                <!-- gRPC Card -->
                <div class="protocol-card grpc">
                    <h4>gRPC</h4>
                    <div class="protocol-item">
                        <div class="protocol-label">Endpoints</div>
                        <div class="protocol-value">RPC Methods</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Requests</div>
                        <div class="protocol-value">GetUser(123)</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Format</div>
                        <div class="protocol-highlight blue">Binary Protobuf</div>
                    </div>
                    <div class="protocol-item">
                        <div class="protocol-label">Features</div>
                        <div class="protocol-value">HTTP/2 Streaming</div>
                        <div class="protocol-value">Code Generated Clients</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Comparison -->
        <div class="protocol-section">
            <h2>Feature Comparison</h2>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>REST</th>
                        <th>GraphQL</th>
                        <th>gRPC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Data Format</strong></td>
                        <td>JSON/XML</td>
                        <td>JSON</td>
                        <td class="feature-best">Protobuf (binary)</td>
                    </tr>
                    <tr>
                        <td><strong>Protocol</strong></td>
                        <td>HTTP/1.1+</td>
                        <td>HTTP/1.1+</td>
                        <td class="feature-best">HTTP/2</td>
                    </tr>
                    <tr>
                        <td><strong>Schema</strong></td>
                        <td class="feature-ok">Optional (OpenAPI)</td>
                        <td class="feature-best">Required (SDL)</td>
                        <td class="feature-best">Required (.proto)</td>
                    </tr>
                    <tr>
                        <td><strong>Type Safety</strong></td>
                        <td class="feature-poor">Runtime only</td>
                        <td class="feature-good">Schema validation</td>
                        <td class="feature-best">Compile-time</td>
                    </tr>
                    <tr>
                        <td><strong>Browser Support</strong></td>
                        <td class="feature-best">Native</td>
                        <td class="feature-best">Native</td>
                        <td class="feature-poor">gRPC-Web only</td>
                    </tr>
                    <tr>
                        <td><strong>Streaming</strong></td>
                        <td class="feature-ok">SSE only</td>
                        <td class="feature-good">Subscriptions</td>
                        <td class="feature-best">Bidirectional</td>
                    </tr>
                    <tr>
                        <td><strong>Caching</strong></td>
                        <td class="feature-best">HTTP caching</td>
                        <td class="feature-poor">Complex</td>
                        <td class="feature-ok">Manual</td>
                    </tr>
                    <tr>
                        <td><strong>Learning Curve</strong></td>
                        <td class="feature-best">Low</td>
                        <td class="feature-good">Medium</td>
                        <td class="feature-ok">High</td>
                    </tr>
                    <tr>
                        <td><strong>Tooling</strong></td>
                        <td class="feature-best">Extensive</td>
                        <td class="feature-good">Good</td>
                        <td class="feature-good">Growing</td>
                    </tr>
                    <tr>
                        <td><strong>Over-fetching</strong></td>
                        <td class="feature-poor">Common</td>
                        <td class="feature-best">Never</td>
                        <td class="feature-good">Rare</td>
                    </tr>
                    <tr>
                        <td><strong>Code Generation</strong></td>
                        <td class="feature-ok">Optional</td>
                        <td class="feature-good">TypeScript types</td>
                        <td class="feature-best">Full stubs</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Performance Benchmarks -->
        <div class="protocol-section">
            <h2>Performance Benchmarks</h2>
            <p>Relative performance for a typical API call (lower is better for latency, higher for throughput):</p>

            <h3>Latency (Median Request Time)</h3>
            <div class="benchmark-bar" style="width: 100%; background: #ef4444;">REST: ~50ms</div>
            <div class="benchmark-bar" style="width: 75%; background: #f59e0b;">GraphQL: ~40ms</div>
            <div class="benchmark-bar" style="width: 30%; background: #10b981;">gRPC: ~15ms</div>

            <h3>Payload Size (Same Data)</h3>
            <div class="benchmark-bar" style="width: 100%; background: #ef4444;">REST JSON: 1000 bytes</div>
            <div class="benchmark-bar" style="width: 100%; background: #f59e0b;">GraphQL: 1000 bytes</div>
            <div class="benchmark-bar" style="width: 15%; background: #10b981;">gRPC Protobuf: 150 bytes</div>

            <h3>Throughput (Requests/Second)</h3>
            <div class="benchmark-bar" style="width: 40%; background: #ef4444;">REST: 10,000 rps</div>
            <div class="benchmark-bar" style="width: 50%; background: #f59e0b;">GraphQL: 12,000 rps</div>
            <div class="benchmark-bar" style="width: 100%; background: #10b981;">gRPC: 25,000 rps</div>

            <p style="margin-top: 16px; font-size: 0.9rem; color: var(--text-secondary);">
                * Benchmarks vary by implementation, hardware, and use case. These are typical relative differences.
            </p>
        </div>

        <!-- Decision Guide -->
        <div class="protocol-section">
            <h2>Decision Guide: When to Use Each</h2>

            <div class="decision-card">
                <h4>Choose REST When...</h4>
                <ul>
                    <li>Building public APIs for third-party developers</li>
                    <li>Simple CRUD operations are the main use case</li>
                    <li>HTTP caching is important (GET requests)</li>
                    <li>Team is familiar with REST conventions</li>
                    <li>Need browser-native support without any libraries</li>
                    <li>Debugging with simple tools (curl, Postman)</li>
                </ul>
                <p><strong>Examples:</strong> Stripe API, Twitter API, GitHub REST API</p>
            </div>

            <div class="decision-card">
                <h4>Choose GraphQL When...</h4>
                <ul>
                    <li>Frontend needs flexible data fetching</li>
                    <li>Multiple clients with different data needs (web, mobile, TV)</li>
                    <li>Reducing round trips is critical (mobile apps)</li>
                    <li>Rapid frontend development without backend changes</li>
                    <li>Complex, nested data relationships</li>
                    <li>Need built-in documentation (introspection)</li>
                </ul>
                <p><strong>Examples:</strong> GitHub GraphQL API, Shopify Storefront, Airbnb</p>
            </div>

            <div class="decision-card">
                <h4>Choose gRPC When...</h4>
                <ul>
                    <li>Internal microservices communication</li>
                    <li>Performance is critical (ML inference, gaming)</li>
                    <li>Need bidirectional streaming</li>
                    <li>Polyglot environment (multiple languages)</li>
                    <li>Strong typing and code generation are priorities</li>
                    <li>Bandwidth is constrained (IoT, mobile)</li>
                </ul>
                <p><strong>Examples:</strong> Kubernetes, Netflix microservices, TensorFlow Serving</p>
            </div>
        </div>

        <!-- Common Patterns -->
        <div class="protocol-section">
            <h2>Common Architecture Patterns</h2>

            <h3>Pattern 1: REST for Public, gRPC for Internal</h3>
            <div class="arch-diagram">
                <div class="arch-row">
                    <div class="arch-box">Web/Mobile Client</div>
                </div>
                <div class="arch-arrow-down">↓ <span style="font-size: 0.7rem; color: #94a3b8;">REST/GraphQL</span></div>
                <div class="arch-row">
                    <div class="arch-box purple">API Gateway</div>
                </div>
                <div style="display: flex; justify-content: center; gap: 40px; margin-top: 16px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓ <span style="font-size: 0.65rem; color: #94a3b8;">gRPC</span></div>
                        <div class="arch-box green">User Service</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓ <span style="font-size: 0.65rem; color: #94a3b8;">gRPC</span></div>
                        <div class="arch-box green">Order Service</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓ <span style="font-size: 0.65rem; color: #94a3b8;">gRPC</span></div>
                        <div class="arch-box green">Payment Service</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 16px;">
                    <div style="color: #64748b; font-size: 0.75rem;">Services communicate via gRPC internally</div>
                </div>
            </div>
            <p>Use REST or GraphQL at the edge (public-facing), gRPC between internal services for performance.</p>

            <h3>Pattern 2: GraphQL Federation</h3>
            <div class="arch-diagram">
                <div class="arch-row">
                    <div class="arch-box">Client</div>
                </div>
                <div class="arch-arrow-down">↓ <span style="font-size: 0.7rem; color: #94a3b8;">GraphQL</span></div>
                <div class="arch-row">
                    <div class="arch-box purple">GraphQL Gateway</div>
                </div>
                <div style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓</div>
                        <div class="arch-box cyan">User Subgraph</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓</div>
                        <div class="arch-box cyan">Product Subgraph</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="arch-arrow-down">↓</div>
                        <div class="arch-box cyan">Order Subgraph</div>
                    </div>
                </div>
            </div>
            <p>Each team owns their subgraph. Gateway combines them into unified schema.</p>

            <h3>Pattern 3: BFF (Backend for Frontend)</h3>
            <div class="arch-diagram">
                <div style="display: flex; justify-content: center; gap: 60px; flex-wrap: wrap;">
                    <div style="text-align: center;">
                        <div class="arch-box">Web App</div>
                        <div class="arch-arrow-down">↓</div>
                        <div class="arch-box green">Web BFF (REST)</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="arch-box">Mobile App</div>
                        <div class="arch-arrow-down">↓</div>
                        <div class="arch-box purple">Mobile BFF (GraphQL)</div>
                    </div>
                </div>
                <div class="arch-arrow-down" style="margin-top: 16px;">↓</div>
                <div class="arch-row">
                    <div class="arch-box orange">Backend Services (gRPC)</div>
                </div>
            </div>
            <p>Different BFFs optimize for each client type.</p>
        </div>

        <!-- Migration Strategies -->
        <div class="protocol-section">
            <h2>Migration Strategies</h2>

            <h3>REST to GraphQL</h3>
            <ul>
                <li><strong>Strangler Pattern:</strong> Add GraphQL alongside REST, migrate endpoints gradually</li>
                <li><strong>Schema-first:</strong> Design GraphQL schema that wraps existing REST endpoints</li>
                <li><strong>Use Apollo Federation:</strong> Start with one service, expand</li>
            </ul>

            <h3>REST to gRPC</h3>
            <ul>
                <li><strong>Start Internal:</strong> Migrate service-to-service calls first</li>
                <li><strong>gRPC Gateway:</strong> Auto-generate REST endpoints from proto files</li>
                <li><strong>Dual Support:</strong> Support both protocols during migration</li>
            </ul>

            <div class="highlight-box">
                <strong>Tip:</strong> You don't have to choose just one! Many successful systems use:
                <ul style="margin-top: 8px;">
                    <li>REST for simple public APIs</li>
                    <li>GraphQL for complex frontend data needs</li>
                    <li>gRPC for internal microservice communication</li>
                </ul>
            </div>
        </div>

        <!-- Summary -->
        <div class="protocol-section">
            <h2>Quick Decision Matrix</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Scenario</th>
                        <th>Recommendation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Public API for developers</td><td class="feature-best">REST</td></tr>
                    <tr><td>Mobile app with varying data needs</td><td class="feature-best">GraphQL</td></tr>
                    <tr><td>Microservices communication</td><td class="feature-best">gRPC</td></tr>
                    <tr><td>Real-time bidirectional streaming</td><td class="feature-best">gRPC</td></tr>
                    <tr><td>Simple CRUD web app</td><td class="feature-best">REST</td></tr>
                    <tr><td>ML model serving</td><td class="feature-best">gRPC</td></tr>
                    <tr><td>Multiple client types (web/mobile/TV)</td><td class="feature-best">GraphQL</td></tr>
                    <tr><td>Browser-only application</td><td class="feature-good">REST or GraphQL</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <aside class="page-sidebar">
        <div class="panel">
            <div class="panel-header">Quick Pick</div>
            <div class="quick-ref-item"><span class="quick-ref-key">Public API</span><span class="quick-ref-value">REST</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Mobile</span><span class="quick-ref-value">GraphQL</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Microservices</span><span class="quick-ref-value">gRPC</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Learn More</div>
            <a href="/network-protocols/rest" class="quick-ref-item" style="display:block;text-decoration:none;">REST Details</a>
            <a href="/network-protocols/graphql" class="quick-ref-item" style="display:block;text-decoration:none;">GraphQL Details</a>
            <a href="/network-protocols/grpc" class="quick-ref-item" style="display:block;text-decoration:none;">gRPC Details</a>
        </div>
    </aside>
</div>
