<style>
    .protocol-section { background: var(--bg-secondary, #f8fafc); padding: 24px; border-radius: 12px; margin-bottom: 24px; border: 1px solid var(--border-color, #e2e8f0); }
    .protocol-section h2 { font-size: 1.5rem; margin-bottom: 12px; color: var(--accent-primary, #3b82f6); }
    .protocol-section h3 { font-size: 1.2rem; margin-top: 20px; margin-bottom: 12px; color: var(--accent-secondary, #8b5cf6); }
    .diagram-container { background: var(--bg-tertiary, #f1f5f9); padding: 20px; border-radius: 10px; margin: 20px 0; overflow-x: auto; }
    .code-example { background: #1e293b; border-radius: 8px; padding: 16px; margin: 16px 0; overflow-x: auto; }
    .code-example pre { margin: 0; color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; }
    .highlight-box { background: rgba(59, 130, 246, 0.08); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent-primary); margin: 16px 0; }
    .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
    .pros, .cons { padding: 16px; border-radius: 8px; }
    .pros { background: rgba(16, 185, 129, 0.1); border-left: 4px solid #10b981; }
    .cons { background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; }
    .pros h4 { color: #10b981; } .cons h4 { color: #ef4444; }
    @media (max-width: 768px) { .pros-cons { grid-template-columns: 1fr; } }
    .streaming-card { background: var(--bg-tertiary); padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid var(--accent-secondary); }
    .comparison-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
    .comparison-table th, .comparison-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
    .comparison-table th { background: var(--bg-tertiary); }

    /* Flow Diagram Styles */
    .flow-diagram { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 12px; padding: 24px; margin: 20px 0; }
    .flow-vertical { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .flow-step { display: flex; align-items: center; gap: 12px; width: 100%; max-width: 600px; }
    .flow-num { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
    .flow-content { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 10px 14px; flex: 1; }
    .flow-content.blue { border-left: 3px solid #3b82f6; }
    .flow-content.green { border-left: 3px solid #10b981; }
    .flow-content.purple { border-left: 3px solid #8b5cf6; }
    .flow-content.orange { border-left: 3px solid #f59e0b; }
    .flow-content.cyan { border-left: 3px solid #06b6d4; }
    .flow-title { color: #f8fafc; font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
    .flow-desc { color: #94a3b8; font-size: 0.75rem; }
    .flow-arrow { color: #475569; font-size: 1.2rem; }
    .flow-row { display: flex; align-items: center; justify-content: flex-start; gap: 8px; margin: 12px 0; flex-wrap: wrap; }
    .flow-box { background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.4); color: #93c5fd; padding: 8px 14px; border-radius: 6px; font-size: 0.8rem; font-weight: 500; }
    .flow-box.active { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border-color: #3b82f6; }
    .flow-box.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-color: #10b981; }
    .flow-box.purple { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-color: #8b5cf6; }
    .flow-note { background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); color: #fcd34d; padding: 6px 12px; border-radius: 6px; font-size: 0.7rem; margin: 8px 0; }
</style>

<div class="page-layout">
    <div class="page-main">
        <nav style="margin-bottom: 16px;"><a href="/network-protocols" style="color: var(--accent-primary);">&larr; Back to Network Protocols</a></nav>

        <h1>gRPC</h1>
        <p class="text-muted mb-4">High-performance RPC framework using Protocol Buffers - ideal for microservices and ML systems</p>

        <div class="protocol-section">
            <h2>What is gRPC?</h2>
            <p>gRPC (Google Remote Procedure Call) is a high-performance RPC framework that uses Protocol Buffers for serialization and HTTP/2 for transport. It enables efficient communication between services with features like bidirectional streaming and automatic code generation.</p>

            <h3>Request-Response Flow</h3>
            <div class="flow-diagram">
                <div class="flow-vertical">
                    <div class="flow-step">
                        <div class="flow-num">1</div>
                        <div class="flow-content blue">
                            <div class="flow-title">Client</div>
                            <div class="flow-desc">Call GetUser(id: 123)</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">2</div>
                        <div class="flow-content purple">
                            <div class="flow-title">Client Stub</div>
                            <div class="flow-desc">Serialize to Protobuf (binary)</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">3</div>
                        <div class="flow-content orange">
                            <div class="flow-title">HTTP/2 Transport</div>
                            <div class="flow-desc">POST /UserService/GetUser - Binary payload (~10x smaller than JSON)</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">4</div>
                        <div class="flow-content cyan">
                            <div class="flow-title">gRPC Server</div>
                            <div class="flow-desc">Deserialize request, route to handler</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">5</div>
                        <div class="flow-content green">
                            <div class="flow-title">Handler</div>
                            <div class="flow-desc">Execute business logic, return User object</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">6</div>
                        <div class="flow-content purple">
                            <div class="flow-title">Serialize Response</div>
                            <div class="flow-desc">Convert to Protobuf, send via HTTP/2</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">7</div>
                        <div class="flow-content blue">
                            <div class="flow-title">Client Receives</div>
                            <div class="flow-desc">Deserialize to typed object: User {id: 123, name: "John"}</div>
                        </div>
                    </div>
                </div>
            </div>

            <h3>Key Features</h3>
            <ul>
                <li><strong>Protocol Buffers:</strong> Binary serialization - 3-10x smaller and faster than JSON</li>
                <li><strong>HTTP/2:</strong> Multiplexing, streaming, header compression</li>
                <li><strong>Code Generation:</strong> Generate client/server stubs from .proto files</li>
                <li><strong>Streaming:</strong> Unary, server streaming, client streaming, bidirectional</li>
                <li><strong>Deadlines/Timeouts:</strong> Built-in support for request deadlines</li>
                <li><strong>Interceptors:</strong> Middleware for logging, auth, metrics</li>
            </ul>
        </div>

        <div class="protocol-section">
            <h2>Protocol Buffers (Protobuf)</h2>
            <p>The schema definition language for gRPC. Define your data structures and services, then generate code.</p>

            <div class="code-example">
                <pre><code class="language-protobuf">// user.proto - Service definition
syntax = "proto3";

package user;

option go_package = "./pb";

// Message definitions
message User {
  int32 id = 1;
  string name = 2;
  string email = 3;
  repeated string roles = 4;  // Array
  optional string phone = 5;  // Optional field
}

message GetUserRequest {
  int32 id = 1;
}

message CreateUserRequest {
  string name = 1;
  string email = 2;
}

message ListUsersRequest {
  int32 page = 1;
  int32 page_size = 2;
}

message ListUsersResponse {
  repeated User users = 1;
  int32 total = 2;
}

// Service definition
service UserService {
  // Unary RPC
  rpc GetUser(GetUserRequest) returns (User);
  rpc CreateUser(CreateUserRequest) returns (User);

  // Server streaming - server sends multiple responses
  rpc ListUsers(ListUsersRequest) returns (stream User);

  // Client streaming - client sends multiple requests
  rpc UploadUsers(stream User) returns (ListUsersResponse);

  // Bidirectional streaming
  rpc Chat(stream ChatMessage) returns (stream ChatMessage);
}</code></pre>
            </div>
        </div>

        <div class="protocol-section">
            <h2>Streaming Patterns</h2>

            <div class="streaming-card">
                <h4>1. Unary RPC (Request-Response)</h4>
                <p>Standard single request, single response. Like REST.</p>
                <div class="flow-diagram" style="padding: 16px;">
                    <div class="flow-row" style="justify-content: center;">
                        <div class="flow-box active">Client</div>
                        <span class="flow-arrow">→</span>
                        <span style="color: #94a3b8; font-size: 0.75rem;">GetUser(id: 123)</span>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box purple">Server</div>
                    </div>
                    <div class="flow-row" style="justify-content: center;">
                        <div class="flow-box active">Client</div>
                        <span class="flow-arrow">←</span>
                        <span style="color: #94a3b8; font-size: 0.75rem;">User {name: "John"}</span>
                        <span class="flow-arrow">←</span>
                        <div class="flow-box purple">Server</div>
                    </div>
                </div>
            </div>

            <div class="streaming-card">
                <h4>2. Server Streaming</h4>
                <p>Client sends one request, server streams multiple responses.</p>
                <div class="flow-diagram" style="padding: 16px;">
                    <div class="flow-row" style="justify-content: center;">
                        <div class="flow-box active">Client</div>
                        <span class="flow-arrow">→</span>
                        <span style="color: #94a3b8; font-size: 0.75rem;">ListUsers(page: 1)</span>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box purple">Server</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 12px;">
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box success">User 1</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box success">User 2</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box success">User 3</div>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">←</span>
                            <span style="color: #10b981; font-size: 0.75rem;">Stream complete ✓</span>
                            <span class="flow-arrow">←</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                    </div>
                </div>
                <p><strong>Use case:</strong> Large data downloads, real-time feeds, log streaming</p>
            </div>

            <div class="streaming-card">
                <h4>3. Client Streaming</h4>
                <p>Client streams multiple requests, server sends one response.</p>
                <div class="flow-diagram" style="padding: 16px;">
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box">User 1</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box">User 2</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box">User 3</div>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                        <div class="flow-row" style="justify-content: center;">
                            <div class="flow-box active">Client</div>
                            <span class="flow-arrow">→</span>
                            <span style="color: #f59e0b; font-size: 0.75rem;">Stream complete</span>
                            <span class="flow-arrow">→</span>
                            <div class="flow-box purple">Server</div>
                        </div>
                    </div>
                    <div class="flow-row" style="justify-content: center; margin-top: 12px;">
                        <div class="flow-box active">Client</div>
                        <span class="flow-arrow">←</span>
                        <div class="flow-box success">ImportResult {count: 3}</div>
                        <span class="flow-arrow">←</span>
                        <div class="flow-box purple">Server</div>
                    </div>
                </div>
                <p><strong>Use case:</strong> File uploads, batch imports, sensor data collection</p>
            </div>

            <div class="streaming-card">
                <h4>4. Bidirectional Streaming</h4>
                <p>Both client and server stream simultaneously.</p>
                <div class="flow-diagram" style="padding: 16px;">
                    <div style="display: flex; gap: 30px; flex-wrap: wrap; justify-content: center;">
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.7rem; margin-bottom: 8px;">Client to Server</div>
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                <div class="flow-row">
                                    <div class="flow-box active">Client</div>
                                    <span class="flow-arrow">→</span>
                                    <div class="flow-box">Message A</div>
                                </div>
                                <div class="flow-row">
                                    <div class="flow-box active">Client</div>
                                    <span class="flow-arrow">→</span>
                                    <div class="flow-box">Message B</div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.7rem; margin-bottom: 8px;">Server to Client</div>
                            <div style="display: flex; flex-direction: column; gap: 6px;">
                                <div class="flow-row">
                                    <div class="flow-box success">Response X</div>
                                    <span class="flow-arrow">←</span>
                                    <div class="flow-box purple">Server</div>
                                </div>
                                <div class="flow-row">
                                    <div class="flow-box success">Response Y</div>
                                    <span class="flow-arrow">←</span>
                                    <div class="flow-box purple">Server</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flow-note" style="text-align: center; margin-top: 12px;">Both streams operate independently and simultaneously</div>
                </div>
                <p><strong>Use case:</strong> Chat applications, gaming, real-time collaboration</p>
            </div>
        </div>

        <div class="protocol-section">
            <h2>Code Examples</h2>

            <h3>Python Server</h3>
            <div class="code-example">
                <pre><code class="language-python">import grpc
from concurrent import futures
import user_pb2
import user_pb2_grpc

class UserService(user_pb2_grpc.UserServiceServicer):

    def __init__(self):
        self.users = {}
        self.next_id = 1

    def GetUser(self, request, context):
        user = self.users.get(request.id)
        if not user:
            context.abort(grpc.StatusCode.NOT_FOUND, "User not found")
        return user

    def CreateUser(self, request, context):
        user = user_pb2.User(
            id=self.next_id,
            name=request.name,
            email=request.email
        )
        self.users[self.next_id] = user
        self.next_id += 1
        return user

    def ListUsers(self, request, context):
        # Server streaming - yield multiple responses
        for user in list(self.users.values()):
            yield user

def serve():
    server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))
    user_pb2_grpc.add_UserServiceServicer_to_server(UserService(), server)
    server.add_insecure_port('[::]:50051')
    server.start()
    server.wait_for_termination()

if __name__ == '__main__':
    serve()</code></pre>
            </div>

            <h3>Go Server</h3>
            <div class="code-example">
                <pre><code class="language-go">package main

import (
    "context"
    "log"
    "net"
    "google.golang.org/grpc"
    pb "myapp/proto"
)

type server struct {
    pb.UnimplementedUserServiceServer
    users  map[int32]*pb.User
    nextID int32
}

func (s *server) GetUser(ctx context.Context, req *pb.GetUserRequest) (*pb.User, error) {
    user, exists := s.users[req.Id]
    if !exists {
        return nil, status.Error(codes.NotFound, "user not found")
    }
    return user, nil
}

func (s *server) CreateUser(ctx context.Context, req *pb.CreateUserRequest) (*pb.User, error) {
    user := &pb.User{
        Id:    s.nextID,
        Name:  req.Name,
        Email: req.Email,
    }
    s.users[s.nextID] = user
    s.nextID++
    return user, nil
}

// Server streaming
func (s *server) ListUsers(req *pb.ListUsersRequest, stream pb.UserService_ListUsersServer) error {
    for _, user := range s.users {
        if err := stream.Send(user); err != nil {
            return err
        }
    }
    return nil
}

func main() {
    lis, _ := net.Listen("tcp", ":50051")
    s := grpc.NewServer()
    pb.RegisterUserServiceServer(s, &server{users: make(map[int32]*pb.User), nextID: 1})
    log.Fatal(s.Serve(lis))
}</code></pre>
            </div>

            <h3>Python Client</h3>
            <div class="code-example">
                <pre><code class="language-python">import grpc
import user_pb2
import user_pb2_grpc

# Create channel and stub
channel = grpc.insecure_channel('localhost:50051')
stub = user_pb2_grpc.UserServiceStub(channel)

# Unary call
user = stub.CreateUser(user_pb2.CreateUserRequest(name="John", email="john@example.com"))
print(f"Created: {user.id}, {user.name}")

# Get user
user = stub.GetUser(user_pb2.GetUserRequest(id=1))
print(f"Got: {user.name}")

# Server streaming - iterate over responses
for user in stub.ListUsers(user_pb2.ListUsersRequest()):
    print(f"User: {user.name}")</code></pre>
            </div>
        </div>

        <div class="protocol-section">
            <h2>When to Use gRPC</h2>

            <div class="pros-cons">
                <div class="pros">
                    <h4>Advantages</h4>
                    <ul>
                        <li>10x faster than JSON (binary serialization)</li>
                        <li>Strongly typed with code generation</li>
                        <li>Bidirectional streaming support</li>
                        <li>Built-in deadlines and cancellation</li>
                        <li>Language agnostic (10+ languages)</li>
                        <li>Excellent for microservices</li>
                    </ul>
                </div>
                <div class="cons">
                    <h4>Disadvantages</h4>
                    <ul>
                        <li>No native browser support (needs gRPC-Web)</li>
                        <li>Binary format harder to debug</li>
                        <li>Learning curve for Protobuf</li>
                        <li>Less human-readable than JSON</li>
                        <li>Schema changes need careful handling</li>
                        <li>Less tooling than REST</li>
                    </ul>
                </div>
            </div>

            <div class="highlight-box">
                <strong>Best For:</strong> Microservices communication, ML model serving (TensorFlow Serving, Triton), real-time systems, mobile backends where bandwidth matters, polyglot environments.
            </div>
        </div>

        <div class="protocol-section">
            <h2>Real-World Examples</h2>
            <ul>
                <li><strong>Google:</strong> Uses gRPC internally for all service communication</li>
                <li><strong>Netflix:</strong> gRPC between microservices for low latency</li>
                <li><strong>Dropbox:</strong> Migrated from REST to gRPC for 10x performance</li>
                <li><strong>Square:</strong> All internal APIs use gRPC</li>
                <li><strong>Kubernetes:</strong> etcd uses gRPC for cluster state</li>
                <li><strong>TensorFlow Serving:</strong> ML model inference over gRPC</li>
            </ul>
        </div>
    </div>

    <aside class="page-sidebar">
        <div class="panel">
            <div class="panel-header">Streaming Types</div>
            <div class="quick-ref-item"><span class="quick-ref-key">Unary</span><span class="quick-ref-value">1 req, 1 res</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Server</span><span class="quick-ref-value">1 req, N res</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Client</span><span class="quick-ref-value">N req, 1 res</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Bidi</span><span class="quick-ref-value">N req, N res</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Performance</div>
            <div class="quick-ref-item"><span class="quick-ref-key">Serialization</span><span class="quick-ref-value">3-10x faster</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Payload</span><span class="quick-ref-value">~10x smaller</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Related</div>
            <a href="/network-protocols/rest" class="quick-ref-item" style="display:block;text-decoration:none;">REST API</a>
            <a href="/network-protocols/comparison" class="quick-ref-item" style="display:block;text-decoration:none;">Comparison</a>
        </div>
    </aside>
</div>
