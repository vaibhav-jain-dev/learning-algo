<style>
    .protocol-section {
        background: var(--bg-secondary, #f8fafc);
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid var(--border-color, #e2e8f0);
    }
    .protocol-section h2 {
        font-size: 1.5rem;
        margin-bottom: 12px;
        color: var(--accent-primary, #3b82f6);
    }
    .protocol-section h3 {
        font-size: 1.2rem;
        margin-top: 20px;
        margin-bottom: 12px;
        color: var(--accent-secondary, #8b5cf6);
    }
    .diagram-container {
        background: var(--bg-tertiary, #f1f5f9);
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        overflow-x: auto;
    }
    .code-example {
        background: #1e293b;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
        overflow-x: auto;
    }
    .code-example pre {
        margin: 0;
        color: #e2e8f0;
        font-family: 'Fira Code', monospace;
        font-size: 0.9rem;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .code-example code {
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    .code-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 0;
        flex-wrap: wrap;
    }
    .code-tab {
        padding: 8px 16px;
        background: #334155;
        color: #94a3b8;
        border: none;
        border-radius: 8px 8px 0 0;
        cursor: pointer;
        font-size: 0.85rem;
    }
    .code-tab.active {
        background: #1e293b;
        color: #e2e8f0;
    }
    .code-content {
        display: none;
    }
    .code-content.active {
        display: block;
    }
    .method-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 8px;
    }
    .method-get { background: #10b981; color: white; }
    .method-post { background: #3b82f6; color: white; }
    .method-put { background: #f59e0b; color: white; }
    .method-delete { background: #ef4444; color: white; }
    .method-patch { background: #8b5cf6; color: white; }
    .endpoint-table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
    }
    .endpoint-table th, .endpoint-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }
    .endpoint-table th {
        background: var(--bg-tertiary);
        font-weight: 600;
    }
    .highlight-box {
        background: rgba(59, 130, 246, 0.08);
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid var(--accent-primary, #3b82f6);
        margin: 16px 0;
    }
    .pros-cons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin: 16px 0;
    }
    .pros, .cons {
        padding: 16px;
        border-radius: 8px;
    }
    .pros {
        background: rgba(16, 185, 129, 0.1);
        border-left: 4px solid #10b981;
    }
    .cons {
        background: rgba(239, 68, 68, 0.1);
        border-left: 4px solid #ef4444;
    }
    .pros h4 { color: #10b981; }
    .cons h4 { color: #ef4444; }

    /* Flow Diagram Styles */
    .flow-diagram {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        border-radius: 16px;
        padding: 24px;
        margin: 16px 0;
        overflow-x: auto;
    }
    .flow-vertical {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    .flow-row {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 8px;
        margin: 8px 0;
        flex-wrap: wrap;
    }
    .flow-box {
        background: rgba(59, 130, 246, 0.15);
        border: 1px solid rgba(59, 130, 246, 0.4);
        color: #93c5fd;
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        min-width: 80px;
    }
    .flow-box.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        border-color: #3b82f6;
    }
    .flow-box.success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-color: #10b981;
    }
    .flow-box.error {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border-color: #ef4444;
    }
    .flow-box.warning {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        border-color: #f59e0b;
    }
    .flow-box.purple {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        border-color: #8b5cf6;
    }
    .flow-arrow {
        color: #475569;
        font-size: 1rem;
    }
    .flow-arrow-down {
        color: #475569;
        font-size: 1rem;
        text-align: center;
        margin: 4px 0;
    }
    .flow-label {
        color: #64748b;
        font-size: 0.7rem;
        margin-top: 4px;
    }
    .flow-step {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 8px;
        margin-bottom: 8px;
    }
    .flow-step-num {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.8rem;
        flex-shrink: 0;
    }
    .flow-step-content {
        flex: 1;
    }
    .flow-step-title {
        color: #e2e8f0;
        font-weight: 500;
        font-size: 0.85rem;
        margin-bottom: 4px;
    }
    .flow-step-desc {
        color: #94a3b8;
        font-size: 0.75rem;
    }
    .flow-note {
        background: rgba(255, 255, 255, 0.05);
        border-left: 3px solid #64748b;
        padding: 8px 12px;
        margin: 8px 0;
        color: #94a3b8;
        font-size: 0.75rem;
        border-radius: 0 6px 6px 0;
    }
    .flow-note.info {
        border-color: #3b82f6;
        background: rgba(59, 130, 246, 0.1);
    }

    @media (max-width: 768px) {
        .pros-cons { grid-template-columns: 1fr; }
        .flow-row { gap: 6px; }
        .flow-box {
            padding: 6px 10px;
            font-size: 0.75rem;
            min-width: 60px;
        }
        .endpoint-table {
            font-size: 0.8rem;
        }
        .endpoint-table th, .endpoint-table td {
            padding: 8px;
        }
    }
</style>

<div class="page-layout">
    <div class="page-main">
        <nav style="margin-bottom: 16px;">
            <a href="/network-protocols" style="color: var(--accent-primary);">&larr; Back to Network Protocols</a>
        </nav>

        <h1>REST API</h1>
        <p class="text-muted mb-4">Representational State Transfer - The most widely used API architecture for web services</p>

        <!-- Overview -->
        <div class="protocol-section">
            <h2>What is REST?</h2>
            <p>REST (Representational State Transfer) is an architectural style for designing networked applications. It uses HTTP methods to perform operations on resources identified by URLs.</p>

            <h3>Request-Response Flow</h3>
            <div class="flow-diagram">
                <div class="flow-vertical">
                    <!-- Step 1: Client Request -->
                    <div class="flow-step">
                        <div class="flow-step-num">1</div>
                        <div class="flow-step-content">
                            <div class="flow-step-title">Client Request</div>
                            <div class="flow-row">
                                <div class="flow-box active">Client</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box">GET /api/users/123</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box purple">Server</div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Server Processing -->
                    <div class="flow-step">
                        <div class="flow-step-num">2</div>
                        <div class="flow-step-content">
                            <div class="flow-step-title">Server Processing</div>
                            <div class="flow-row">
                                <div class="flow-box purple">Parse URL & Method</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box warning">Authentication (JWT/API Key)</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box warning">Authorization</div>
                            </div>
                            <div class="flow-step-desc">Can access user 123?</div>
                        </div>
                    </div>

                    <!-- Step 3: Database Query -->
                    <div class="flow-step">
                        <div class="flow-step-num">3</div>
                        <div class="flow-step-content">
                            <div class="flow-step-title">Database Query</div>
                            <div class="flow-row">
                                <div class="flow-box purple">Server</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box">SELECT * FROM users WHERE id=123</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box success">Database</div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Response -->
                    <div class="flow-step">
                        <div class="flow-step-num">4</div>
                        <div class="flow-step-content">
                            <div class="flow-step-title">Serialize & Respond</div>
                            <div class="flow-row">
                                <div class="flow-box success">Database</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box">User data</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box purple">Serialize to JSON</div>
                                <span class="flow-arrow">→</span>
                                <div class="flow-box success">200 OK + JSON</div>
                            </div>
                        </div>
                    </div>

                    <!-- Response Headers Note -->
                    <div class="flow-note info">
                        <strong>Response Headers:</strong><br>
                        Content-Type: application/json<br>
                        Cache-Control: max-age=3600
                    </div>
                </div>
            </div>

            <h3>Core Principles</h3>
            <ul>
                <li><strong>Stateless:</strong> Each request contains all information needed. Server doesn't store client state.</li>
                <li><strong>Client-Server:</strong> Clear separation of concerns. Client handles UI, server handles data.</li>
                <li><strong>Cacheable:</strong> Responses can be cached to improve performance.</li>
                <li><strong>Uniform Interface:</strong> Consistent way to interact with resources using HTTP methods.</li>
                <li><strong>Layered System:</strong> Client doesn't know if it's talking to end server or intermediary.</li>
            </ul>
        </div>

        <!-- HTTP Methods -->
        <div class="protocol-section">
            <h2>HTTP Methods (CRUD Operations)</h2>

            <table class="endpoint-table">
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Operation</th>
                        <th>Example</th>
                        <th>Idempotent</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="method-badge method-get">GET</span></td>
                        <td>Read resource(s)</td>
                        <td>GET /users, GET /users/123</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td><span class="method-badge method-post">POST</span></td>
                        <td>Create resource</td>
                        <td>POST /users (with body)</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td><span class="method-badge method-put">PUT</span></td>
                        <td>Replace resource</td>
                        <td>PUT /users/123 (full update)</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td><span class="method-badge method-patch">PATCH</span></td>
                        <td>Partial update</td>
                        <td>PATCH /users/123 (partial)</td>
                        <td>No*</td>
                    </tr>
                    <tr>
                        <td><span class="method-badge method-delete">DELETE</span></td>
                        <td>Remove resource</td>
                        <td>DELETE /users/123</td>
                        <td>Yes</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Code Examples -->
        <div class="protocol-section">
            <h2>Code Examples</h2>

            <h3>Server Implementation</h3>
            <div class="code-tabs">
                <button class="code-tab active" data-lang="python">Python (FastAPI)</button>
                <button class="code-tab" data-lang="go">Go (Gin)</button>
                <button class="code-tab" data-lang="node">Node.js (Express)</button>
            </div>
            <div class="code-example">
                <div class="code-content active" id="python">
                    <pre><code class="language-python">from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Optional

app = FastAPI()

# Data model
class User(BaseModel):
    name: str
    email: str
    age: Optional[int] = None

# In-memory storage (use DB in production)
users_db = {}

# GET /users - List all users
@app.get("/users")
def list_users():
    return {"users": list(users_db.values())}

# GET /users/{id} - Get single user
@app.get("/users/{user_id}")
def get_user(user_id: int):
    if user_id not in users_db:
        raise HTTPException(status_code=404, detail="User not found")
    return users_db[user_id]

# POST /users - Create user
@app.post("/users", status_code=201)
def create_user(user: User):
    user_id = len(users_db) + 1
    users_db[user_id] = {"id": user_id, **user.dict()}
    return users_db[user_id]

# PUT /users/{id} - Replace user
@app.put("/users/{user_id}")
def update_user(user_id: int, user: User):
    if user_id not in users_db:
        raise HTTPException(status_code=404, detail="User not found")
    users_db[user_id] = {"id": user_id, **user.dict()}
    return users_db[user_id]

# DELETE /users/{id} - Delete user
@app.delete("/users/{user_id}", status_code=204)
def delete_user(user_id: int):
    if user_id not in users_db:
        raise HTTPException(status_code=404, detail="User not found")
    del users_db[user_id]</code></pre>
                </div>
                <div class="code-content" id="go">
                    <pre><code class="language-go">package main

import (
    "net/http"
    "strconv"
    "github.com/gin-gonic/gin"
)

type User struct {
    ID    int    `json:"id"`
    Name  string `json:"name" binding:"required"`
    Email string `json:"email" binding:"required"`
    Age   int    `json:"age,omitempty"`
}

var usersDB = make(map[int]User)
var nextID = 1

func main() {
    r := gin.Default()

    // GET /users - List all users
    r.GET("/users", func(c *gin.Context) {
        users := make([]User, 0, len(usersDB))
        for _, u := range usersDB {
            users = append(users, u)
        }
        c.JSON(http.StatusOK, gin.H{"users": users})
    })

    // GET /users/:id - Get single user
    r.GET("/users/:id", func(c *gin.Context) {
        id, _ := strconv.Atoi(c.Param("id"))
        user, exists := usersDB[id]
        if !exists {
            c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
            return
        }
        c.JSON(http.StatusOK, user)
    })

    // POST /users - Create user
    r.POST("/users", func(c *gin.Context) {
        var user User
        if err := c.ShouldBindJSON(&user); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
            return
        }
        user.ID = nextID
        nextID++
        usersDB[user.ID] = user
        c.JSON(http.StatusCreated, user)
    })

    // DELETE /users/:id - Delete user
    r.DELETE("/users/:id", func(c *gin.Context) {
        id, _ := strconv.Atoi(c.Param("id"))
        if _, exists := usersDB[id]; !exists {
            c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
            return
        }
        delete(usersDB, id)
        c.Status(http.StatusNoContent)
    })

    r.Run(":8080")
}</code></pre>
                </div>
                <div class="code-content" id="node">
                    <pre><code class="language-javascript">const express = require('express');
const app = express();
app.use(express.json());

let usersDB = {};
let nextId = 1;

// GET /users - List all users
app.get('/users', (req, res) => {
    res.json({ users: Object.values(usersDB) });
});

// GET /users/:id - Get single user
app.get('/users/:id', (req, res) => {
    const user = usersDB[req.params.id];
    if (!user) {
        return res.status(404).json({ error: 'User not found' });
    }
    res.json(user);
});

// POST /users - Create user
app.post('/users', (req, res) => {
    const { name, email, age } = req.body;
    if (!name || !email) {
        return res.status(400).json({ error: 'Name and email required' });
    }
    const user = { id: nextId++, name, email, age };
    usersDB[user.id] = user;
    res.status(201).json(user);
});

// PUT /users/:id - Replace user
app.put('/users/:id', (req, res) => {
    const id = req.params.id;
    if (!usersDB[id]) {
        return res.status(404).json({ error: 'User not found' });
    }
    const { name, email, age } = req.body;
    usersDB[id] = { id: parseInt(id), name, email, age };
    res.json(usersDB[id]);
});

// DELETE /users/:id - Delete user
app.delete('/users/:id', (req, res) => {
    const id = req.params.id;
    if (!usersDB[id]) {
        return res.status(404).json({ error: 'User not found' });
    }
    delete usersDB[id];
    res.status(204).send();
});

app.listen(8080, () => console.log('Server running on :8080'));</code></pre>
                </div>
            </div>

            <h3>Client Usage</h3>
            <div class="code-example">
                <pre><code class="language-bash"># GET - Fetch users
curl -X GET http://localhost:8080/users

# POST - Create user
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{"name": "John", "email": "john@example.com"}'

# PUT - Update user
curl -X PUT http://localhost:8080/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name": "John Doe", "email": "john.doe@example.com"}'

# DELETE - Remove user
curl -X DELETE http://localhost:8080/users/1</code></pre>
            </div>
        </div>

        <!-- Best Practices -->
        <div class="protocol-section">
            <h2>REST Best Practices</h2>

            <h3>URL Design</h3>
            <table class="endpoint-table">
                <thead>
                    <tr>
                        <th>Do</th>
                        <th>Don't</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>/users</code> (plural nouns)</td>
                        <td><code>/user</code>, <code>/getUsers</code></td>
                    </tr>
                    <tr>
                        <td><code>/users/123/orders</code> (nested resources)</td>
                        <td><code>/getUserOrders?userId=123</code></td>
                    </tr>
                    <tr>
                        <td><code>/users?status=active</code> (query params for filtering)</td>
                        <td><code>/activeUsers</code></td>
                    </tr>
                    <tr>
                        <td><code>/users/123</code> (use HTTP method for action)</td>
                        <td><code>/users/123/delete</code></td>
                    </tr>
                </tbody>
            </table>

            <h3>HTTP Status Codes</h3>
            <ul>
                <li><strong>200 OK:</strong> Successful GET, PUT, PATCH</li>
                <li><strong>201 Created:</strong> Successful POST (return created resource)</li>
                <li><strong>204 No Content:</strong> Successful DELETE</li>
                <li><strong>400 Bad Request:</strong> Invalid request body</li>
                <li><strong>401 Unauthorized:</strong> Missing or invalid authentication</li>
                <li><strong>403 Forbidden:</strong> Authenticated but not authorized</li>
                <li><strong>404 Not Found:</strong> Resource doesn't exist</li>
                <li><strong>409 Conflict:</strong> Resource already exists (duplicate)</li>
                <li><strong>429 Too Many Requests:</strong> Rate limit exceeded</li>
                <li><strong>500 Internal Server Error:</strong> Server-side error</li>
            </ul>
        </div>

        <!-- Pros and Cons -->
        <div class="protocol-section">
            <h2>When to Use REST</h2>

            <div class="pros-cons">
                <div class="pros">
                    <h4>Advantages</h4>
                    <ul>
                        <li>Simple and intuitive</li>
                        <li>Excellent browser support</li>
                        <li>Easy to cache (HTTP caching)</li>
                        <li>Widely understood by developers</li>
                        <li>Great tooling (Postman, Swagger)</li>
                        <li>Works with any language/framework</li>
                    </ul>
                </div>
                <div class="cons">
                    <h4>Disadvantages</h4>
                    <ul>
                        <li>Over-fetching (get more data than needed)</li>
                        <li>Under-fetching (multiple requests needed)</li>
                        <li>No standard for real-time updates</li>
                        <li>Versioning can be complex</li>
                        <li>No built-in schema validation</li>
                    </ul>
                </div>
            </div>

            <div class="highlight-box">
                <strong>Best For:</strong> Public APIs, mobile apps with simple data needs, CRUD applications, microservices communication, when you need excellent caching.
            </div>
        </div>

        <!-- Real World Examples -->
        <div class="protocol-section">
            <h2>Real-World Examples</h2>
            <ul>
                <li><strong>Stripe API:</strong> Payment processing - exemplary REST design with versioning</li>
                <li><strong>Twitter API:</strong> Social media data - heavy use of query parameters</li>
                <li><strong>GitHub API:</strong> Code repository - HATEOAS links for discovery</li>
                <li><strong>Shopify API:</strong> E-commerce - nested resources (/orders/123/items)</li>
            </ul>
        </div>
    </div>

    <aside class="page-sidebar">
        <div class="panel">
            <div class="panel-header">HTTP Methods</div>
            <div class="quick-ref-item"><span class="method-badge method-get" style="font-size:0.7rem;">GET</span><span class="quick-ref-value">Read</span></div>
            <div class="quick-ref-item"><span class="method-badge method-post" style="font-size:0.7rem;">POST</span><span class="quick-ref-value">Create</span></div>
            <div class="quick-ref-item"><span class="method-badge method-put" style="font-size:0.7rem;">PUT</span><span class="quick-ref-value">Replace</span></div>
            <div class="quick-ref-item"><span class="method-badge method-patch" style="font-size:0.7rem;">PATCH</span><span class="quick-ref-value">Update</span></div>
            <div class="quick-ref-item"><span class="method-badge method-delete" style="font-size:0.7rem;">DELETE</span><span class="quick-ref-value">Remove</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Status Codes</div>
            <div class="quick-ref-item"><span class="quick-ref-key">2xx</span><span class="quick-ref-value">Success</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">4xx</span><span class="quick-ref-value">Client Error</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">5xx</span><span class="quick-ref-value">Server Error</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Related</div>
            <a href="/network-protocols/graphql" class="quick-ref-item" style="display:block;text-decoration:none;">GraphQL</a>
            <a href="/network-protocols/grpc" class="quick-ref-item" style="display:block;text-decoration:none;">gRPC</a>
            <a href="/network-protocols/comparison" class="quick-ref-item" style="display:block;text-decoration:none;">Comparison</a>
        </div>
    </aside>
</div>

<script>
    // Code tab switching
    document.querySelectorAll('.code-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const lang = tab.dataset.lang;
            document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.code-content').forEach(c => c.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(lang).classList.add('active');
        });
    });
</script>
