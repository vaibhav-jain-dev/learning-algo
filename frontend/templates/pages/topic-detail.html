<div class="detail-layout">
    <!-- Left: Navigation (hidden on mobile) -->
    <aside class="nav-panel panel">
        <div class="panel-header">üìë Quick Navigation</div>
        <nav class="panel-list" id="toc-nav">
            <!-- Auto-populated by JS -->
        </nav>
    </aside>

    <!-- Center: Main Content -->
    <div class="detail-main">
        <nav class="breadcrumb">
            <a href="/{{.CategorySlug}}">‚Üê Back to {{.Category}}</a>
        </nav>

        <div class="topic-header">
            <span class="topic-badge">{{.Category}}</span>
            <h1>{{.Topic}}</h1>
        </div>

        {{if .HasContent}}
        <div class="topic-content" id="topic-content">
            {{safeHTML .Content}}
        </div>
        {{else}}
        <div class="card">
            <h2>üöß Content Coming Soon</h2>
            <p>We're working on detailed content for <strong>{{.Topic}}</strong>.</p>
        </div>
        {{end}}
    </div>

    <!-- Right: Quick Reference (hidden on mobile) -->
    <aside class="quick-panel panel">
        <div class="panel-header">üìå On This Page</div>
        <nav class="panel-list" id="quick-nav">
            <!-- Auto-populated by JS -->
        </nav>
    </aside>
</div>

{{if .HasContent}}
<script>
(function() {
    var content = document.getElementById('topic-content');
    if (!content) return;

    // Build navigation from headings
    var headings = content.querySelectorAll('h2, h3');
    var tocNav = document.getElementById('toc-nav');
    var quickNav = document.getElementById('quick-nav');
    var allNavLinks = [];

    headings.forEach(function(h, i) {
        // Ensure heading has an ID
        if (!h.id) h.id = 'section-' + i;

        var link = document.createElement('a');
        link.href = '#' + h.id;
        link.className = 'panel-item';
        link.textContent = h.textContent;
        link.setAttribute('data-target', h.id);
        link.onclick = function(e) {
            e.preventDefault();
            h.scrollIntoView({ behavior: 'smooth' });
        };

        if (tocNav) {
            var tocLink = link.cloneNode(true);
            tocLink.onclick = link.onclick;
            tocNav.appendChild(tocLink);
            allNavLinks.push(tocLink);
        }
        if (quickNav) {
            quickNav.appendChild(link);
            allNavLinks.push(link);
        }
    });

    // Scroll-spy: highlight active navigation item
    function updateActiveNavItem() {
        var scrollPos = window.scrollY + 100; // Offset for header
        var activeId = null;

        // Find the heading that's currently in view
        headings.forEach(function(h) {
            if (h.offsetTop <= scrollPos) {
                activeId = h.id;
            }
        });

        // Update active class on nav links
        allNavLinks.forEach(function(link) {
            if (link.getAttribute('data-target') === activeId) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    // Throttle scroll events for performance
    var scrollTimeout;
    window.addEventListener('scroll', function() {
        if (scrollTimeout) return;
        scrollTimeout = setTimeout(function() {
            updateActiveNavItem();
            scrollTimeout = null;
        }, 50);
    });

    // Initial check
    updateActiveNavItem();

    // Code highlighting
    if (typeof hljs !== 'undefined') {
        content.querySelectorAll('pre code').forEach(function(block) {
            hljs.highlightElement(block);
        });
    }
})();
</script>
{{end}}
