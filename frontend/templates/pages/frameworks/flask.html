<style>
    .fw-section { background: var(--bg-secondary, #f8fafc); padding: 24px; border-radius: 12px; margin-bottom: 24px; border: 1px solid var(--border-color, #e2e8f0); }
    .fw-section h2 { font-size: 1.5rem; margin-bottom: 12px; color: var(--accent-primary, #3b82f6); }
    .fw-section h3 { font-size: 1.2rem; margin-top: 20px; margin-bottom: 12px; color: var(--accent-secondary, #8b5cf6); }
    .code-example { background: #1e293b; border-radius: 8px; padding: 16px; margin: 16px 0; overflow-x: auto; }
    .code-example pre { margin: 0; color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; }
    .concept-card { background: var(--bg-tertiary); padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid var(--accent-secondary); }
    .concept-card h4 { color: var(--accent-secondary); margin-bottom: 10px; }
    .highlight-box { background: rgba(59, 130, 246, 0.08); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent-primary); margin: 16px 0; }

    /* Flow Diagram Styles */
    .flow-diagram { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 12px; padding: 24px; margin: 20px 0; }
    .flow-vertical { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .flow-step { display: flex; align-items: center; gap: 12px; width: 100%; max-width: 500px; }
    .flow-num { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
    .flow-content { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 10px 14px; flex: 1; }
    .flow-content.blue { border-left: 3px solid #3b82f6; }
    .flow-content.green { border-left: 3px solid #10b981; }
    .flow-content.purple { border-left: 3px solid #8b5cf6; }
    .flow-content.orange { border-left: 3px solid #f59e0b; }
    .flow-content.cyan { border-left: 3px solid #06b6d4; }
    .flow-title { color: #f8fafc; font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
    .flow-desc { color: #94a3b8; font-size: 0.75rem; }
    .flow-arrow { color: #475569; font-size: 1.2rem; }
</style>

<div class="page-layout">
    <div class="page-main">
        <nav style="margin-bottom: 16px;"><a href="/frameworks" style="color: var(--accent-primary);">&larr; Back to Frameworks</a></nav>

        <h1>Flask</h1>
        <p class="text-muted mb-4">Lightweight micro-framework for Python - simple, flexible, perfect for small to medium apps</p>

        <div class="fw-section">
            <h2>Request Flow: Input to Output</h2>
            <p>How Flask processes a request through all layers:</p>

            <div class="flow-diagram">
                <div class="flow-vertical">
                    <div class="flow-step">
                        <div class="flow-num">1</div>
                        <div class="flow-content blue">
                            <div class="flow-title">HTTP Request</div>
                            <div class="flow-desc">GET /users/123 - Client sends request</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">2</div>
                        <div class="flow-content">
                            <div class="flow-title">WSGI Server (Gunicorn)</div>
                            <div class="flow-desc">Create WSGI environ dict, pass to Flask app</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">3</div>
                        <div class="flow-content purple">
                            <div class="flow-title">before_request hooks</div>
                            <div class="flow-desc">@before_request - Auth check, logging, setup</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">4</div>
                        <div class="flow-content orange">
                            <div class="flow-title">URL Routing</div>
                            <div class="flow-desc">Match @app.route('/users/&lt;id&gt;'), extract params</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">5</div>
                        <div class="flow-content cyan">
                            <div class="flow-title">View Function</div>
                            <div class="flow-desc">def get_user(id): - Execute business logic</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">6</div>
                        <div class="flow-content">
                            <div class="flow-title">Database (SQLAlchemy)</div>
                            <div class="flow-desc">User.query.get(id) - Fetch data from DB</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">7</div>
                        <div class="flow-content purple">
                            <div class="flow-title">after_request hooks</div>
                            <div class="flow-desc">@after_request - Add headers, logging, cleanup</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">8</div>
                        <div class="flow-content green">
                            <div class="flow-title">Response</div>
                            <div class="flow-desc">JSON Response 200 OK - Return to client</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="fw-section">
            <h2>Key Concepts</h2>

            <div class="concept-card">
                <h4>1. Routes & View Functions</h4>
                <div class="code-example">
                    <pre><code class="language-python">from flask import Flask, request, jsonify

app = Flask(__name__)

# Basic route
@app.route('/')
def index():
    return 'Hello, World!'

# Route with methods and path parameters
@app.route('/users/<int:user_id>', methods=['GET', 'PUT', 'DELETE'])
def user(user_id):
    if request.method == 'GET':
        user = get_user_from_db(user_id)
        return jsonify(user)
    elif request.method == 'PUT':
        data = request.get_json()
        updated = update_user(user_id, data)
        return jsonify(updated)
    elif request.method == 'DELETE':
        delete_user(user_id)
        return '', 204

# Query parameters
@app.route('/search')
def search():
    query = request.args.get('q', '')
    page = request.args.get('page', 1, type=int)
    return jsonify(search_results(query, page))</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>2. Request Hooks (Middleware Pattern)</h4>
                <div class="code-example">
                    <pre><code class="language-python">from flask import g, request
import time

# Run before every request
@app.before_request
def before_request():
    g.start_time = time.time()
    g.request_id = str(uuid.uuid4())

    # Authentication check
    token = request.headers.get('Authorization')
    if token:
        g.user = verify_token(token)

# Run after every request
@app.after_request
def after_request(response):
    duration = time.time() - g.start_time
    response.headers['X-Request-ID'] = g.request_id
    response.headers['X-Process-Time'] = str(duration)
    return response

# Error handlers
@app.errorhandler(404)
def not_found(error):
    return jsonify({'error': 'Not found'}), 404

@app.errorhandler(500)
def internal_error(error):
    return jsonify({'error': 'Internal server error'}), 500</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>3. Blueprints (Modular Routes)</h4>
                <div class="code-example">
                    <pre><code class="language-python"># blueprints/users.py
from flask import Blueprint, jsonify

users_bp = Blueprint('users', __name__, url_prefix='/api/users')

@users_bp.route('/')
def list_users():
    return jsonify(get_all_users())

@users_bp.route('/<int:id>')
def get_user(id):
    return jsonify(get_user_by_id(id))

# app.py
from blueprints.users import users_bp
from blueprints.posts import posts_bp

app = Flask(__name__)
app.register_blueprint(users_bp)
app.register_blueprint(posts_bp)</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>4. Database with Flask-SQLAlchemy</h4>
                <div class="code-example">
                    <pre><code class="language-python">from flask_sqlalchemy import SQLAlchemy

app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://localhost/mydb'
db = SQLAlchemy(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)

@app.route('/users', methods=['POST'])
def create_user():
    data = request.get_json()
    user = User(name=data['name'], email=data['email'])
    db.session.add(user)
    db.session.commit()
    return jsonify({'id': user.id}), 201</code></pre>
                </div>
            </div>
        </div>

        <div class="fw-section">
            <h2>When to Use Flask</h2>
            <div class="highlight-box">
                <strong>Best For:</strong>
                <ul style="margin-top: 8px;">
                    <li>Small to medium APIs and web apps</li>
                    <li>Prototyping and MVPs</li>
                    <li>Microservices</li>
                    <li>When you want control over architecture</li>
                    <li>Learning web development</li>
                </ul>
            </div>
            <p><strong>Choose FastAPI instead if:</strong> You need async, automatic docs, or type validation.</p>
            <p><strong>Choose Django instead if:</strong> You need admin panel, ORM, auth out of the box.</p>
        </div>
    </div>

    <aside class="page-sidebar">
        <div class="panel">
            <div class="panel-header">Key Features</div>
            <div class="quick-ref-item"><span class="quick-ref-key">Type</span><span class="quick-ref-value">Micro framework</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">WSGI</span><span class="quick-ref-value">Werkzeug</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Template</span><span class="quick-ref-value">Jinja2</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Related</div>
            <a href="/frameworks/fastapi" class="quick-ref-item" style="display:block;text-decoration:none;">FastAPI</a>
            <a href="/frameworks/django" class="quick-ref-item" style="display:block;text-decoration:none;">Django</a>
        </div>
    </aside>
</div>
