<style>
    .fw-section { background: var(--bg-secondary, #f8fafc); padding: 24px; border-radius: 12px; margin-bottom: 24px; border: 1px solid var(--border-color, #e2e8f0); }
    .fw-section h2 { font-size: 1.5rem; margin-bottom: 12px; color: var(--accent-primary, #3b82f6); }
    .fw-section h3 { font-size: 1.2rem; margin-top: 20px; margin-bottom: 12px; color: var(--accent-secondary, #8b5cf6); }
    .code-example { background: #1e293b; border-radius: 8px; padding: 16px; margin: 16px 0; overflow-x: auto; }
    .code-example pre { margin: 0; color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.9rem; white-space: pre-wrap; word-wrap: break-word; }
    .concept-card { background: var(--bg-tertiary); padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid var(--accent-secondary); }
    .concept-card h4 { color: var(--accent-secondary); margin-bottom: 10px; }
    .highlight-box { background: rgba(59, 130, 246, 0.08); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent-primary); margin: 16px 0; }

    /* Flow Diagram Styles */
    .flow-diagram { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 12px; padding: 24px; margin: 20px 0; }
    .flow-vertical { display: flex; flex-direction: column; align-items: center; gap: 8px; }
    .flow-step { display: flex; align-items: center; gap: 12px; width: 100%; max-width: 500px; }
    .flow-num { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; flex-shrink: 0; }
    .flow-content { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 8px; padding: 10px 14px; flex: 1; }
    .flow-content.blue { border-left: 3px solid #3b82f6; }
    .flow-content.green { border-left: 3px solid #10b981; }
    .flow-content.purple { border-left: 3px solid #8b5cf6; }
    .flow-content.orange { border-left: 3px solid #f59e0b; }
    .flow-content.cyan { border-left: 3px solid #06b6d4; }
    .flow-title { color: #f8fafc; font-size: 0.85rem; font-weight: 600; margin-bottom: 2px; }
    .flow-desc { color: #94a3b8; font-size: 0.75rem; }
    .flow-arrow { color: #475569; font-size: 1.2rem; }
</style>

<div class="page-layout">
    <div class="page-main">
        <nav style="margin-bottom: 16px;"><a href="/frameworks" style="color: var(--accent-primary);">&larr; Back to Frameworks</a></nav>

        <h1>Django</h1>
        <p class="text-muted mb-4">Batteries-included Python web framework - ORM, admin, auth, and more out of the box</p>

        <div class="fw-section">
            <h2>Request Flow: Input to Output</h2>
            <p>How Django processes a request through all layers:</p>

            <div class="flow-diagram">
                <div class="flow-vertical">
                    <div class="flow-step">
                        <div class="flow-num">1</div>
                        <div class="flow-content blue">
                            <div class="flow-title">HTTP Request</div>
                            <div class="flow-desc">GET /users/123/ - incoming client request</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">2</div>
                        <div class="flow-content">
                            <div class="flow-title">WSGI Server</div>
                            <div class="flow-desc">WSGIHandler.get_response() - Gunicorn/uWSGI</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">3</div>
                        <div class="flow-content purple">
                            <div class="flow-title">Middleware (top-down)</div>
                            <div class="flow-desc">Security → Session → Auth → Common</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">4</div>
                        <div class="flow-content orange">
                            <div class="flow-title">URL Resolver</div>
                            <div class="flow-desc">URLconf matching: path('users/&lt;id&gt;/', views.user)</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">5</div>
                        <div class="flow-content cyan">
                            <div class="flow-title">View Function</div>
                            <div class="flow-desc">def user_detail(request, id) or UserDetailView</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">6</div>
                        <div class="flow-content purple">
                            <div class="flow-title">ORM/Database</div>
                            <div class="flow-desc">User.objects.get(pk=id) - QuerySet execution</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">7</div>
                        <div class="flow-content">
                            <div class="flow-title">Template Rendering</div>
                            <div class="flow-desc">render(request, 'user.html', context)</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">8</div>
                        <div class="flow-content purple">
                            <div class="flow-title">Middleware (bottom-up)</div>
                            <div class="flow-desc">Common → Auth → Session → Security</div>
                        </div>
                    </div>
                    <div class="flow-arrow">↓</div>

                    <div class="flow-step">
                        <div class="flow-num">9</div>
                        <div class="flow-content green">
                            <div class="flow-title">Response</div>
                            <div class="flow-desc">HttpResponse - HTML or JSON returned to client</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="fw-section">
            <h2>Key Concepts</h2>

            <div class="concept-card">
                <h4>1. URL Configuration</h4>
                <div class="code-example">
                    <pre><code class="language-python"># urls.py
from django.urls import path, include
from . import views

urlpatterns = [
    path('', views.index, name='index'),
    path('users/', views.user_list, name='user-list'),
    path('users/<int:pk>/', views.user_detail, name='user-detail'),
    path('api/', include('api.urls')),  # Include another URLconf
]</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>2. Views (Function & Class-Based)</h4>
                <div class="code-example">
                    <pre><code class="language-python"># Function-based view
from django.shortcuts import render, get_object_or_404
from django.http import JsonResponse

def user_detail(request, pk):
    user = get_object_or_404(User, pk=pk)

    if request.method == 'GET':
        return render(request, 'users/detail.html', {'user': user})

    elif request.method == 'POST':
        # Handle form submission
        pass

# Class-based view
from django.views import View
from django.views.generic import DetailView, ListView

class UserDetailView(DetailView):
    model = User
    template_name = 'users/detail.html'
    context_object_name = 'user'

class UserListView(ListView):
    model = User
    template_name = 'users/list.html'
    paginate_by = 20</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>3. Models (ORM)</h4>
                <div class="code-example">
                    <pre><code class="language-python"># models.py
from django.db import models
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    bio = models.TextField(blank=True)
    avatar = models.ImageField(upload_to='avatars/', null=True)

class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name='posts')
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        ordering = ['-created_at']

# QuerySet examples
User.objects.all()                        # All users
User.objects.filter(is_active=True)       # Filter
User.objects.get(pk=1)                    # Single object
Post.objects.select_related('author')     # JOIN optimization</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>4. Middleware</h4>
                <div class="code-example">
                    <pre><code class="language-python"># middleware.py
class RequestTimingMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        import time
        start = time.time()

        response = self.get_response(request)  # Call view

        duration = time.time() - start
        response['X-Request-Time'] = str(duration)
        return response

# settings.py
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'myapp.middleware.RequestTimingMiddleware',  # Custom
    'django.middleware.common.CommonMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
]</code></pre>
                </div>
            </div>

            <div class="concept-card">
                <h4>5. Admin Panel</h4>
                <div class="code-example">
                    <pre><code class="language-python"># admin.py
from django.contrib import admin
from .models import User, Post

@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['title', 'author', 'created_at']
    list_filter = ['created_at', 'author']
    search_fields = ['title', 'content']
    date_hierarchy = 'created_at'

# Access at /admin/ - full CRUD interface automatically!</code></pre>
                </div>
            </div>
        </div>

        <div class="fw-section">
            <h2>When to Use Django</h2>
            <div class="highlight-box">
                <strong>Best For:</strong>
                <ul style="margin-top: 8px;">
                    <li>Full-stack web applications</li>
                    <li>Content management systems</li>
                    <li>Projects needing admin panel</li>
                    <li>Rapid prototyping with batteries included</li>
                    <li>Teams who want conventions over configuration</li>
                </ul>
            </div>
            <p><strong>Deep Dives:</strong></p>
            <ul>
                <li><a href="/frameworks/django-rest">Django REST Framework</a> - Build APIs</li>
                <li><a href="/frameworks/django-orm">Django ORM</a> - Master database queries</li>
            </ul>
        </div>
    </div>

    <aside class="page-sidebar">
        <div class="panel">
            <div class="panel-header">Batteries Included</div>
            <div class="quick-ref-item"><span class="quick-ref-key">ORM</span><span class="quick-ref-value">Built-in</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Admin</span><span class="quick-ref-value">Built-in</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Auth</span><span class="quick-ref-value">Built-in</span></div>
            <div class="quick-ref-item"><span class="quick-ref-key">Forms</span><span class="quick-ref-value">Built-in</span></div>
        </div>
        <div class="panel mt-4">
            <div class="panel-header">Related</div>
            <a href="/frameworks/django-rest" class="quick-ref-item" style="display:block;text-decoration:none;">Django REST</a>
            <a href="/frameworks/django-orm" class="quick-ref-item" style="display:block;text-decoration:none;">Django ORM</a>
        </div>
    </aside>
</div>
